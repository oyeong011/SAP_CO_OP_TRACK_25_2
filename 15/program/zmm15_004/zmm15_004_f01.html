<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=ISO-8859-1" />
<title>ZMM15_004_F01</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMM15_004_F01</h2>
<h3> Description: </h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;Include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMM15_004_F01<br />
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SCREEN_CONTROL<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SCREEN_CONTROL .<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'M1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_R1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;P_R2&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHECK_INPUT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CHECK_INPUT .<br />
&nbsp;&nbsp;IF&nbsp;P_R1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_EBELN&nbsp;=&nbsp;''&nbsp;OR&nbsp;P_WERKS&nbsp;=&nbsp;''&nbsp;OR&nbsp;P_BLDAT&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;##&nbsp;##&nbsp;#####'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ELSEIF&nbsp;P_R2&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_EBELN&nbsp;=&nbsp;''&nbsp;OR&nbsp;P_WERKS&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;##&nbsp;##&nbsp;#####'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHECK_EBELN<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;######&nbsp;###<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CHECK_EBELN .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_EBELN&nbsp;TYPE&nbsp;EBELN.<br />
&nbsp;&nbsp;CHECK&nbsp;P_EBELN&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKKO_15<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_EBELN.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;##&nbsp;#######'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_DATA .<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_HEADER.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_ITEM.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;CALCULATE_DUE_DATE.<br />
<br />
&nbsp;&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;G_WMWST1&nbsp;=&nbsp;0.&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;G_BALANCE&nbsp;=&nbsp;0.&nbsp;"##<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_HEADER<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_HEADER .<br />
<br />
&nbsp;&nbsp;"###,&nbsp;####,&nbsp;######&nbsp;####<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;BUKRS&nbsp;LIFNR&nbsp;WAERS<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKKO_15<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;(&nbsp;GV_BUKRS,&nbsp;GV_LIFNR,&nbsp;G_WAERS&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_EBELN.<br />
<br />
&nbsp;&nbsp;"####&nbsp;####<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;MWSKZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZLFM1_15<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;G_MWSKZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;=&nbsp;GV_LIFNR.<br />
<br />
&nbsp;&nbsp;&nbsp;"####&nbsp;####<br />
&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;ZTERM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZLFB1_15<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;G_ZTERM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;=&nbsp;GV_LIFNR.<br />
<br />
&nbsp;&nbsp;&nbsp;G_BLDAT&nbsp;=&nbsp;P_BLDAT.&nbsp;"###&nbsp;(#####)<br />
&nbsp;&nbsp;&nbsp;G_BUDAT&nbsp;=&nbsp;SY-DATUM.&nbsp;"###<br />
&nbsp;&nbsp;&nbsp;G_WAERS2&nbsp;=&nbsp;G_WAERS.&nbsp;"###<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_ITEM<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_ITEM .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_EKPO&nbsp;TYPE&nbsp;ZEKPO_15,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_EKPO&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_EKPO.<br />
&nbsp;&nbsp;DATA&nbsp;&nbsp;:&nbsp;LV_PO_MENGE&nbsp;TYPE&nbsp;MENGE_D,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_IV_MENGE&nbsp;TYPE&nbsp;MENGE_D.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GT_ALV_100,&nbsp;GS_ALV_100.<br />
<br />
&nbsp;&nbsp;"EKPO##&nbsp;SELECT<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKPO_15<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_EKPO<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;WERKS&nbsp;=&nbsp;P_WERKS.<br />
<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_EKPO&nbsp;INTO&nbsp;LS_EKPO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_ALV_100,&nbsp;LV_PO_MENGE,&nbsp;LV_IV_MENGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"PO&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_PO_MENGE&nbsp;=&nbsp;LS_EKPO-MENGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SUM(&nbsp;MENGE&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG_15<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_IV_MENGE<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;LS_EKPO-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;EBELP&nbsp;=&nbsp;LS_EKPO-EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;MATNR&nbsp;=&nbsp;LS_EKPO-MATNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_IV_MENGE&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_IV_MENGE&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-MENGE&nbsp;=&nbsp;LV_PO_MENGE&nbsp;-&nbsp;LV_IV_MENGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"####&nbsp;###&nbsp;CONTINUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ALV_100-MENGE&nbsp;&lt;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-CHECK&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-BUZEI&nbsp;=&nbsp;SY-TABIX&nbsp;*&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-NETPR&nbsp;=&nbsp;LS_EKPO-STPRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-MENGE&nbsp;=&nbsp;LS_EKPO-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-MEINS&nbsp;=&nbsp;LS_EKPO-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-EBELN&nbsp;=&nbsp;LS_EKPO-EBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-EBELP&nbsp;=&nbsp;LS_EKPO-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-MATNR&nbsp;=&nbsp;LS_EKPO-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-ZMATNAME&nbsp;=&nbsp;LS_EKPO-MAKTX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-WERKS&nbsp;=&nbsp;LS_EKPO-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-MWSKZ_S&nbsp;=&nbsp;G_MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-WAERS&nbsp;=&nbsp;G_WAERS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-WRBTR&nbsp;=&nbsp;GS_ALV_100-NETPR&nbsp;*&nbsp;GS_ALV_100-MENGE.&nbsp;"####&nbsp;(##&nbsp;*&nbsp;####)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_RATE&nbsp;TYPE&nbsp;P&nbsp;DECIMALS&nbsp;2.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;G_MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V1'.&nbsp;LV_RATE&nbsp;=&nbsp;C_V1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V2'.&nbsp;LV_RATE&nbsp;=&nbsp;C_V2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V3'.&nbsp;LV_RATE&nbsp;=&nbsp;C_V3.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V4'.&nbsp;LV_RATE&nbsp;=&nbsp;C_V4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V5'.&nbsp;LV_RATE&nbsp;=&nbsp;C_V5.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-WMWST&nbsp;=&nbsp;GS_ALV_100-WRBTR&nbsp;*&nbsp;LV_RATE.&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-DMBTR&nbsp;=&nbsp;GS_ALV_100-WRBTR&nbsp;+&nbsp;GS_ALV_100-WMWST.&nbsp;"##&nbsp;(###+##)<br />
<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_ALV_100&nbsp;TO&nbsp;GT_ALV_100.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CREATE_OBJECT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CREATE_OBJECT .<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_CUSTOM<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;=&nbsp;'CON1'.<br />
<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;=&nbsp;GC_CUSTOM.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FIELD_CATALOG<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FIELD_CATALOG .<br />
CLEAR : GS_FIELDCAT, GT_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'CHECK'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CHECKBOX&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BUZEI'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'NETPR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-QFIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-DATATYPE&nbsp;=&nbsp;'INT'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;'15'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;7.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WRBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EBELN'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;9.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EBELP'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.&nbsp;"####&nbsp;##<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MWSKZ_S'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;11.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WMWST'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;12.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;13.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZMATNAME'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;14.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WERKS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;15.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'DMBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;16.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'SGTXT'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_LAYOUT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_LAYOUT .<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_LAYOUT.<br />
&nbsp;&nbsp;GS_LAYOUT-ZEBRA&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_LAYOUT-NO_TOOLBAR&nbsp;=&nbsp;'X'.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CLASS_EVENT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CLASS_EVENT .<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;REGISTER_EDIT_EVENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EVENT_ID&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_EVT_MODIFIED<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_EVENT.<br />
<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_EVENT-&gt;HANDLER_DATA_CHANGED&nbsp;FOR&nbsp;GC_GRID.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;DISPLAY_ALV<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM DISPLAY_ALV .<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_ALV_100<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_FIELDCAT.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_HANDLER_DATA_CHANGED<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;###&nbsp;##&nbsp;##&nbsp;##<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_ER_DATA_CHANGED&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_E_ONF4&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_E_ONF4_BEFORE&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_E_ONF4_AFTER&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_E_UCOMM&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_HANDLER_DATA_CHANGED  USING    P_ER_DATA_CHANGED TYPE REF TO CL_ALV_CHANGED_DATA_PROTOCOL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_E_ONF4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_E_ONF4_BEFORE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_E_ONF4_AFTER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_E_UCOMM.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LS_MODI&nbsp;TYPE&nbsp;LVC_S_MODI.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;P_ER_DATA_CHANGED-&gt;MT_GOOD_CELLS&nbsp;INTO&nbsp;LS_MODI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_MODI-FIELDNAME&nbsp;=&nbsp;'CHECK'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ALV_100&nbsp;INTO&nbsp;GS_ALV_100&nbsp;INDEX&nbsp;LS_MODI-ROW_ID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ALV_100-CHECK&nbsp;=&nbsp;LS_MODI-VALUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ALV_100&nbsp;FROM&nbsp;GS_ALV_100&nbsp;INDEX&nbsp;LS_MODI-ROW_ID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;CALCULATE_TOTAL_HEADER.<br />
<br />
&nbsp;&nbsp;"###&nbsp;##&nbsp;##&nbsp;##&nbsp;###&nbsp;##&nbsp;PBO&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;CL_GUI_CFW=&gt;SET_NEW_OK_CODE<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEW_CODE&nbsp;=&nbsp;'REFRESH'.&nbsp;"&nbsp;PAI##&nbsp;##&nbsp;##&nbsp;#&nbsp;##&nbsp;Dummy&nbsp;Code<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALCULATE_TOTAL_HEADER<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;##&nbsp;##,&nbsp;##&nbsp;##<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALCULATE_TOTAL_HEADER .<br />
&nbsp;&nbsp;DATA:&nbsp;LV_TOTAL_TAX&nbsp;TYPE&nbsp;ZRBKP_15-WMWST1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_TOTAL_GROSS&nbsp;TYPE&nbsp;ZRBKP_15-RMWWR.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;LV_TOTAL_TAX,&nbsp;LV_TOTAL_GROSS.<br />
<br />
&nbsp;&nbsp;"&nbsp;###&nbsp;####&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ALV_100&nbsp;INTO&nbsp;GS_ALV_100&nbsp;WHERE&nbsp;CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_TOTAL_TAX&nbsp;&nbsp;&nbsp;=&nbsp;LV_TOTAL_TAX&nbsp;+&nbsp;GS_ALV_100-WMWST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_TOTAL_GROSS&nbsp;=&nbsp;LV_TOTAL_GROSS&nbsp;+&nbsp;GS_ALV_100-DMBTR.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;##(##)#&nbsp;##<br />
&nbsp;&nbsp;G_WMWST1&nbsp;=&nbsp;LV_TOTAL_TAX.&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;G_RMWWR&nbsp;&nbsp;=&nbsp;LV_TOTAL_GROSS.&nbsp;"&nbsp;##&nbsp;##<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;=&nbsp;###(G_WRBTR)&nbsp;-&nbsp;###&nbsp;###,&nbsp;###&nbsp;#######&nbsp;0<br />
&nbsp;&nbsp;G_BALANCE&nbsp;=&nbsp;0.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CREATE_INVOICE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CREATE_INVOICE .<br />
&nbsp;&nbsp;DATA:&nbsp;LS_RBKP&nbsp;TYPE&nbsp;ZRBKP_15,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG&nbsp;TYPE&nbsp;ZRSEG_15.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_CHECK_CNT&nbsp;TYPE&nbsp;I.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_BUZEI&nbsp;TYPE&nbsp;ZRSEG_15-BUZEI.<br />
<br />
&nbsp;&nbsp;"##&nbsp;#&nbsp;##&nbsp;##&nbsp;#&nbsp;##<br />
&nbsp;&nbsp;PERFORM&nbsp;CALCULATE_TOTAL_HEADER.<br />
<br />
&nbsp;&nbsp;"&nbsp;###&nbsp;##&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ALV_100&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS&nbsp;WHERE&nbsp;CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_CHECK_CNT&nbsp;=&nbsp;LV_CHECK_CNT&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LV_CHECK_CNT&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;####&nbsp;#####.'&nbsp;TYPE&nbsp;'I'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"######(BELNR)&nbsp;##<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;MAX(&nbsp;BELNR&nbsp;)&nbsp;FROM&nbsp;ZRBKP_15&nbsp;INTO&nbsp;GV_BELNR.<br />
&nbsp;&nbsp;IF&nbsp;GV_BELNR&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_BELNR&nbsp;=&nbsp;'5100000000'.&nbsp;"###&nbsp;##<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_BELNR&nbsp;=&nbsp;GV_BELNR&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-BELNR&nbsp;=&nbsp;GV_BELNR.&nbsp;"##&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-GJAHR&nbsp;=&nbsp;G_BUDAT+0(4).&nbsp;"####&nbsp;-&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-BLART&nbsp;=&nbsp;'RE'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"####&nbsp;RE<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-BLDAT&nbsp;=&nbsp;G_BLDAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-BUDAT&nbsp;=&nbsp;G_BUDAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-BUKRS&nbsp;&nbsp;=&nbsp;GV_BUKRS.&nbsp;"&nbsp;####&nbsp;(GET_HEADER##&nbsp;###&nbsp;#)<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-LIFNR&nbsp;&nbsp;=&nbsp;GV_LIFNR.&nbsp;"&nbsp;####&nbsp;(GET_HEADER##&nbsp;###&nbsp;#)<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-WAERS&nbsp;=&nbsp;G_WAERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-RMWWR&nbsp;=&nbsp;G_RMWWR.&nbsp;"#####<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-WMWST1&nbsp;=&nbsp;G_WMWST1.&nbsp;"##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-MWSKZ&nbsp;=&nbsp;G_MWSKZ.&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-ZTERM&nbsp;=&nbsp;G_ZTERM.&nbsp;"####&nbsp;#<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-BKTXT&nbsp;=&nbsp;G_BKTXT.&nbsp;"##&nbsp;##&nbsp;###<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-STBLG&nbsp;=&nbsp;''.&nbsp;"#######&nbsp;(######&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-STJAH&nbsp;=&nbsp;''.&nbsp;"#####&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-RBSTAT&nbsp;=&nbsp;5.&nbsp;"##&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-ZFBDT&nbsp;=&nbsp;G_ZFBDT.&nbsp;"###<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;INTO&nbsp;ZRBKP_15&nbsp;VALUES&nbsp;LS_RBKP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;##&nbsp;#&nbsp;###&nbsp;######.'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"###<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ALV_100&nbsp;INTO&nbsp;GS_ALV_100&nbsp;WHERE&nbsp;CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_RSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;LV_BUZEI.&nbsp;"###&nbsp;##&nbsp;##<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-BELNR&nbsp;=&nbsp;GV_BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-GJAHR&nbsp;=&nbsp;G_BUDAT+0(4).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-EBELN&nbsp;=&nbsp;P_EBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-EBELP&nbsp;=&nbsp;GS_ALV_100-EBELP.&nbsp;"PO&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-MATNR&nbsp;=&nbsp;GS_ALV_100-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-WERKS&nbsp;=&nbsp;GS_ALV_100-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-WRBTR&nbsp;=&nbsp;GS_ALV_100-WRBTR.&nbsp;"####<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-SHKZG&nbsp;=&nbsp;'H'.&nbsp;&nbsp;"###&nbsp;##<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-MENGE&nbsp;=&nbsp;GS_ALV_100-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-MEINS&nbsp;=&nbsp;GS_ALV_100-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-BPRME&nbsp;=&nbsp;GS_ALV_100-MEINS.&nbsp;"######&nbsp;(######)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-NETPR&nbsp;=&nbsp;GS_ALV_100-NETPR.&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-SGTXT&nbsp;=&nbsp;GS_ALV_100-SGTXT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-DMBTR&nbsp;=&nbsp;GS_ALV_100-DMBTR.&nbsp;"##<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;INTO&nbsp;ZRSEG_15&nbsp;VALUES&nbsp;LS_RSEG.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;##&nbsp;#&nbsp;###&nbsp;######.'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;|####&nbsp;#######.&nbsp;{&nbsp;GV_BELNR&nbsp;}##&nbsp;#######|&nbsp;TYPE&nbsp;'S'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALCULATE_DUE_DATE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;###&nbsp;##<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALCULATE_DUE_DATE .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_BASE&nbsp;TYPE&nbsp;D,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_YEAR&nbsp;TYPE&nbsp;N&nbsp;LENGTH&nbsp;4,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MONTH&nbsp;TYPE&nbsp;N&nbsp;LENGTH&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_DAY&nbsp;TYPE&nbsp;N&nbsp;LENGTH&nbsp;2,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MONTH_ADD&nbsp;TYPE&nbsp;I.<br />
<br />
&nbsp;&nbsp;LV_BASE&nbsp;=&nbsp;G_BUDAT.<br />
&nbsp;&nbsp;LV_YEAR&nbsp;=&nbsp;LV_BASE+0(4).<br />
&nbsp;&nbsp;LV_MONTH&nbsp;=&nbsp;LV_BASE+4(2).<br />
&nbsp;&nbsp;LV_DAY&nbsp;=&nbsp;LV_BASE+6(2).<br />
<br />
&nbsp;&nbsp;CASE&nbsp;G_ZTERM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M001'.&nbsp;LV_MONTH_ADD&nbsp;=&nbsp;0.&nbsp;LV_DAY&nbsp;=&nbsp;'10'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M002'.&nbsp;LV_MONTH_ADD&nbsp;=&nbsp;0.&nbsp;LV_DAY&nbsp;=&nbsp;'25'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M003'.&nbsp;LV_MONTH_ADD&nbsp;=&nbsp;1.&nbsp;LV_DAY&nbsp;=&nbsp;'10'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M004'.&nbsp;LV_MONTH_ADD&nbsp;=&nbsp;1.&nbsp;LV_DAY&nbsp;=&nbsp;'25'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M005'.&nbsp;LV_MONTH_ADD&nbsp;=&nbsp;2.&nbsp;LV_DAY&nbsp;=&nbsp;'10'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M006'.&nbsp;LV_MONTH_ADD&nbsp;=&nbsp;2.&nbsp;LV_DAY&nbsp;=&nbsp;'25'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P010'.&nbsp;G_ZFBDT&nbsp;=&nbsp;LV_BASE&nbsp;+&nbsp;10.&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P015'.&nbsp;G_ZFBDT&nbsp;=&nbsp;LV_BASE&nbsp;+&nbsp;15.&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P020'.&nbsp;G_ZFBDT&nbsp;=&nbsp;LV_BASE&nbsp;+&nbsp;20.&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P030'.&nbsp;G_ZFBDT&nbsp;=&nbsp;LV_BASE&nbsp;+&nbsp;30.&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P060'.&nbsp;G_ZFBDT&nbsp;=&nbsp;LV_BASE&nbsp;+&nbsp;60.&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P090'.&nbsp;G_ZFBDT&nbsp;=&nbsp;LV_BASE&nbsp;+&nbsp;90.&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;LV_MONTH&nbsp;=&nbsp;LV_MONTH&nbsp;+&nbsp;LV_MONTH_ADD.<br />
&nbsp;&nbsp;IF&nbsp;LV_MONTH&nbsp;&gt;&nbsp;12.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_MONTH&nbsp;=&nbsp;LV_MONTH&nbsp;-&nbsp;12.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_YEAR&nbsp;=&nbsp;LV_YEAR&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CONCATENATE&nbsp;LV_YEAR&nbsp;LV_MONTH&nbsp;LV_DAY&nbsp;INTO&nbsp;G_ZFBDT.<br />
ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">Extracted by Mass Download version 1.5.5 - E.G.Mellodew. 1998-2025. Sap Release 750</td>
   </tr>
</table>
</body>
</html>
