<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=ISO-8859-1" />
<title>ZMMR01_030_F01</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMMR01_030_F01</h2>
<h3> Description: </h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;Include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMMR01_030_F01<br />
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;INITIALIZATION<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM INITIALIZATION .<br />
&nbsp;&nbsp;P_BUDAT&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;P_EBELN&nbsp;=&nbsp;4500000001.<br />
&nbsp;&nbsp;P_WERKS&nbsp;=&nbsp;1000.<br />
&nbsp;&nbsp;GV_ICON_STATUS&nbsp;=&nbsp;'@0A@'.<br />
<br />
&nbsp;&nbsp;GS_HEADER-WIDTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;30.<br />
&nbsp;&nbsp;GS_HEADER-WIDTH_PIX&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;GS_HEADER-HEADING&nbsp;&nbsp;&nbsp;=&nbsp;'MY&nbsp;DOCUMENTS'.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SELECTION_SCREEN_OUTPUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SELECTION_SCREEN_OUTPUT .<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'M1'.&nbsp;&nbsp;"###<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_R1&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;P_R2&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHECK_MANDATORY<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CHECK_MANDATORY .<br />
&nbsp;&nbsp;IF&nbsp;P_R1&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_EBELN&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S008&nbsp;WITH&nbsp;TEXT-M01&nbsp;DISPLAY&nbsp;LIKE&nbsp;C_E.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_WERKS&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S008&nbsp;WITH&nbsp;TEXT-M02&nbsp;DISPLAY&nbsp;LIKE&nbsp;C_E.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_BUDAT&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S008&nbsp;WITH&nbsp;TEXT-M03&nbsp;DISPLAY&nbsp;LIKE&nbsp;C_E.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;P_R2&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_EBELN&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S008&nbsp;WITH&nbsp;TEXT-M01&nbsp;DISPLAY&nbsp;LIKE&nbsp;C_E.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_WERKS&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S008&nbsp;WITH&nbsp;TEXT-M02&nbsp;DISPLAY&nbsp;LIKE&nbsp;C_E.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHECK_SELECTION_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CHECK_SELECTION_DATA .<br />
&nbsp;&nbsp;IF&nbsp;P_R1&nbsp;=&nbsp;C_X.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_MODE&nbsp;=&nbsp;C_CRUD.<br />
&nbsp;&nbsp;ELSEIF&nbsp;P_R2&nbsp;=&nbsp;C_X.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_MODE&nbsp;=&nbsp;C_DISP.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHECK_PURCHASE_ORDER_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CHECK_PURCHASE_ORDER_DATA .<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;GS_EKKO<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKKO01<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_EBELN.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S007&nbsp;WITH&nbsp;TEXT-M01&nbsp;DISPLAY&nbsp;LIKE&nbsp;C_E.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_EKPO<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKPO01<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;WERKS&nbsp;=&nbsp;P_WERKS.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S007&nbsp;WITH&nbsp;TEXT-M02&nbsp;DISPLAY&nbsp;LIKE&nbsp;C_E.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;GS_LFA1<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZLFA1_01<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;=&nbsp;GS_EKKO-LIFNR.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S007&nbsp;WITH&nbsp;TEXT-M04&nbsp;DISPLAY&nbsp;LIKE&nbsp;C_E.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;GS_LFB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZLFB1_01<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;=&nbsp;GS_EKKO-LIFNR.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S007&nbsp;WITH&nbsp;TEXT-M04&nbsp;DISPLAY&nbsp;LIKE&nbsp;C_E.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;GS_LFM1<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZLFM1_01<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;=&nbsp;GS_EKKO-LIFNR.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;S007&nbsp;WITH&nbsp;TEXT-M04&nbsp;DISPLAY&nbsp;LIKE&nbsp;C_E.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_ZMAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMAT01<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;WERKS&nbsp;=&nbsp;P_WERKS.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;###&nbsp;####&nbsp;######&nbsp;####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_DATA .<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_HEADER_DATA.<br />
&nbsp;&nbsp;IF&nbsp;GV_MODE&nbsp;=&nbsp;C_CRUD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_ITEM_DATA.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_GLA_DATA.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_MAT_DATA.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALL_SCREEN<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALL_SCREEN .<br />
&nbsp;&nbsp;IF&nbsp;GV_MODE&nbsp;=&nbsp;C_CRUD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;0100.<br />
&nbsp;&nbsp;ELSEIF&nbsp;GV_MODE&nbsp;=&nbsp;C_DISP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;0300.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CREATE_OBJECT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CREATE_OBJECT USING    PV_CONTAINER_NAME TYPE C<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;PV_CUSTOM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_GUI_CUSTOM_CONTAINER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PV_GRID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_GUI_ALV_GRID.<br />
<br />
&nbsp;&nbsp;"&nbsp;CUSTOM&nbsp;CONTAINER&nbsp;##<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;PV_CUSTOM<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;=&nbsp;PV_CONTAINER_NAME.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'CUSTOM&nbsp;CONTAINER&nbsp;##&nbsp;##'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;ALV&nbsp;GRID&nbsp;##<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;PV_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;=&nbsp;PV_CUSTOM.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'ALV&nbsp;GRID&nbsp;##&nbsp;##'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FIELD_CATALOG_CON1<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FIELD_CATALOG_CON1 .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT&nbsp;,&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'LINE_NUM'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'OK'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'L_CHECK'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CHECKBOX&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'NETWR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'NETPR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_TABLE&nbsp;=&nbsp;'ZMAT01'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_FIELD&nbsp;=&nbsp;'STPRS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'######'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IV_QTY'.<br />
&nbsp;&nbsp;GS_FIELDCAT-QFIELDNAME&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;=&nbsp;'ZEKPO01'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'PO##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-QFIELDNAME&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;=&nbsp;'ZEKPO01'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IV_REM_QTY'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;=&nbsp;'ZEKPO01'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-QFIELDNAME&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IV_DONE_QTY'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'#####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;=&nbsp;'ZEKPO01'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-QFIELDNAME&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EBELN'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EBELP'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;GS_FIELDCAT-NO_ZERO&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MAKTX'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;30.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FIELD_CATALOG_DISP<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FIELD_CATALOG_DISP .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT&nbsp;,&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'LINE_NUM'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MODE_TX'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'OK'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'L_CHECK'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CHECKBOX&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WRBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'NETPR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'######'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'IV_QTY'.<br />
&nbsp;&nbsp;GS_FIELDCAT-QFIELDNAME&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;=&nbsp;'ZEKPO01'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'PO##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-QFIELDNAME&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_TABLE&nbsp;&nbsp;&nbsp;=&nbsp;'ZEKPO01'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_FIELD&nbsp;&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EBELN'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BELNR'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;GS_FIELDCAT-NO_ZERO&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MAKTX'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;30.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_FIELDCAT_FI<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SET_FIELDCAT_FI .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT&nbsp;,&nbsp;GT_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BUZEI'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'PK'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BSCHL'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##/#####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'SHKZG'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;&nbsp;14.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'HKONT'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'SGTXT'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;&nbsp;30.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####&nbsp;##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WRBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT_MASK&nbsp;=&nbsp;'==RR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-DO_SUM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;&nbsp;20.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####&nbsp;##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'DMBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS_D'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT_MASK&nbsp;=&nbsp;'==RR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-DO_SUM&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;&nbsp;20.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WAERS_D'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MWSKZ'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FIELD_CATALOG_CON2<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FIELD_CATALOG_CON2 .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT2&nbsp;,&nbsp;GT_FIELDCAT2.<br />
<br />
&nbsp;&nbsp;GS_FIELDCAT2-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;GS_FIELDCAT2-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT2-FIELDNAME&nbsp;=&nbsp;'MWSKZ'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT2&nbsp;TO&nbsp;GT_FIELDCAT2.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT2.<br />
&nbsp;&nbsp;GS_FIELDCAT2-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;GS_FIELDCAT2-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT2-FIELDNAME&nbsp;=&nbsp;'TEXT'.<br />
&nbsp;&nbsp;GS_FIELDCAT2-OUTPUTLEN&nbsp;=&nbsp;30.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT2&nbsp;TO&nbsp;GT_FIELDCAT2.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_FCAT_MAT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SET_FCAT_MAT .<br />
&nbsp;&nbsp;CLEAR&nbsp;GT_FIELDCAT.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'LINE_NUM'&nbsp;'##'&nbsp;''&nbsp;''&nbsp;''&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'L_CHECK'&nbsp;'OK'&nbsp;&nbsp;&nbsp;''&nbsp;'X'&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'MATNR'&nbsp;'##'&nbsp;''&nbsp;'&nbsp;'&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'WERKS'&nbsp;'Plnt'&nbsp;''&nbsp;'&nbsp;'&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'BWKEY'&nbsp;'##&nbsp;##'&nbsp;''&nbsp;'&nbsp;'&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'SHKZG'&nbsp;'D/C'&nbsp;''&nbsp;'&nbsp;'&nbsp;'X'&nbsp;'1'.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'WRBTR'&nbsp;'##'&nbsp;'CURR'&nbsp;'&nbsp;'&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'MENGE'&nbsp;'##'&nbsp;''&nbsp;'&nbsp;'&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'MEINS'&nbsp;'##&nbsp;##'&nbsp;''&nbsp;'&nbsp;'&nbsp;''&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'MWSKZ'&nbsp;'##&nbsp;##'&nbsp;''&nbsp;'&nbsp;'&nbsp;'X'&nbsp;''.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_FCAT_GLA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SET_FCAT_GLA .<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'LINE_NUM'&nbsp;'##'&nbsp;''&nbsp;''&nbsp;''&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'L_CHECK'&nbsp;&nbsp;'OK'&nbsp;&nbsp;&nbsp;''&nbsp;'X'&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'HKONT'&nbsp;&nbsp;&nbsp;&nbsp;'G/L&nbsp;##'&nbsp;''&nbsp;''&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'SGTXT'&nbsp;&nbsp;&nbsp;&nbsp;'##'&nbsp;''&nbsp;''&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'SHKZG'&nbsp;&nbsp;&nbsp;&nbsp;'D/C'&nbsp;''&nbsp;''&nbsp;'X'&nbsp;'1'.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'WRBTR'&nbsp;&nbsp;&nbsp;&nbsp;'##&nbsp;##&nbsp;##'&nbsp;'CURR'&nbsp;''&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'DMBTR'&nbsp;&nbsp;&nbsp;&nbsp;'##(##&nbsp;##)'&nbsp;'CURR'&nbsp;''&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'MWSKZ'&nbsp;&nbsp;&nbsp;&nbsp;'##&nbsp;##'&nbsp;''&nbsp;''&nbsp;'X'&nbsp;''.<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_FCAT&nbsp;USING&nbsp;'TXJCD'&nbsp;&nbsp;&nbsp;&nbsp;'##&nbsp;##&nbsp;##'&nbsp;''&nbsp;''&nbsp;'X'&nbsp;''.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ADD_FCAT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ADD_FCAT USING PV_FIELD<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PV_TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PV_DATATYPE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PV_CHECKBOX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PV_EDIT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PV_DROPDOWN.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;#&nbsp;###<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;PV_FIELD.<br />
&nbsp;&nbsp;GS_FIELDCAT-SCRTEXT_M&nbsp;=&nbsp;PV_TEXT.<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;PV_DATATYPE&nbsp;=&nbsp;'CURR'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;15.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;####<br />
&nbsp;&nbsp;IF&nbsp;PV_CHECKBOX&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FIELDCAT-CHECKBOX&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;PV_EDIT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;&nbsp;####&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;PV_DROPDOWN&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FIELDCAT-DRDN_FIELD&nbsp;=&nbsp;'DROPN'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_LAYOUT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SET_LAYOUT CHANGING PS_LAYOUT TYPE LVC_S_LAYO.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;PS_LAYOUT.<br />
&nbsp;&nbsp;PS_LAYOUT-ZEBRA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;PS_LAYOUT-NO_TOOLBAR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;PS_LAYOUT-STYLEFNAME&nbsp;=&nbsp;'CELLTAB'.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_DISPLAY_CON1<br />
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_DISPLAY<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_DISPLAY USING    PV_GRID      TYPE REF TO CL_GUI_ALV_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_LAYO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;PT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PT_FIELDCAT&nbsp;&nbsp;TYPE&nbsp;LVC_T_FCAT.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;PV_GRID-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_DEFAULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PT_OUTTAB<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;=&nbsp;PT_FIELDCAT.<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_ZTERM_TX<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_GS_HEADER_100_ZTERM&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_ZTERM_TX  USING    P_ZTERM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_TEXT.<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZTERM01_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;P_TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZTERM&nbsp;=&nbsp;P_ZTERM.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_BUKRS_TX<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_BUKRS_TX  USING    P_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_TEXT.<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZTBUKRS01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;P_TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BUKRS&nbsp;=&nbsp;P_BUKRS.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALCULATE_WITH_TAX<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALCULATE_WITH_TAX .<br />
&nbsp;&nbsp;IF&nbsp;P_LIST&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'#####&nbsp;######'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_TAX_CHECK&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;CAL_BALANCE_WITH_TAX&nbsp;USING&nbsp;P_LIST&nbsp;CHANGING&nbsp;GS_HEADER_100-WMWST&nbsp;GS_HEADER_100-PRICE_SUM.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALCULATE_WITHOUT_TAX<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALCULATE_WITHOUT_TAX .<br />
&nbsp;&nbsp;GS_HEADER_100-WMWST&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;PERFORM&nbsp;REFRESH_BALANCE_DATA.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;CAL_BALANCE_WITH_TAX<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CAL_BALANCE_WITH_TAX  USING    P_LIST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_WMWST&nbsp;P_PRICE_SUM.<br />
&nbsp;&nbsp;CASE&nbsp;P_LIST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_WMWST&nbsp;=&nbsp;P_PRICE_SUM&nbsp;*&nbsp;'0.1'.<br />
&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;PERFORM&nbsp;REFRESH_BALANCE_DATA.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;REFRESH_BALANCE_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM REFRESH_BALANCE_DATA .<br />
&nbsp;&nbsp;GS_HEADER_100-BALANCE&nbsp;=&nbsp;GS_HEADER_100-AMOUNT&nbsp;-&nbsp;(&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;+&nbsp;GS_HEADER_100-WMWST&nbsp;+&nbsp;GS_HEADER_100-FRTWR&nbsp;).<br />
&nbsp;&nbsp;IF&nbsp;GS_HEADER_100-BALANCE&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_ICON_STATUS&nbsp;=&nbsp;'@08@'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_ICON_STATUS&nbsp;=&nbsp;'@0A@'.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_HEADER_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_HEADER_DATA .<br />
&nbsp;&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;GS_HEADER_100-BALANCE&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;GS_HEADER_100-SALE_TX&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;GS_HEADER_100-BLART&nbsp;=&nbsp;'RE'.<br />
&nbsp;&nbsp;IF&nbsp;GS_HEADER_100-WAERS&nbsp;=&nbsp;C_WAERS_D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-KURSF&nbsp;=&nbsp;'1.00'.<br />
&nbsp;&nbsp;ENDIF.<br />
"---------------------------------------------------------<br />
"  ## #### - ##### ####<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_EKKO&nbsp;TO&nbsp;GS_HEADER_100.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_LFA1&nbsp;TO&nbsp;GS_HEADER_100.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_LFB1&nbsp;TO&nbsp;GS_HEADER_100.<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_LFM1&nbsp;TO&nbsp;GS_HEADER_100.<br />
"---------------------------------------------------------<br />
"  ## #### - ## ### ####<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;ZTAXCODE01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_TAXCODE.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_BANK_TX&nbsp;USING&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-BANKL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_HEADER_100-BANKL_TX.<br />
<br />
"---------------------------------------------------------<br />
"  ## ## TEXT ##<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_ZTERM_TX&nbsp;USING&nbsp;GS_HEADER_100-ZTERM&nbsp;CHANGING&nbsp;GS_HEADER_100-ZTERM_TX.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_BUKRS_TX&nbsp;USING&nbsp;GS_HEADER_100-BUKRS&nbsp;CHANGING&nbsp;GS_HEADER_100-BUKRS_TX.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_ITEM_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_ITEM_DATA .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_NUM&nbsp;TYPE&nbsp;ZEKPO01-EBELP&nbsp;VALUE&nbsp;1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE&nbsp;TYPE&nbsp;LVC_S_STYL.<br />
"---------------------------------------------------------<br />
"  PO - #### ### ####<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_EKPO&nbsp;INTO&nbsp;GS_EKPO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_DISP_100.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_EKPO&nbsp;TO&nbsp;GS_DISP_100.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-LINE_NUM&nbsp;=&nbsp;LV_NUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-WAERS&nbsp;=&nbsp;GS_EKKO-WAERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-L_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_IV_QTY&nbsp;&nbsp;&nbsp;USING&nbsp;&nbsp;&nbsp;&nbsp;GS_EKPO-EBELN&nbsp;GS_EKPO-EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_DISP_100-IV_DONE_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_BKLAS&nbsp;USING&nbsp;GS_DISP_100-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_DISP_100-BKLAS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-IV_REM_QTY&nbsp;=&nbsp;GS_DISP_100-MENGE&nbsp;-&nbsp;GS_DISP_100-IV_DONE_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-IV_QTY&nbsp;=&nbsp;GS_DISP_100-IV_REM_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_NUM&nbsp;=&nbsp;LV_NUM&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DISP_100-IV_REM_QTY&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE-FIELDNAME&nbsp;=&nbsp;'L_CHECK'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE-STYLE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_DISABLED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;LS_STYLE&nbsp;INTO&nbsp;TABLE&nbsp;GS_DISP_100-CELLTAB.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE-FIELDNAME&nbsp;=&nbsp;'NETPR'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE-STYLE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_DISABLED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;LS_STYLE&nbsp;INTO&nbsp;TABLE&nbsp;GS_DISP_100-CELLTAB.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE-FIELDNAME&nbsp;=&nbsp;'IV_QTY'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE-STYLE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_DISABLED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;LS_STYLE&nbsp;INTO&nbsp;TABLE&nbsp;GS_DISP_100-CELLTAB.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-L_CHECK&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;=&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;+&nbsp;GS_EKPO-NETWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_DISP_100&nbsp;TO&nbsp;GT_DISP_100.<br />
&nbsp;&nbsp;ENDLOOP.<br />
"---------------------------------------------------------<br />
"  #### ##### ####<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;GS_HEADER_100-BUDAT&nbsp;=&nbsp;P_BUDAT.<br />
&nbsp;&nbsp;GS_HEADER_100-BLDAT&nbsp;=&nbsp;P_BUDAT.<br />
"---------------------------------------------------------<br />
"  ##(Balance) ##<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;GS_HEADER_100-BALANCE&nbsp;=&nbsp;GS_HEADER_100-BALANCE&nbsp;-&nbsp;GS_HEADER_100-PRICE_SUM.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_GLA_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_GLA_DATA .<br />
&nbsp;&nbsp;CLEAR&nbsp;GT_GLA.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_LINE_NUM&nbsp;TYPE&nbsp;CHAR4&nbsp;VALUE&nbsp;1.<br />
&nbsp;&nbsp;DO&nbsp;10&nbsp;TIMES.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_GLA.&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;###&nbsp;##&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_GLA-LINE_NUM&nbsp;=&nbsp;LV_LINE_NUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_GLA-DROPN&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_GLA&nbsp;TO&nbsp;GT_GLA.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_LINE_NUM&nbsp;=&nbsp;LV_LINE_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDDO.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_MAT_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_MAT_DATA .<br />
&nbsp;&nbsp;CLEAR&nbsp;GT_MAT.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_LINE_NUM&nbsp;TYPE&nbsp;CHAR4&nbsp;VALUE&nbsp;1.<br />
&nbsp;&nbsp;DO&nbsp;10&nbsp;TIMES.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_MAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MAT-LINE_NUM&nbsp;=&nbsp;LV_LINE_NUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MAT-SHKZG&nbsp;=&nbsp;'S'.&nbsp;&nbsp;"&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MAT-DROPN&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MAT&nbsp;TO&nbsp;GT_MAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_LINE_NUM&nbsp;=&nbsp;LV_LINE_NUM&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDDO.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_DROPDOWN_SHKZG<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SET_DROPDOWN_SHKZG .<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;LT_DROPDOWN&nbsp;TYPE&nbsp;LVC_T_DROP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_DROPDOWN&nbsp;TYPE&nbsp;LVC_S_DROP.<br />
<br />
&nbsp;&nbsp;"##&nbsp;1:<br />
&nbsp;&nbsp;LS_DROPDOWN-HANDLE&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;LS_DROPDOWN-VALUE&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_DROPDOWN&nbsp;TO&nbsp;LT_DROPDOWN.<br />
<br />
&nbsp;&nbsp;LS_DROPDOWN-HANDLE&nbsp;=&nbsp;'1'.<br />
&nbsp;&nbsp;LS_DROPDOWN-VALUE&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_DROPDOWN&nbsp;TO&nbsp;LT_DROPDOWN.<br />
<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;SET_DROP_DOWN_TABLE<br />
&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_DROP_DOWN&nbsp;=&nbsp;LT_DROPDOWN.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_HANDLER_DATA_CHANGED<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_HANDLER_DATA_CHANGED  USING    P_DATA_CHANGED TYPE REF TO CL_ALV_CHANGED_DATA_PROTOCOL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_ONF4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_ONF4_BEFORE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_ONF4_AFTER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_UCOMM.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_MODI&nbsp;TYPE&nbsp;LVC_S_MODI.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_IV_QTY&nbsp;TYPE&nbsp;ZEKPO01-MENGE.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_NETPR&nbsp;&nbsp;TYPE&nbsp;ZEKPO01-NETPR.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_CHECK&nbsp;TYPE&nbsp;CHAR1.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;P_DATA_CHANGED-&gt;MT_GOOD_CELLS&nbsp;INTO&nbsp;LS_MODI.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_MODI-FIELDNAME&nbsp;=&nbsp;'L_CHECK'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_CHECK&nbsp;=&nbsp;LS_MODI-VALUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_DISP_100&nbsp;INTO&nbsp;GS_DISP_100&nbsp;INDEX&nbsp;LS_MODI-ROW_ID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GV_MODE&nbsp;=&nbsp;C_CRUD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_CHECK&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;=&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;-&nbsp;GS_DISP_100-NETWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;LV_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;=&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;+&nbsp;GS_DISP_100-NETWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;LS_MODI-FIELDNAME&nbsp;=&nbsp;'IV_QTY'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_IV_QTY&nbsp;=&nbsp;LS_MODI-VALUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_DISP_100&nbsp;INTO&nbsp;GS_DISP_100&nbsp;INDEX&nbsp;LS_MODI-ROW_ID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DISP_100-L_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;=&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;-&nbsp;GS_DISP_100-NETWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_IV_QTY&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;RESET_CELL&nbsp;USING&nbsp;P_DATA_CHANGED&nbsp;LS_MODI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_ERROR_FLAG&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;LV_IV_QTY&nbsp;&gt;&nbsp;GS_DISP_100-IV_REM_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;RESET_CELL&nbsp;USING&nbsp;P_DATA_CHANGED&nbsp;LS_MODI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_ERROR_FLAG&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-NETWR&nbsp;=&nbsp;LV_IV_QTY&nbsp;*&nbsp;GS_DISP_100-NETPR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DISP_100-L_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;=&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;+&nbsp;GS_DISP_100-NETWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;LS_MODI-FIELDNAME&nbsp;=&nbsp;'NETPR'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_NETPR&nbsp;=&nbsp;LS_MODI-VALUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_DISP_100&nbsp;INTO&nbsp;GS_DISP_100&nbsp;INDEX&nbsp;LS_MODI-ROW_ID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DISP_100-L_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;=&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;-&nbsp;GS_DISP_100-NETWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-NETWR&nbsp;=&nbsp;GS_DISP_100-IV_QTY&nbsp;*&nbsp;LV_NETPR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DISP_100-L_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;=&nbsp;GS_HEADER_100-PRICE_SUM&nbsp;+&nbsp;GS_DISP_100-NETWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_DISP_100&nbsp;FROM&nbsp;GS_DISP_100&nbsp;INDEX&nbsp;LS_MODI-ROW_ID.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;IF&nbsp;GV_MODE&nbsp;=&nbsp;C_CRUD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;CAL_BALANCE_WITH_TAX&nbsp;USING&nbsp;P_LIST&nbsp;CHANGING&nbsp;GS_HEADER_100-WMWST&nbsp;GS_HEADER_100-PRICE_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;REFRESH_BALANCE_DATA.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_DATA_CHANGED_FINISHED<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_DATA_CHANGED_FINISHED  USING    P_E_MODIFIED<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_ET_GOOD_CELLS.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;CL_GUI_CFW=&gt;SET_NEW_OK_CODE<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;NEW_CODE&nbsp;=&nbsp;'REFR'.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;REFRESH.<br />
&nbsp;&nbsp;CASE&nbsp;GV_ERROR_FLAG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'1'.&nbsp;MESSAGE&nbsp;'#####&nbsp;0##&nbsp;#####'&nbsp;TYPE&nbsp;'I'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'2'.&nbsp;MESSAGE&nbsp;'#####&nbsp;##&nbsp;###&nbsp;###&nbsp;#&nbsp;####'&nbsp;TYPE&nbsp;'I'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;ENDCASE.<br />
&nbsp;&nbsp;GV_ERROR_FLAG&nbsp;=&nbsp;0.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;REFRESH<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM REFRESH .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_STABLE&nbsp;TYPE&nbsp;LVC_S_STBL.<br />
&nbsp;&nbsp;LS_STABLE-ROW&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LS_STABLE-COL&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_STABLE<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_SOFT_REFRESH&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FINISHED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CLASS_EVENT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CLASS_EVENT .<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_EVENT.<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_EVENT-&gt;HANDLER_TOOLBAR&nbsp;FOR&nbsp;GC_GRID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;REGISTER_EDIT_EVENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EVENT_ID&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_EVT_MODIFIED<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
   </div>
   <div class="code">
&nbsp;&nbsp;.<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_EVENT-&gt;HANDLER_DATA_CHANGED&nbsp;FOR&nbsp;GC_GRID.<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_EVENT-&gt;HANDLER_DATA_CHANGED_FINISHED&nbsp;FOR&nbsp;GC_GRID.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_IV_QTY<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_IV_QTY  USING    P_EBELN P_EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_DONE_QTY.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;P_DONE_QTY.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LV_IV_POS&nbsp;TYPE&nbsp;MENGE_D,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_IV_NEG&nbsp;TYPE&nbsp;MENGE_D.<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;##(##&nbsp;IR)&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;SELECT&nbsp;SUM(&nbsp;MENGE&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_IV_POS<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG01<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EBELP&nbsp;=&nbsp;P_EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SHKZG&nbsp;=&nbsp;'S'.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LV_IV_POS.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;##(CREDIT&nbsp;MEMO&nbsp;OR&nbsp;IR&nbsp;REVERSAL)<br />
&nbsp;&nbsp;SELECT&nbsp;SUM(&nbsp;MENGE&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_IV_NEG<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG01<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EBELP&nbsp;=&nbsp;P_EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;XREVR&nbsp;=&nbsp;'X'.&nbsp;&nbsp;"&nbsp;##&nbsp;INDICATOR<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LV_IV_NEG.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;P_DONE_QTY&nbsp;=&nbsp;LV_IV_POS&nbsp;-&nbsp;LV_IV_NEG.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;RESET_CELL<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_P_DATA_CHANGED&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_LS_MODI&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM RESET_CELL USING P_DATA_CHANGED TYPE REF TO CL_ALV_CHANGED_DATA_PROTOCOL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PS_MODI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;LVC_S_MODI.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;P_DATA_CHANGED-&gt;MODIFY_CELL<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_ROW_ID&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PS_MODI-ROW_ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_FIELDNAME&nbsp;=&nbsp;PS_MODI-FIELDNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_VALUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;''.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHECK_INVOCE_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CHECK_INVOCE_DATA .<br />
&nbsp;&nbsp;IF&nbsp;GV_MODE&nbsp;=&nbsp;C_CRUD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;ZRSEG01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@GT_RSEG<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;@P_EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;WERKS&nbsp;=&nbsp;@P_WERKS.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_RSEG&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'#####&nbsp;&nbsp;####&nbsp;####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRBKP01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;@GT_RBKP<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;@GT_RSEG<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;@GT_RSEG-BELNR.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_RBKP&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'#####&nbsp;####&nbsp;####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;LIST-PROCESSING.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALCULATE_TAX_ITEM<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;P_GS_HEADER_100_MWSKZ&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;--P_GS_DISP_100_NETWR&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALCULATE_TAX_ITEM  USING    P_MWSKZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_NETWR.<br />
&nbsp;&nbsp;CASE&nbsp;P_MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V1'.&nbsp;P_NETWR&nbsp;=&nbsp;P_NETWR&nbsp;*&nbsp;'1.1'.<br />
&nbsp;&nbsp;ENDCASE.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;TREE_HANDLER_ITEM_DOUBLE_CLICK<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM TREE_HANDLER_ITEM_DOUBLE_CLICK  USING    P_NODE_KEY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_ITEM_NAME.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LT_RSEG&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZRSEG01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG&nbsp;TYPE&nbsp;ZRSEG01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG2&nbsp;TYPE&nbsp;ZRSEG01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP&nbsp;TYPE&nbsp;ZRBKP01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MAKTX&nbsp;TYPE&nbsp;ZMAT01-MAKTX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE&nbsp;TYPE&nbsp;LVC_S_STYL.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_EKPO&nbsp;TYPE&nbsp;ZEKPO01.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_EDIT_FLAG&nbsp;TYPE&nbsp;ABAP_BOOL&nbsp;VALUE&nbsp;ABAP_TRUE.<br />
<br />
&nbsp;&nbsp;IF&nbsp;P_NODE_KEY&nbsp;=&nbsp;P_EBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_RSEG<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;P_NODE_KEY.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRBKP01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;LS_RBKP<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;P_NODE_KEY.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LT_RSEG&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;#####&nbsp;###&nbsp;####&nbsp;####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_RBKP&nbsp;TO&nbsp;GS_HEADER_100.<br />
&nbsp;&nbsp;GS_HEADER_100-AMOUNT&nbsp;=&nbsp;LS_RBKP-RMWWR.<br />
&nbsp;&nbsp;P_LIST&nbsp;=&nbsp;GS_HEADER_100-MWSKZ.<br />
&nbsp;&nbsp;IF&nbsp;P_LIST&nbsp;=&nbsp;'V1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GV_TAX_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GT_DISP_100.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_RSEG&nbsp;INTO&nbsp;LS_RSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;GS_DISP_100,&nbsp;GS_EKPO,&nbsp;GS_ZMAT,LV_EDIT_FLAG.<br />
"-------------------------------------------------------<br />
" ## ## ##<br />
"-------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-LINE_NUM&nbsp;=&nbsp;LS_RSEG-BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;1)&nbsp;####&nbsp;##&nbsp;##<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-BELNR&nbsp;&nbsp;=&nbsp;LS_RSEG-BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-GJAHR&nbsp;&nbsp;=&nbsp;LS_RSEG-GJAHR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-BUZEI&nbsp;&nbsp;=&nbsp;LS_RSEG-BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-EBELN&nbsp;&nbsp;=&nbsp;LS_RSEG-EBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-EBELP&nbsp;&nbsp;=&nbsp;LS_RSEG-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-WERKS&nbsp;&nbsp;=&nbsp;LS_RSEG-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-LGORT&nbsp;&nbsp;=&nbsp;LS_RSEG-LGORT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-IV_QTY&nbsp;=&nbsp;LS_RSEG-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-WRBTR&nbsp;&nbsp;=&nbsp;LS_RSEG-WRBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-MATNR&nbsp;&nbsp;=&nbsp;LS_RSEG-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-MWSKZ&nbsp;&nbsp;=&nbsp;LS_RSEG-MWSKZ.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_EKPO&nbsp;INTO&nbsp;GS_EKPO<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;EBELN&nbsp;=&nbsp;LS_RSEG-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EBELP&nbsp;=&nbsp;LS_RSEG-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-WAERS&nbsp;=&nbsp;GS_EKKO-WAERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-MENGE&nbsp;=&nbsp;GS_EKPO-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-MEINS&nbsp;=&nbsp;GS_EKPO-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-NETPR&nbsp;=&nbsp;GS_EKPO-NETPR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;3)&nbsp;##&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ZMAT&nbsp;INTO&nbsp;GS_ZMAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;KEY&nbsp;MATNR&nbsp;=&nbsp;LS_RSEG-MATNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-MAKTX&nbsp;=&nbsp;GS_ZMAT-MAKTX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-BKLAS&nbsp;=&nbsp;GS_ZMAT-BKLAS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_IV_QTY&nbsp;&nbsp;&nbsp;USING&nbsp;&nbsp;&nbsp;&nbsp;GS_EKPO-EBELN&nbsp;GS_EKPO-EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_DISP_100-IV_DONE_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_BKLAS&nbsp;USING&nbsp;GS_DISP_100-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_DISP_100-BKLAS.<br />
<br />
"-------------------------------------------------------<br />
" ##### ## ### ## ###### ###<br />
"-------------------------------------------------------<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;LS_RSEG2<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;STBLG&nbsp;=&nbsp;P_NODE_KEY<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;MATNR&nbsp;=&nbsp;LS_RSEG-MATNR.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_EDIT_FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-MODE_TX&nbsp;=&nbsp;'##&nbsp;###'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
"-------------------------------------------------------<br />
"  #### ## ##<br />
"-------------------------------------------------------<br />
<br />
&nbsp;&nbsp;IF&nbsp;LS_RSEG-XREVR&nbsp;=&nbsp;'X'&nbsp;AND&nbsp;LV_EDIT_FLAG&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_EDIT_FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-MODE_TX&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;ENDIF.<br />
"-------------------------------------------------------<br />
"  ## ## ### ## ##<br />
"-------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;LV_EDIT_FLAG&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_DISP_100-MODE_TX&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
"-------------------------------------------------------<br />
" ## #### ## ## #### DISABLE ##<br />
"-------------------------------------------------------<br />
<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;LV_EDIT_FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE-FIELDNAME&nbsp;=&nbsp;'L_CHECK'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE-STYLE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_DISABLED.<br />
&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;LS_STYLE&nbsp;INTO&nbsp;TABLE&nbsp;GS_DISP_100-CELLTAB.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_DISP_100&nbsp;TO&nbsp;GT_DISP_100.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;PERFORM&nbsp;REFRESH.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CREATE_OBJECT_DISP<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CREATE_OBJECT_DISP .<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_CUSTOM<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARENT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'CON6'<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STYLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFETIME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LIFETIME_DEFAULT<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DYNNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NO_AUTODEF_PROGID_DYNNR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CNTL_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CNTL_SYSTEM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATE_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFETIME_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFETIME_DYNPRO_DYNPRO_LINK&nbsp;=&nbsp;5<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_TREE<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARENT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GC_CUSTOM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NODE_SELECTION_MODE&nbsp;&nbsp;&nbsp;=&nbsp;CL_GUI_COLUMN_TREE=&gt;NODE_SEL_MODE_SINGLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ITEM_SELECTION&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HIERARCHY_COLUMN_NAME&nbsp;=&nbsp;GV_HCOL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HIERARCHY_HEADER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GS_HEADER<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIFETIME_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CNTL_SYSTEM_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATE_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ILLEGAL_NODE_SELECTION_MODE&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FAILED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ILLEGAL_COLUMN_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_NODE<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FILL_NODE .<br />
&nbsp;&nbsp;CLEAR:&nbsp;GT_NODES,&nbsp;GT_ITEMS.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LS_NODE&nbsp;TYPE&nbsp;TREEV_NODE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ITEM&nbsp;TYPE&nbsp;MTREEITM.<br />
<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;1)&nbsp;PURCHASE&nbsp;ORDERS<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;CLEAR&nbsp;LS_NODE.<br />
&nbsp;&nbsp;LS_NODE-NODE_KEY&nbsp;&nbsp;=&nbsp;'PO_ROOT'.<br />
&nbsp;&nbsp;LS_NODE-ISFOLDER&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LS_NODE-N_IMAGE&nbsp;&nbsp;=&nbsp;C_ICON_NONE.<br />
&nbsp;&nbsp;LS_NODE-EXP_IMAGE&nbsp;=&nbsp;C_ICON_NONE.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_NODE&nbsp;TO&nbsp;GT_NODES.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;LS_ITEM.<br />
&nbsp;&nbsp;LS_ITEM-NODE_KEY&nbsp;&nbsp;=&nbsp;'PO_ROOT'.<br />
&nbsp;&nbsp;LS_ITEM-ITEM_NAME&nbsp;=&nbsp;GV_HCOL.<br />
&nbsp;&nbsp;LS_ITEM-TEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_ITEM&nbsp;TO&nbsp;GT_ITEMS.<br />
<br />
<br />
&nbsp;&nbsp;"&nbsp;PURCHASE&nbsp;ORDER&nbsp;##&nbsp;##<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;ADD_DOC&nbsp;USING&nbsp;'PO_ROOT'&nbsp;P_EBELN.<br />
<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;2)&nbsp;INVOCE&nbsp;DOCUMENTS<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;CLEAR&nbsp;LS_NODE.<br />
&nbsp;&nbsp;LS_NODE-NODE_KEY&nbsp;&nbsp;=&nbsp;'MM_ROOT'.<br />
&nbsp;&nbsp;LS_NODE-ISFOLDER&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LS_NODE-N_IMAGE&nbsp;&nbsp;=&nbsp;C_ICON_NONE.<br />
&nbsp;&nbsp;LS_NODE-EXP_IMAGE&nbsp;=&nbsp;C_ICON_NONE.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_NODE&nbsp;TO&nbsp;GT_NODES.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;LS_ITEM.<br />
&nbsp;&nbsp;LS_ITEM-NODE_KEY&nbsp;&nbsp;=&nbsp;'MM_ROOT'.<br />
&nbsp;&nbsp;LS_ITEM-ITEM_NAME&nbsp;=&nbsp;GV_HCOL.<br />
&nbsp;&nbsp;LS_ITEM-TEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_ITEM&nbsp;TO&nbsp;GT_ITEMS.<br />
<br />
<br />
&nbsp;&nbsp;"&nbsp;MATERIAL&nbsp;DOCUMENTS<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_RBKP&nbsp;INTO&nbsp;GS_RBKP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_RBKP-XREVR&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ADD_DOC&nbsp;USING&nbsp;'MM_ROOT'&nbsp;GS_RBKP-BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;3)&nbsp;CANCEL&nbsp;DOCUMENTS<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;CLEAR&nbsp;LS_NODE.<br />
&nbsp;&nbsp;LS_NODE-NODE_KEY&nbsp;&nbsp;=&nbsp;'MM_ROOT2'.<br />
&nbsp;&nbsp;LS_NODE-ISFOLDER&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LS_NODE-N_IMAGE&nbsp;&nbsp;=&nbsp;C_ICON_NONE.<br />
&nbsp;&nbsp;LS_NODE-EXP_IMAGE&nbsp;=&nbsp;C_ICON_NONE.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_NODE&nbsp;TO&nbsp;GT_NODES.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;LS_ITEM.<br />
&nbsp;&nbsp;LS_ITEM-NODE_KEY&nbsp;&nbsp;=&nbsp;'MM_ROOT2'.<br />
&nbsp;&nbsp;LS_ITEM-ITEM_NAME&nbsp;=&nbsp;GV_HCOL.<br />
&nbsp;&nbsp;LS_ITEM-TEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_ITEM&nbsp;TO&nbsp;GT_ITEMS.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_RBKP&nbsp;INTO&nbsp;GS_RBKP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_RBKP-XREVR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ADD_DOC&nbsp;USING&nbsp;'MM_ROOT2'&nbsp;GS_RBKP-BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;GO_TREE-&gt;ADD_NODES_AND_ITEMS(<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NODE_TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_NODES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ITEM_TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_ITEMS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ITEM_TABLE_STRUCTURE_NAME&nbsp;=&nbsp;'MTREEITM'<br />
&nbsp;&nbsp;).<br />
<br />
<br />
&nbsp;&nbsp;GO_TREE-&gt;EXPAND_ROOT_NODES(&nbsp;LEVEL_COUNT&nbsp;=&nbsp;1&nbsp;).<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CLASS_EVENT_0100<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CLASS_EVENT_0100 .<br />
&nbsp;&nbsp;DATA&nbsp;LT_EVENTS&nbsp;TYPE&nbsp;CNTL_SIMPLE_EVENTS.<br />
&nbsp;&nbsp;LT_EVENTS&nbsp;=&nbsp;VALUE&nbsp;#(<br />
&nbsp;&nbsp;(&nbsp;EVENTID&nbsp;=&nbsp;CL_GUI_COLUMN_TREE=&gt;EVENTID_NODE_DOUBLE_CLICK&nbsp;APPL_EVENT&nbsp;=&nbsp;'X'&nbsp;)<br />
&nbsp;&nbsp;(&nbsp;EVENTID&nbsp;=&nbsp;CL_GUI_COLUMN_TREE=&gt;EVENTID_ITEM_DOUBLE_CLICK&nbsp;APPL_EVENT&nbsp;=&nbsp;'X'&nbsp;)<br />
&nbsp;&nbsp;).<br />
<br />
&nbsp;&nbsp;GO_TREE-&gt;SET_REGISTERED_EVENTS(&nbsp;EXPORTING&nbsp;EVENTS&nbsp;=&nbsp;LT_EVENTS&nbsp;).<br />
<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_TREE_EVENT.<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_TREE_EVENT-&gt;ON_ITEM_DOUBLE_CLICK&nbsp;FOR&nbsp;GO_TREE.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORM&nbsp;&nbsp;ADD_DOC<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ADD_DOC USING PV_PARENT PV_DOC.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_NODE&nbsp;TYPE&nbsp;TREEV_NODE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_ITEM&nbsp;TYPE&nbsp;MTREEITM.<br />
<br />
&nbsp;&nbsp;"##&nbsp;##&nbsp;(##)<br />
&nbsp;&nbsp;CLEAR&nbsp;LS_NODE.<br />
&nbsp;&nbsp;LS_NODE-NODE_KEY&nbsp;&nbsp;=&nbsp;PV_DOC.<br />
&nbsp;&nbsp;LS_NODE-RELATKEY&nbsp;&nbsp;=&nbsp;PV_PARENT.<br />
&nbsp;&nbsp;LS_NODE-RELATSHIP&nbsp;=&nbsp;CL_GUI_COLUMN_TREE=&gt;RELAT_LAST_CHILD.<br />
&nbsp;&nbsp;LS_NODE-ISFOLDER&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;LS_NODE-N_IMAGE&nbsp;&nbsp;=&nbsp;C_ICON_NONE.<br />
&nbsp;&nbsp;LS_NODE-EXP_IMAGE&nbsp;=&nbsp;C_ICON_NONE.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_NODE&nbsp;TO&nbsp;GT_NODES.<br />
<br />
&nbsp;&nbsp;"###&nbsp;##&nbsp;(##&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;CLEAR&nbsp;LS_ITEM.<br />
&nbsp;&nbsp;LS_ITEM-NODE_KEY&nbsp;&nbsp;=&nbsp;PV_DOC.<br />
&nbsp;&nbsp;LS_ITEM-ITEM_NAME&nbsp;=&nbsp;GV_HCOL.<br />
&nbsp;&nbsp;LS_ITEM-TEXT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;PV_DOC.<br />
&nbsp;&nbsp;APPEND&nbsp;LS_ITEM&nbsp;TO&nbsp;GT_ITEMS.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CLEAR_ALV<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CLEAR_ALV .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GT_DISP_100.<br />
&nbsp;&nbsp;PERFORM&nbsp;REFRESH.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;POST_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM POST_DATA .<br />
&nbsp;DATA&nbsp;:&nbsp;LV_CHECK_FLAG&nbsp;TYPE&nbsp;C&nbsp;LENGTH&nbsp;1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_BELNR&nbsp;TYPE&nbsp;ZRBKP01-BELNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;TYPE&nbsp;ZRSEG01-BUZEI&nbsp;VALUE&nbsp;10.<br />
<br />
"---------------------------------------------------------<br />
"  ### ##<br />
"---------------------------------------------------------<br />
<br />
&nbsp;LOOP&nbsp;AT&nbsp;GT_DISP_100&nbsp;INTO&nbsp;GS_DISP_100.<br />
&nbsp;&nbsp;IF&nbsp;GS_DISP_100-L_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_CHECK_FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;ENDLOOP.<br />
<br />
&nbsp;IF&nbsp;LV_CHECK_FLAG&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;#&nbsp;####&nbsp;###&nbsp;###&nbsp;###&nbsp;###'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;RETURN.<br />
&nbsp;ENDIF.<br />
<br />
"---------------------------------------------------------<br />
"  ## ## ##<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_NEW_BELNR&nbsp;USING&nbsp;C_NR_IV&nbsp;CHANGING&nbsp;LV_BELNR.<br />
<br />
"---------------------------------------------------------<br />
"  ## ## ##<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;GS_HEADER_100-CRNAME&nbsp;=&nbsp;SY-UNAME.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;###<br />
&nbsp;&nbsp;GS_HEADER_100-CRDATE&nbsp;=&nbsp;SY-DATUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;####<br />
&nbsp;&nbsp;GS_HEADER_100-CRZEIT&nbsp;=&nbsp;SY-UZEIT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;####<br />
<br />
&nbsp;&nbsp;GS_HEADER_100-BELNR&nbsp;=&nbsp;LV_BELNR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"####<br />
&nbsp;&nbsp;GS_HEADER_100-GJAHR&nbsp;=&nbsp;P_BUDAT(4).&nbsp;&nbsp;&nbsp;&nbsp;"####<br />
&nbsp;&nbsp;GS_HEADER_100-BLART&nbsp;=&nbsp;'RE'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"####<br />
&nbsp;"GS_HEADER_100-BLDAT&nbsp;=<br />
&nbsp;"GS_HEADER_100-BUDAT&nbsp;=<br />
<br />
&nbsp;&nbsp;GS_HEADER_100-RMWWR&nbsp;=&nbsp;GS_HEADER_100-AMOUNT.&nbsp;"#&nbsp;####&nbsp;=&nbsp;##&nbsp;##<br />
&nbsp;"GS_HEADER_100-WMWST&nbsp;=<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_HEADER_100&nbsp;TO&nbsp;GS_RBKP.<br />
&nbsp;&nbsp;INSERT&nbsp;ZRBKP01&nbsp;FROM&nbsp;GS_RBKP.<br />
"---------------------------------------------------------<br />
"  ## ## ##<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_DISP_100&nbsp;INTO&nbsp;GS_DISP_100.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DISP_100-L_CHECK&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_DISP_100&nbsp;TO&nbsp;GS_RSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BELNR&nbsp;=&nbsp;LV_BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-GJAHR&nbsp;=&nbsp;P_BUDAT(4).<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;CALCULATE_TAX_ITEM&nbsp;USING&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-MWSKZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_DISP_100-NETWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-WRBTR&nbsp;=&nbsp;GS_DISP_100-NETWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BUKRS&nbsp;=&nbsp;GS_HEADER_100-BUKRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-MWSKZ&nbsp;=&nbsp;GS_HEADER_100-MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-MENGE&nbsp;=&nbsp;GS_DISP_100-IV_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BSTME&nbsp;=&nbsp;GS_DISP_100-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BPMNG&nbsp;=&nbsp;GS_DISP_100-IV_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BPRME&nbsp;=&nbsp;GS_DISP_100-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-MEINS&nbsp;=&nbsp;GS_DISP_100-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BKLAS&nbsp;=&nbsp;GS_DISP_100-BKLAS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_RSEG&nbsp;TO&nbsp;GT_RSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;INSERT&nbsp;ZRSEG01&nbsp;FROM&nbsp;TABLE&nbsp;GT_RSEG.<br />
<br />
&nbsp;&nbsp;MESSAGE&nbsp;|&nbsp;####&nbsp;{&nbsp;GS_HEADER_100-BELNR&nbsp;}#(#)&nbsp;######|&nbsp;TYPE&nbsp;'S'.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;POST_CANCEL_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM POST_CANCEL_DATA .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_CHECK_FLAG&nbsp;TYPE&nbsp;CHAR1&nbsp;VALUE&nbsp;'&nbsp;',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;TYPE&nbsp;ZRSEG01-BUZEI&nbsp;VALUE&nbsp;10,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_BELNR&nbsp;TYPE&nbsp;ZRBKP01-BELNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_TEMP_BELNR&nbsp;TYPE&nbsp;ZRBKP01-BELNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_CANCEL_ITEM&nbsp;TYPE&nbsp;TY_100,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CANCEL_ITEM&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_CANCEL_ITEM.<br />
"---------------------------------------------------------<br />
" ## ## # ### ## ##<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_HEADER_100-RMWWR&nbsp;,&nbsp;GS_HEADER_100-WMWST,GT_RSEG,GS_RSEG,GT_RBKP,GS_RBKP.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_DISP_100&nbsp;INTO&nbsp;GS_DISP_100.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DISP_100-L_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_CHECK_FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-RMWWR&nbsp;=&nbsp;GS_HEADER_100-RMWWR&nbsp;+&nbsp;GS_DISP_100-WRBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_LIST&nbsp;=&nbsp;'V1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-WMWST&nbsp;=&nbsp;GS_HEADER_100-WMWST&nbsp;+&nbsp;GS_DISP_100-WRBTR&nbsp;*&nbsp;'0.1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_DISP_100&nbsp;TO&nbsp;LS_CANCEL_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_CANCEL_ITEM&nbsp;TO&nbsp;LT_CANCEL_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LV_CHECK_FLAG&nbsp;=&nbsp;'&nbsp;'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;###&nbsp;####'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
"---------------------------------------------------------<br />
" ###### ## 5300000000~ (06)<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_NEW_BELNR&nbsp;USING&nbsp;C_NR_IV_CANC&nbsp;CHANGING&nbsp;LV_BELNR&nbsp;.<br />
"---------------------------------------------------------<br />
" ## # ##<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;LV_TEMP_BELNR&nbsp;=&nbsp;GS_HEADER_100-BELNR.<br />
<br />
&nbsp;&nbsp;GS_HEADER_100-STBLG&nbsp;=&nbsp;LV_TEMP_BELNR.<br />
&nbsp;&nbsp;GS_HEADER_100-STJAH&nbsp;=&nbsp;SY-DATUM(4).<br />
&nbsp;&nbsp;GS_HEADER_100-XREVR&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;GS_HEADER_100-CRNAME&nbsp;=&nbsp;SY-UNAME.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;###<br />
&nbsp;&nbsp;GS_HEADER_100-CRDATE&nbsp;=&nbsp;SY-DATUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;####<br />
&nbsp;&nbsp;GS_HEADER_100-CRZEIT&nbsp;=&nbsp;SY-UZEIT.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;####<br />
<br />
&nbsp;&nbsp;GS_HEADER_100-BELNR&nbsp;=&nbsp;LV_BELNR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"####<br />
&nbsp;&nbsp;GS_HEADER_100-GJAHR&nbsp;=&nbsp;P_BUDAT(4).&nbsp;&nbsp;&nbsp;&nbsp;"####<br />
&nbsp;&nbsp;GS_HEADER_100-BLART&nbsp;=&nbsp;'RE'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"####<br />
<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_HEADER_100&nbsp;TO&nbsp;GS_RBKP.<br />
<br />
"---------------------------------------------------------<br />
" ## # ##<br />
"---------------------------------------------------------<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_CANCEL_ITEM&nbsp;INTO&nbsp;LS_CANCEL_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_CANCEL_ITEM&nbsp;TO&nbsp;GS_RSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BELNR&nbsp;=&nbsp;LV_BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-GJAHR&nbsp;=&nbsp;P_BUDAT(4).<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-WRBTR&nbsp;=&nbsp;LS_CANCEL_ITEM-WRBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BUKRS&nbsp;=&nbsp;GS_HEADER_100-BUKRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-WERKS&nbsp;=&nbsp;LS_CANCEL_ITEM-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-LGORT&nbsp;=&nbsp;LS_CANCEL_ITEM-LGORT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-MWSKZ&nbsp;=&nbsp;GS_HEADER_100-MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-MENGE&nbsp;=&nbsp;LS_CANCEL_ITEM-IV_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BSTME&nbsp;=&nbsp;LS_CANCEL_ITEM-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BPMNG&nbsp;=&nbsp;LS_CANCEL_ITEM-IV_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BPRME&nbsp;=&nbsp;LS_CANCEL_ITEM-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-MEINS&nbsp;=&nbsp;LS_CANCEL_ITEM-MEINS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-BKLAS&nbsp;=&nbsp;LS_CANCEL_ITEM-BKLAS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-STBLG&nbsp;=&nbsp;LV_TEMP_BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-STJAH&nbsp;=&nbsp;SY-DATUM(4).<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_RSEG-XREVR&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_RSEG&nbsp;TO&nbsp;GT_RSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_SIMU_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_SIMU_DATA .<br />
<br />
&nbsp;&nbsp;IF&nbsp;GS_HEADER_100-BALANCE&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;##&nbsp;0###&nbsp;###'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GS_HEADER_100-WAERS&nbsp;&lt;&gt;&nbsp;C_WAERS_D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_HEADER_100-KURSF&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'#####&nbsp;###&nbsp;####&nbsp;###&nbsp;#######.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GS_HEADER_100-WAERS&nbsp;&lt;&gt;&nbsp;C_WAERS_D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;CHECK_INCO&nbsp;USING&nbsp;GS_HEADER_100-INCO1&nbsp;GS_HEADER_100-FRTWR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GV_CHECK_FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;&nbsp;&nbsp;LV_PO_PR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-WRBTR,&nbsp;"PO&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_INV_PR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-WRBTR,&nbsp;"IV&nbsp;##<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_NET_FCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-WRBTR,&nbsp;"IV&nbsp;*&nbsp;MENGE&nbsp;(##&nbsp;###)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_GRIR_FCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-WRBTR,&nbsp;"##&nbsp;GR/IR&nbsp;(##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_PRD_FCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-WRBTR,&nbsp;"##&nbsp;PRD&nbsp;(##)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_GRIR_LCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR,&nbsp;"##&nbsp;GR/IR&nbsp;(##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_PRD_LCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR,&nbsp;"##&nbsp;PRD&nbsp;(##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_KDM_LCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR,&nbsp;"##&nbsp;KDM&nbsp;(##)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"###&nbsp;##/##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_FRT_FCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-WRBTR,&nbsp;"###(##)&nbsp;-&nbsp;##&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_FRT_LCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR,&nbsp;"###(##)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MWS_FCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR,&nbsp;"##(##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MWS_LCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR,&nbsp;"##(##)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_AP_FCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-WRBTR,&nbsp;"AP(##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_AP_LCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR,&nbsp;"AP(##)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_GR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BKPF-KURSF,&nbsp;&nbsp;&nbsp;&nbsp;"GR##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_IR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BKPF-KURSF,&nbsp;&nbsp;&nbsp;&nbsp;"IR##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_TAX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BKPF-KURSF.&nbsp;&nbsp;&nbsp;&nbsp;"##<br />
<br />
&nbsp;&nbsp;"##&nbsp;##(##&nbsp;##)<br />
&nbsp;&nbsp;DATA:&nbsp;&nbsp;&nbsp;LV_TOTAL_NET_FCY&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-WRBTR&nbsp;VALUE&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_TOTAL_GRIR_FCY&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-WRBTR&nbsp;VALUE&nbsp;0.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_BUZEI&nbsp;TYPE&nbsp;ZBSEG01-BUZEI&nbsp;VALUE&nbsp;1.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_KTOPL&nbsp;TYPE&nbsp;ZSKA1_01-KTOPL&nbsp;VALUE&nbsp;'ZCOA',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_KTOSL&nbsp;TYPE&nbsp;ZSKA1_01-KTOSL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_BKLAS&nbsp;TYPE&nbsp;ZSKA1_01-BKLAS&nbsp;VALUE&nbsp;'3000'.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_MBLNR&nbsp;TYPE&nbsp;ZMSEG01-MBLNR.<br />
&nbsp;&nbsp;CLEAR&nbsp;GT_SIMU.<br />
<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;##/##<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;LV_RATE_IR&nbsp;=&nbsp;GS_HEADER_100-KURSF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMSEG01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;GS_HEADER_100-EBELN.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;KURSF<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBKPF01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_RATE_GR<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;XBLNR&nbsp;=&nbsp;LV_MBLNR.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LV_RATE_GR&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_GR&nbsp;=&nbsp;LV_RATE_IR.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GS_HEADER_100-WAERS&nbsp;&lt;&gt;&nbsp;C_WAERS_D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_GR&nbsp;=&nbsp;LV_RATE_GR&nbsp;*&nbsp;'0.01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_IR&nbsp;=&nbsp;LV_RATE_IR&nbsp;*&nbsp;'0.01'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_TAX_RATE&nbsp;USING&nbsp;P_LIST&nbsp;CHANGING&nbsp;LV_RATE_TAX.<br />
<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;LOOP:&nbsp;WRX&nbsp;/&nbsp;PRD&nbsp;/&nbsp;KDM<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_DISP_100&nbsp;INTO&nbsp;GS_DISP_100.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_DISP_100-L_CHECK&nbsp;&lt;&gt;&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;GS_SIMU,&nbsp;LV_PO_PR,&nbsp;LV_INV_PR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_NET_FCY,&nbsp;LV_GRIR_FCY,&nbsp;LV_PRD_FCY,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_GRIR_LCY,&nbsp;LV_PRD_LCY,&nbsp;LV_KDM_LCY.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"PO&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;NETPR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKPO01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_PO_PR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;GS_HEADER_100-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;MATNR&nbsp;=&nbsp;GS_DISP_100-MATNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##(###&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_INV_PR&nbsp;=&nbsp;GS_DISP_100-NETPR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_NET_FCY&nbsp;&nbsp;=&nbsp;LV_INV_PR&nbsp;*&nbsp;GS_DISP_100-IV_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_GRIR_FCY&nbsp;=&nbsp;LV_PO_PR&nbsp;&nbsp;*&nbsp;GS_DISP_100-IV_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_PRD_FCY&nbsp;&nbsp;=&nbsp;(&nbsp;LV_INV_PR&nbsp;-&nbsp;LV_PO_PR&nbsp;)&nbsp;*&nbsp;GS_DISP_100-IV_QTY.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##&nbsp;##(##/AP&nbsp;###)<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_TOTAL_NET_FCY&nbsp;&nbsp;=&nbsp;LV_TOTAL_NET_FCY&nbsp;&nbsp;+&nbsp;LV_NET_FCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_TOTAL_GRIR_FCY&nbsp;=&nbsp;LV_TOTAL_GRIR_FCY&nbsp;+&nbsp;LV_GRIR_FCY.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"####&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_HEADER_100-WAERS&nbsp;&lt;&gt;&nbsp;C_WAERS_D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_GRIR_LCY&nbsp;=&nbsp;LV_GRIR_FCY&nbsp;*&nbsp;LV_RATE_GR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_PRD_LCY&nbsp;&nbsp;=&nbsp;LV_PRD_FCY&nbsp;&nbsp;*&nbsp;LV_RATE_IR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_KDM_LCY&nbsp;=&nbsp;(&nbsp;LV_GRIR_FCY&nbsp;*&nbsp;LV_RATE_GR&nbsp;)&nbsp;-&nbsp;(&nbsp;LV_GRIR_FCY&nbsp;*&nbsp;LV_RATE_IR&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_GRIR_LCY&nbsp;=&nbsp;LV_GRIR_FCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_PRD_LCY&nbsp;&nbsp;=&nbsp;LV_PRD_FCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_KDM_LCY&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;WRX&nbsp;(##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_KTOSL&nbsp;=&nbsp;'WRX'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SHKZG&nbsp;=&nbsp;'S'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_HKONT&nbsp;USING&nbsp;LV_KTOPL&nbsp;LV_KTOSL&nbsp;LV_BKLAS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-BUKRS&nbsp;GS_HEADER_100-LIFNR&nbsp;GS_SIMU-SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_SIMU-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_KOART&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;CHANGING&nbsp;GS_SIMU-KOART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_BSCHL&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;GS_SIMU-SHKZG&nbsp;CHANGING&nbsp;GS_SIMU-BSCHL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SAKNR&nbsp;=&nbsp;GS_SIMU-HKONT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SGTXT&nbsp;&nbsp;=&nbsp;|GR/IR&nbsp;:&nbsp;{&nbsp;GS_DISP_100-MAKTX&nbsp;}|.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WRBTR&nbsp;&nbsp;=&nbsp;LV_GRIR_FCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-DMBTR&nbsp;&nbsp;=&nbsp;LV_GRIR_LCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WAERS&nbsp;&nbsp;=&nbsp;GS_HEADER_100-WAERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WAERS_D&nbsp;=&nbsp;C_WAERS_D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-MWSKZ&nbsp;&nbsp;=&nbsp;GS_HEADER_100-MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-EBELN&nbsp;&nbsp;=&nbsp;GS_HEADER_100-EBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-EBELP&nbsp;&nbsp;=&nbsp;GS_DISP_100-EBELP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-MATNR&nbsp;&nbsp;=&nbsp;GS_DISP_100-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-MAKTX&nbsp;&nbsp;=&nbsp;GS_DISP_100-MAKTX.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_SIMU&nbsp;TO&nbsp;GT_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;PRD&nbsp;(####)&nbsp;-&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_PRD_FCY&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_KTOSL&nbsp;=&nbsp;'PRD'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"PRD:&nbsp;(+)#&nbsp;##,&nbsp;(-)#&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SHKZG&nbsp;=&nbsp;COND&nbsp;#(&nbsp;WHEN&nbsp;LV_PRD_LCY&nbsp;&gt;&nbsp;0&nbsp;THEN&nbsp;'S'&nbsp;ELSE&nbsp;'H'&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_HKONT&nbsp;USING&nbsp;LV_KTOPL&nbsp;LV_KTOSL&nbsp;LV_BKLAS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-BUKRS&nbsp;GS_HEADER_100-LIFNR&nbsp;GS_SIMU-SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_SIMU-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_KOART&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;CHANGING&nbsp;GS_SIMU-KOART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_BSCHL&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;GS_SIMU-SHKZG&nbsp;CHANGING&nbsp;GS_SIMU-BSCHL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SAKNR&nbsp;=&nbsp;GS_SIMU-HKONT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SGTXT&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WRBTR&nbsp;&nbsp;=&nbsp;ABS(&nbsp;LV_PRD_FCY&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-DMBTR&nbsp;&nbsp;=&nbsp;ABS(&nbsp;LV_PRD_LCY&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WAERS&nbsp;&nbsp;=&nbsp;GS_HEADER_100-WAERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WAERS_D&nbsp;=&nbsp;C_WAERS_D.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-MATNR&nbsp;&nbsp;=&nbsp;GS_DISP_100-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_SIMU&nbsp;TO&nbsp;GT_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;KDM&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_KDM_LCY&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_KTOSL&nbsp;=&nbsp;'KDM'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SHKZG&nbsp;=&nbsp;COND&nbsp;#(&nbsp;WHEN&nbsp;LV_KDM_LCY&nbsp;&lt;&nbsp;0&nbsp;THEN&nbsp;'S'&nbsp;ELSE&nbsp;'H'&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_HKONT&nbsp;USING&nbsp;LV_KTOPL&nbsp;LV_KTOSL&nbsp;LV_BKLAS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-BUKRS&nbsp;GS_HEADER_100-LIFNR&nbsp;GS_SIMU-SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_SIMU-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_KOART&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;CHANGING&nbsp;GS_SIMU-KOART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_BSCHL&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;GS_SIMU-SHKZG&nbsp;CHANGING&nbsp;GS_SIMU-BSCHL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SGTXT&nbsp;&nbsp;=&nbsp;COND&nbsp;#(&nbsp;WHEN&nbsp;LV_KDM_LCY&nbsp;&lt;&nbsp;0&nbsp;THEN&nbsp;'####'&nbsp;ELSE&nbsp;'####'&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WRBTR&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-DMBTR&nbsp;&nbsp;=&nbsp;ABS(&nbsp;LV_KDM_LCY&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WAERS&nbsp;&nbsp;=&nbsp;GS_HEADER_100-WAERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WAERS_D&nbsp;=&nbsp;C_WAERS_D.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-MATNR&nbsp;&nbsp;=&nbsp;GS_DISP_100-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_SIMU&nbsp;TO&nbsp;GT_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;##:&nbsp;MWS&nbsp;/&nbsp;FRT&nbsp;/&nbsp;AP<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"##&nbsp;(##&nbsp;1#)<br />
&nbsp;&nbsp;LV_MWS_FCY&nbsp;=&nbsp;LV_TOTAL_NET_FCY&nbsp;*&nbsp;LV_RATE_TAX.<br />
&nbsp;&nbsp;LV_FRT_FCY&nbsp;=&nbsp;GS_HEADER_100-FRTWR.<br />
&nbsp;&nbsp;"AP&nbsp;##&nbsp;=&nbsp;###&nbsp;#&nbsp;+&nbsp;###&nbsp;+&nbsp;##<br />
&nbsp;&nbsp;LV_AP_FCY&nbsp;&nbsp;=&nbsp;LV_TOTAL_NET_FCY&nbsp;+&nbsp;LV_FRT_FCY&nbsp;+&nbsp;LV_MWS_FCY.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GS_HEADER_100-WAERS&nbsp;&lt;&gt;&nbsp;C_WAERS_D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_MWS_LCY&nbsp;=&nbsp;LV_MWS_FCY&nbsp;*&nbsp;LV_RATE_IR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_FRT_LCY&nbsp;=&nbsp;LV_FRT_FCY&nbsp;*&nbsp;LV_RATE_IR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_AP_LCY&nbsp;&nbsp;=&nbsp;LV_AP_FCY&nbsp;&nbsp;*&nbsp;LV_RATE_IR.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_MWS_LCY&nbsp;=&nbsp;LV_MWS_FCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_FRT_LCY&nbsp;=&nbsp;LV_FRT_FCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_AP_LCY&nbsp;&nbsp;=&nbsp;LV_AP_FCY.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;MWS&nbsp;(##)<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;IF&nbsp;GV_TAX_CHECK&nbsp;=&nbsp;'X'&nbsp;AND&nbsp;LV_MWS_LCY&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_KTOSL&nbsp;=&nbsp;'MWS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SHKZG&nbsp;=&nbsp;'S'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_HKONT&nbsp;USING&nbsp;LV_KTOPL&nbsp;LV_KTOSL&nbsp;LV_BKLAS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-BUKRS&nbsp;GS_HEADER_100-LIFNR&nbsp;GS_SIMU-SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_SIMU-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_KOART&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;CHANGING&nbsp;GS_SIMU-KOART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_BSCHL&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;GS_SIMU-SHKZG&nbsp;CHANGING&nbsp;GS_SIMU-BSCHL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SAKNR&nbsp;=&nbsp;GS_SIMU-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_MWSKZ_TX&nbsp;USING&nbsp;GS_HEADER_100-MWSKZ&nbsp;CHANGING&nbsp;GS_SIMU-SGTXT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WRBTR&nbsp;&nbsp;=&nbsp;LV_MWS_FCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-DMBTR&nbsp;&nbsp;=&nbsp;LV_MWS_LCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WAERS&nbsp;&nbsp;=&nbsp;GS_HEADER_100-WAERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WAERS_D&nbsp;=&nbsp;C_WAERS_D.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_SIMU&nbsp;TO&nbsp;GT_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;FR1&nbsp;###&nbsp;(##)<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;IF&nbsp;LV_FRT_LCY&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_KTOSL&nbsp;=&nbsp;'FR1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SHKZG&nbsp;=&nbsp;'S'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_HKONT&nbsp;USING&nbsp;LV_KTOPL&nbsp;LV_KTOSL&nbsp;LV_BKLAS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-BUKRS&nbsp;GS_HEADER_100-LIFNR&nbsp;GS_SIMU-SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_SIMU-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_KOART&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;CHANGING&nbsp;GS_SIMU-KOART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_BSCHL&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;GS_SIMU-SHKZG&nbsp;CHANGING&nbsp;GS_SIMU-BSCHL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-SGTXT&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WRBTR&nbsp;&nbsp;=&nbsp;LV_FRT_FCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-DMBTR&nbsp;&nbsp;=&nbsp;LV_FRT_LCY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WAERS&nbsp;&nbsp;=&nbsp;GS_HEADER_100-WAERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU-WAERS_D&nbsp;=&nbsp;C_WAERS_D.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_SIMU&nbsp;TO&nbsp;GT_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;KBS&nbsp;#####(AP)&nbsp;(##)<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;LV_KTOSL&nbsp;=&nbsp;'KBS'.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_SIMU.<br />
&nbsp;&nbsp;GS_SIMU-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;GS_SIMU-SHKZG&nbsp;=&nbsp;'H'.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_HKONT&nbsp;USING&nbsp;LV_KTOPL&nbsp;LV_KTOSL&nbsp;LV_BKLAS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-BUKRS&nbsp;GS_HEADER_100-LIFNR&nbsp;GS_SIMU-SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_SIMU-HKONT.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_KOART&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;CHANGING&nbsp;GS_SIMU-KOART.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_BSCHL&nbsp;USING&nbsp;GS_SIMU-HKONT&nbsp;GS_SIMU-SHKZG&nbsp;CHANGING&nbsp;GS_SIMU-BSCHL.<br />
&nbsp;&nbsp;GS_SIMU-SAKNR&nbsp;=&nbsp;GS_SIMU-HKONT.<br />
<br />
&nbsp;&nbsp;GS_SIMU-LIFNR&nbsp;=&nbsp;GS_HEADER_100-LIFNR.<br />
&nbsp;&nbsp;GS_SIMU-SGTXT&nbsp;=&nbsp;GS_HEADER_100-NAME1.<br />
&nbsp;&nbsp;GS_SIMU-WRBTR&nbsp;=&nbsp;LV_AP_FCY.<br />
&nbsp;&nbsp;GS_SIMU-DMBTR&nbsp;=&nbsp;LV_AP_LCY.<br />
&nbsp;&nbsp;GS_SIMU-WAERS&nbsp;=&nbsp;GS_HEADER_100-WAERS.<br />
&nbsp;&nbsp;GS_SIMU-WAERS_D&nbsp;=&nbsp;C_WAERS_D.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_SIMU&nbsp;TO&nbsp;GT_SIMU.<br />
&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;#/#&nbsp;##&nbsp;#&nbsp;##<br />
&nbsp;&nbsp;"---------------------------------------------------------<br />
&nbsp;&nbsp;CLEAR:&nbsp;GS_SIMU_HEADER-DR_SUM,&nbsp;GS_SIMU_HEADER-CR_SUM,&nbsp;GS_SIMU_HEADER-BALANCE.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_SIMU&nbsp;INTO&nbsp;GS_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_SIMU-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU_HEADER-DR_SUM&nbsp;=&nbsp;GS_SIMU_HEADER-DR_SUM&nbsp;+&nbsp;GS_SIMU-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;GS_SIMU-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_SIMU_HEADER-CR_SUM&nbsp;=&nbsp;GS_SIMU_HEADER-CR_SUM&nbsp;+&nbsp;GS_SIMU-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;GS_SIMU_HEADER-BALANCE&nbsp;=&nbsp;GS_SIMU_HEADER-DR_SUM&nbsp;-&nbsp;GS_SIMU_HEADER-CR_SUM.<br />
&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;0400&nbsp;STARTING&nbsp;AT&nbsp;10&nbsp;5&nbsp;ENDING&nbsp;AT&nbsp;125&nbsp;30.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;POST_FI_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM POST_FI_DATA .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_BELNR&nbsp;TYPE&nbsp;ZBKPF01-BELNR.<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GT_BKPF&nbsp;,&nbsp;GS_BKPF&nbsp;,&nbsp;GT_BSEG&nbsp;,&nbsp;GS_BSEG.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;####&nbsp;##&nbsp;5100000000~&nbsp;(02)<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;GET_NEW_BELNR&nbsp;USING&nbsp;C_NR_FI&nbsp;CHANGING&nbsp;LV_BELNR&nbsp;.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;####<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;GS_BKPF-BUKRS&nbsp;=&nbsp;GS_HEADER_100-BUKRS.<br />
&nbsp;&nbsp;GS_BKPF-BELNR&nbsp;=&nbsp;LV_BELNR.<br />
&nbsp;&nbsp;GS_BKPF-GJAHR&nbsp;=&nbsp;SY-DATUM(4).<br />
&nbsp;&nbsp;GS_BKPF-BLART&nbsp;=&nbsp;'RE'.<br />
&nbsp;&nbsp;GS_BKPF-BLDAT&nbsp;=&nbsp;GS_HEADER_100-BLDAT.<br />
&nbsp;&nbsp;GS_BKPF-BUDAT&nbsp;=&nbsp;GS_HEADER_100-BUDAT.<br />
&nbsp;&nbsp;GS_BKPF-CPUDT&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;GS_BKPF-CPUTM&nbsp;=&nbsp;SY-UZEIT.<br />
&nbsp;&nbsp;GS_BKPF-KURSF&nbsp;=&nbsp;GS_HEADER_100-KURSF.<br />
&nbsp;&nbsp;GS_BKPF-WAERS&nbsp;=&nbsp;GS_HEADER_100-WAERS.<br />
&nbsp;&nbsp;GS_BKPF-TCODE&nbsp;=&nbsp;'MIRO'.<br />
&nbsp;&nbsp;GS_BKPF-XBLNR&nbsp;=&nbsp;GS_HEADER_100-BELNR.<br />
&nbsp;&nbsp;GS_BKPF-CRNAME&nbsp;=&nbsp;SY-UNAME.<br />
<br />
&nbsp;&nbsp;INSERT&nbsp;ZBKPF01&nbsp;FROM&nbsp;GS_BKPF.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;####<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_SIMU&nbsp;INTO&nbsp;GS_SIMU.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_BSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_SIMU&nbsp;TO&nbsp;GS_BSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_HEADER_100-BUKRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;LV_BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;SY-DATUM(4).<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;GS_SIMU-BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;INSERT&nbsp;ZBSEG01&nbsp;FROM&nbsp;TABLE&nbsp;GT_BSEG.<br />
&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORM&nbsp;&nbsp;POST_CANCEL_FI_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM POST_CANCEL_FI_DATA .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_BKPF&nbsp;TYPE&nbsp;ZBKPF01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BSEG&nbsp;TYPE&nbsp;ZBSEG01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_BSEG&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_BSEG,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_TEMP_BSEG&nbsp;TYPE&nbsp;ZBSEG01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_TEMP_BSEG&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_BSEG.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_BUZEI&nbsp;TYPE&nbsp;ZBSEG01-BUZEI&nbsp;VALUE&nbsp;1,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_BELNR&nbsp;TYPE&nbsp;ZBSEG01-BELNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_PRICE_SUM&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_KTOPL&nbsp;TYPE&nbsp;ZSKA1_01-KTOPL&nbsp;VALUE&nbsp;'ZCOA',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_KTOSL&nbsp;TYPE&nbsp;ZSKA1_01-KTOSL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_BKLAS&nbsp;TYPE&nbsp;ZSKA1_01-BKLAS&nbsp;VALUE&nbsp;'3000'.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;&nbsp;LV_MWS_FCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR,&nbsp;"##(##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MWS_LCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR,&nbsp;"##(##)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_AP_FCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-WRBTR,&nbsp;"AP(##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_AP_LCY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZBSEG01-DMBTR,&nbsp;"AP(##)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_GR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BKPF-KURSF,&nbsp;&nbsp;&nbsp;&nbsp;"GR##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_IR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BKPF-KURSF,&nbsp;&nbsp;&nbsp;&nbsp;"IR##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_TAX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;BKPF-KURSF.&nbsp;&nbsp;&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_MBLNR&nbsp;TYPE&nbsp;ZMSEG01-MBLNR.<br />
"---------------------------------------------------------<br />
" ## ##/##<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;LV_RATE_IR&nbsp;=&nbsp;GS_HEADER_100-KURSF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMSEG01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;GS_HEADER_100-EBELN.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;KURSF<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBKPF01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_RATE_GR<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;XBLNR&nbsp;=&nbsp;LV_MBLNR.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LV_RATE_GR&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_GR&nbsp;=&nbsp;LV_RATE_IR.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GS_HEADER_100-WAERS&nbsp;&lt;&gt;&nbsp;C_WAERS_D.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_GR&nbsp;=&nbsp;LV_RATE_GR&nbsp;*&nbsp;'0.01'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_RATE_IR&nbsp;=&nbsp;LV_RATE_IR&nbsp;*&nbsp;'0.01'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_TAX_RATE&nbsp;USING&nbsp;GS_HEADER_100-MWSKZ&nbsp;CHANGING&nbsp;LV_RATE_TAX.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GT_BKPF&nbsp;,&nbsp;GS_BKPF&nbsp;,&nbsp;GT_BSEG&nbsp;,&nbsp;GS_BSEG.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;##&nbsp;####&nbsp;##&nbsp;5000000000~&nbsp;(03)<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;PERFORM&nbsp;GET_NEW_BELNR&nbsp;USING&nbsp;C_NR_FI_CANC&nbsp;CHANGING&nbsp;LV_BELNR&nbsp;.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;##&nbsp;##&nbsp;##&nbsp;(&nbsp;#####&nbsp;)<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBKPF01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;LS_BKPF<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;XBLNR&nbsp;=&nbsp;GS_HEADER_100-STBLG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BUKRS&nbsp;=&nbsp;GS_HEADER_100-BUKRS.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_RSEG&nbsp;INTO&nbsp;GS_RSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LT_TEMP_BSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBSEG01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_TEMP_BSEG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;LS_BKPF-BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;MATNR&nbsp;=&nbsp;GS_RSEG-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_TEMP_BSEG&nbsp;INTO&nbsp;LS_TEMP_BSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_TEMP_BSEG&nbsp;TO&nbsp;LT_BSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;####<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;GS_BKPF-BUKRS&nbsp;=&nbsp;LS_BKPF-BUKRS..<br />
&nbsp;&nbsp;GS_BKPF-BELNR&nbsp;=&nbsp;LV_BELNR.<br />
&nbsp;&nbsp;GS_BKPF-GJAHR&nbsp;=&nbsp;SY-DATUM(4).<br />
&nbsp;&nbsp;GS_BKPF-BLART&nbsp;=&nbsp;'ST'.<br />
&nbsp;&nbsp;GS_BKPF-BLDAT&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;GS_BKPF-BUDAT&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;GS_BKPF-CPUDT&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;GS_BKPF-CPUTM&nbsp;=&nbsp;SY-UZEIT.<br />
&nbsp;&nbsp;GS_BKPF-KURSF&nbsp;=&nbsp;LS_BKPF-KURSF.<br />
&nbsp;&nbsp;GS_BKPF-WAERS&nbsp;=&nbsp;LS_BKPF-WAERS.<br />
&nbsp;&nbsp;GS_BKPF-TCODE&nbsp;=&nbsp;'MIRO'.<br />
&nbsp;&nbsp;GS_BKPF-XBLNR&nbsp;=&nbsp;GS_HEADER_100-BELNR.<br />
&nbsp;&nbsp;GS_BKPF-STJAH&nbsp;=&nbsp;SY-DATUM(4).<br />
&nbsp;&nbsp;GS_BKPF-XSTOV&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_BKPF-CRNAME&nbsp;=&nbsp;SY-UNAME.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;##&nbsp;##&nbsp;###<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_BSEG&nbsp;INTO&nbsp;LS_BSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_BSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;LS_BSEG-BUKRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;LV_BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;LS_BSEG-GJAHR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_BSEG-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-MATNR&nbsp;=&nbsp;LS_BSEG-MATNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-HKONT&nbsp;=&nbsp;LS_BSEG-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-KOART&nbsp;=&nbsp;LS_BSEG-KOART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_BSCHL&nbsp;USING&nbsp;GS_BSEG-HKONT&nbsp;GS_BSEG-SHKZG&nbsp;CHANGING&nbsp;GS_BSEG-BSCHL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-SAKNR&nbsp;=&nbsp;LS_BSEG-SAKNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-SGTXT&nbsp;&nbsp;=&nbsp;|####&nbsp;:&nbsp;{&nbsp;LS_BSEG-SGTXT&nbsp;}|.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;ABS(&nbsp;LS_BSEG-WRBTR&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;ABS(&nbsp;LS_BSEG-DMBTR&nbsp;).<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;KTOSL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZSKA1_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_KTOSL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;SAKNR&nbsp;=&nbsp;GS_BSEG-SAKNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_PRICE_SUM&nbsp;=&nbsp;LV_PRICE_SUM&nbsp;+&nbsp;LS_BSEG-WRBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_PRICE_SUM&nbsp;=&nbsp;LV_PRICE_SUM&nbsp;-&nbsp;LS_BSEG-WRBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;GS_BKPF-WAERS&nbsp;=&nbsp;C_WAERS_D.<br />
&nbsp;&nbsp;&nbsp;LV_MWS_FCY&nbsp;=&nbsp;LV_PRICE_SUM&nbsp;*&nbsp;LV_RATE_TAX.<br />
&nbsp;&nbsp;&nbsp;LV_MWS_LCY&nbsp;=&nbsp;LV_MWS_FCY.<br />
<br />
&nbsp;&nbsp;&nbsp;LV_AP_FCY&nbsp;&nbsp;=&nbsp;LV_PRICE_SUM&nbsp;+&nbsp;LV_MWS_FCY.<br />
&nbsp;&nbsp;&nbsp;LV_AP_LCY&nbsp;&nbsp;=&nbsp;LV_AP_FCY.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;LV_MWS_FCY&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;LV_MWS_LCY&nbsp;=&nbsp;LV_PRICE_SUM&nbsp;*&nbsp;LV_RATE_TAX&nbsp;*&nbsp;LV_RATE_IR.<br />
<br />
&nbsp;&nbsp;&nbsp;LV_AP_FCY&nbsp;&nbsp;=&nbsp;LV_PRICE_SUM.<br />
&nbsp;&nbsp;&nbsp;LV_AP_LCY&nbsp;&nbsp;=&nbsp;LV_AP_FCY&nbsp;*&nbsp;LV_RATE_IR&nbsp;+&nbsp;LV_MWS_LCY.<br />
&nbsp;&nbsp;ENDIF.<br />
"---------------------------------------------------------<br />
" ##### MWS<br />
"---------------------------------------------------------<br />
&nbsp;&nbsp;LV_KTOSL&nbsp;=&nbsp;'MWS'.&nbsp;"#####<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_BSEG.<br />
<br />
&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_HEADER_100-BUKRS.<br />
&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;LV_BELNR.<br />
&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;SY-DATUM(4).<br />
&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_HKONT&nbsp;USING&nbsp;LV_KTOPL&nbsp;LV_KTOSL&nbsp;LV_BKLAS&nbsp;GS_HEADER_100-BUKRS&nbsp;GS_HEADER_100-LIFNR&nbsp;GS_BSEG-SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_BSEG-HKONT.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_KOART&nbsp;USING&nbsp;GS_BSEG-HKONT&nbsp;CHANGING&nbsp;GS_BSEG-KOART.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_BSCHL&nbsp;USING&nbsp;GS_BSEG-HKONT&nbsp;GS_BSEG-SHKZG&nbsp;CHANGING&nbsp;GS_BSEG-BSCHL.<br />
&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;LV_MWS_FCY.<br />
&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;LV_MWS_LCY.<br />
&nbsp;&nbsp;GS_BSEG-SGTXT&nbsp;=&nbsp;|####&nbsp;:&nbsp;#####|.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#####&nbsp;(##)<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
&nbsp;&nbsp;LV_KTOSL&nbsp;=&nbsp;'KBS'.&nbsp;"VENDOR<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_BSEG.<br />
&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_HEADER_100-BUKRS.<br />
&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;LV_BELNR.<br />
&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;SY-DATUM(4).<br />
&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;GS_BSEG-LIFNR&nbsp;=&nbsp;GS_HEADER_100-LIFNR.<br />
<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_HKONT&nbsp;USING&nbsp;LV_KTOPL&nbsp;LV_KTOSL&nbsp;LV_BKLAS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_HEADER_100-BUKRS&nbsp;GS_HEADER_100-LIFNR&nbsp;GS_BSEG-SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;GS_BSEG-HKONT.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_KOART&nbsp;USING&nbsp;GS_BSEG-HKONT&nbsp;CHANGING&nbsp;GS_BSEG-KOART.<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_BSCHL&nbsp;USING&nbsp;GS_BSEG-HKONT&nbsp;GS_BSEG-SHKZG&nbsp;CHANGING&nbsp;GS_BSEG-BSCHL.<br />
&nbsp;&nbsp;GS_BSEG-SAKNR&nbsp;=&nbsp;GS_BSEG-HKONT.<br />
<br />
&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;LV_AP_FCY.<br />
&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;LV_AP_LCY.<br />
&nbsp;&nbsp;GS_BSEG-SGTXT&nbsp;=&nbsp;|####&nbsp;:&nbsp;{&nbsp;GS_HEADER_100-NAME1&nbsp;}|.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
<br />
&nbsp;&nbsp;INSERT&nbsp;ZRBKP01&nbsp;FROM&nbsp;GS_RBKP.<br />
&nbsp;&nbsp;INSERT&nbsp;ZRSEG01&nbsp;FROM&nbsp;TABLE&nbsp;GT_RSEG.<br />
&nbsp;&nbsp;INSERT&nbsp;ZBKPF01&nbsp;FROM&nbsp;GS_BKPF.<br />
&nbsp;&nbsp;INSERT&nbsp;ZBSEG01&nbsp;FROM&nbsp;TABLE&nbsp;GT_BSEG.<br />
&nbsp;&nbsp;MESSAGE&nbsp;|&nbsp;####&nbsp;{&nbsp;GS_HEADER_100-BELNR&nbsp;}#(#)&nbsp;######|&nbsp;TYPE&nbsp;'S'.<br />
&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_NEW_BELNR<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_NEW_BELNR  USING P_NR CHANGING P_BELNR.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'NUMBER_GET_NEXT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ZBELNR01'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR&nbsp;&nbsp;=&nbsp;P_NR<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NUMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;P_BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_BKLAS<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_BKLAS  USING    P_MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_BKLAS.<br />
SELECT SINGLE BKLAS<br />
&nbsp;&nbsp;FROM&nbsp;ZMAT01<br />
&nbsp;&nbsp;INTO&nbsp;P_BKLAS<br />
&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;GS_DISP_100-MATNR.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_BANK_TX<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_BANK_TX  USING    P_BANKL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_BANKL_TX.<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZTBANKCODE01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;P_BANKL_TX<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BANKL&nbsp;=&nbsp;P_BANKL.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORM&nbsp;&nbsp;GET_HKONT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_HKONT USING    P_KTOPL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_KTOSL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BKLAS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BUKRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_HKONT.<br />
<br />
&nbsp;&nbsp;"-----------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;#####&nbsp;(KBS)<br />
&nbsp;&nbsp;"-----------------------------------------------------<br />
&nbsp;&nbsp;IF&nbsp;P_KTOSL&nbsp;=&nbsp;'KBS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;AKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;P_HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;LFB1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;LIFNR&nbsp;=&nbsp;P_LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BUKRS&nbsp;=&nbsp;P_BUKRS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;P_KTOSL&nbsp;=&nbsp;'KDM'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;P_HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZSKA1_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;KTOPL&nbsp;=&nbsp;P_KTOPL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KTOSL&nbsp;=&nbsp;P_KTOSL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BKLAS&nbsp;=&nbsp;P_BKLAS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KTOKS&nbsp;=&nbsp;'REV1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;P_HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZSKA1_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;KTOPL&nbsp;=&nbsp;P_KTOPL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KTOSL&nbsp;=&nbsp;P_KTOSL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BKLAS&nbsp;=&nbsp;P_BKLAS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KTOKS&nbsp;=&nbsp;'EXP1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;"-----------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;WRX,&nbsp;PRD,&nbsp;BSX,&nbsp;MWS&nbsp;#&nbsp;#&nbsp;ZSKA1_01&nbsp;#####&nbsp;##<br />
&nbsp;&nbsp;"-----------------------------------------------------<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;P_HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZSKA1_01<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;KTOPL&nbsp;=&nbsp;P_KTOPL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;KTOSL&nbsp;=&nbsp;P_KTOSL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BKLAS&nbsp;=&nbsp;P_BKLAS.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_BSCHL<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_BSCHL  USING    P_HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_SHKZG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_BSCHL.<br />
DATA : P_KTOSL TYPE ZSKA1_01-KTOSL.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;KTOSL<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZSKA1_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;P_KTOSL<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;SAKNR&nbsp;=&nbsp;P_HKONT.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;P_KTOSL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'WRX'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"GR/IR&nbsp;Clearing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'96'.&nbsp;&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'86'.&nbsp;&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'BSX'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'40'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'50'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'PRD'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'40'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'50'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'MWS'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"###<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'40'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'50'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'KBS'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Vender<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'21'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'31'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'KDM'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'40'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'50'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'40'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_BSCHL&nbsp;=&nbsp;'50'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_KOART<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_KOART  USING    P_HKONT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_KOART.<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;KOART<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZSKA1_01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;P_KOART<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;SAKNR&nbsp;=&nbsp;P_HKONT.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_FI_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_FI_DATA .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_BKPF&nbsp;,&nbsp;GT_BSEG&nbsp;,&nbsp;GS_FI_ALV&nbsp;,&nbsp;GT_FI_ALV&nbsp;,&nbsp;GT_FI_SUM&nbsp;,&nbsp;GS_FI_SUM.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBKPF01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;GS_BKPF<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;XBLNR&nbsp;=&nbsp;GS_HEADER_100-BELNR.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBSEG01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_BSEG<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;GS_BKPF-BELNR.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_BSEG&nbsp;INTO&nbsp;GS_BSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_BSEG&nbsp;TO&nbsp;GS_FI_ALV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FI_ALV-WAERS&nbsp;=&nbsp;GS_BKPF-WAERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_FI_ALV&nbsp;TO&nbsp;GT_FI_ALV.<br />
&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;GV_PERIOD&nbsp;=&nbsp;GS_BKPF-BUDAT+4(2).<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_MWSKZ_TX<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_MWSKZ_TX  USING    P_MWSKZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_TEXT.<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZTAXCODE01<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;P_TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MWSKZ&nbsp;=&nbsp;P_MWSKZ.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;EXCLUDE_TOOLBAR<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM EXCLUDE_TOOLBAR .<br />
&nbsp;&nbsp;GS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_LOC_INSERT_ROW.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_EXCLUDE&nbsp;TO&nbsp;GT_EXCLUDE.<br />
<br />
&nbsp;&nbsp;GS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_LOC_DELETE_ROW.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_EXCLUDE&nbsp;TO&nbsp;GT_EXCLUDE.<br />
<br />
&nbsp;&nbsp;GS_EXCLUDE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_LOC_APPEND_ROW.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_EXCLUDE&nbsp;TO&nbsp;GT_EXCLUDE.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;MODIFY_FI_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM MODIFY_FI_DATA .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_BUZEI&nbsp;TYPE&nbsp;ZBSEG01-BUZEI&nbsp;VALUE&nbsp;1.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_FI_ALV&nbsp;INTO&nbsp;GS_FI_ALV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FI_ALV-WAERS_D&nbsp;=&nbsp;'KRW'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_FI_ALV-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_FI_ALV-DMBTR&nbsp;=&nbsp;-&nbsp;GS_FI_ALV-DMBTR&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_FI_ALV-WRBTR&nbsp;=&nbsp;-&nbsp;GS_FI_ALV-WRBTR&nbsp;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;GS_FI_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_FI_ALV&nbsp;TO&nbsp;GS_FI_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;COLLECT&nbsp;GS_FI_SUM&nbsp;INTO&nbsp;GT_FI_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_FI_ALV&nbsp;FROM&nbsp;GS_FI_ALV.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GT_FI_ALV.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_FI_SUM&nbsp;INTO&nbsp;GS_FI_SUM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_FI_SUM&nbsp;TO&nbsp;GS_FI_ALV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_FI_ALV-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_FI_ALV&nbsp;TO&nbsp;GT_FI_ALV.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_TAX_RATE<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_TAX_RATE  USING    P_MWSKZ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_RATE_TAX.<br />
&nbsp;&nbsp;CASE&nbsp;P_MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V1'.&nbsp;P_RATE_TAX&nbsp;=&nbsp;'0.1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.&nbsp;P_RATE_TAX&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;ENDCASE.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHECK_INCO<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CHECK_INCO  USING    P_INCO1 P_FRTWR.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;P_INCO1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'EXW'&nbsp;OR&nbsp;'FOB'&nbsp;OR&nbsp;'FCA'&nbsp;OR&nbsp;'FAS'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_FRTWR&nbsp;IS&nbsp;INITIAL&nbsp;OR&nbsp;P_FRTWR&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;|####({&nbsp;P_INCO1&nbsp;})#&nbsp;###&nbsp;#####&nbsp;####&nbsp;####&nbsp;###|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GV_CHECK_FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">Extracted by Mass Download version 1.5.5 - E.G.Mellodew. 1998-2025. Sap Release 750</td>
   </tr>
</table>
</body>
</html>
