<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=ISO-8859-1" />
<title>ZMM22_004_F01</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMM22_004_F01</h2>
<h3> Description: </h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;Include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMM22_004_F01<br />
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_INIT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SET_INIT .<br />
"  P_EBELN = '4500000004'.<br />
"  P_WERKS = '1000'.<br />
P_DATE = SY-DATUM.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_SCREEN<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SET_SCREEN .<br />
LOOP AT SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;1.&nbsp;##&nbsp;##(P_R1)&nbsp;###&nbsp;#&nbsp;-&gt;&nbsp;###(S)&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_R1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;##(P_R2)&nbsp;###&nbsp;#&nbsp;-&gt;&nbsp;###(C)&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;'0'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;VALID_INPUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM VALID_INPUT .<br />
<br />
&nbsp;&nbsp;"&nbsp;0.&nbsp;##&nbsp;##(F8/ONLI)#&nbsp;##&nbsp;###&nbsp;###&nbsp;####&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;CHECK&nbsp;SY-UCOMM&nbsp;=&nbsp;'ONLI'.<br />
<br />
&nbsp;&nbsp;"&nbsp;[CASE&nbsp;1]&nbsp;##&nbsp;##&nbsp;##&nbsp;(P_R1)&nbsp;##&nbsp;#<br />
&nbsp;&nbsp;IF&nbsp;P_R1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;1-1.&nbsp;##&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_EBELN&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;###&nbsp;#####.'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_WERKS&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;#####.'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_DATE&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'######&nbsp;#####.'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;1-2.&nbsp;####(PO)&nbsp;###&nbsp;##&nbsp;(EKKO&nbsp;###&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;LV_DUMMY&nbsp;TYPE&nbsp;C.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;@LV_DUMMY<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKKO_22<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;@P_EBELN.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;##&nbsp;####&nbsp;#####.'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;[CASE&nbsp;2]&nbsp;##&nbsp;##&nbsp;##&nbsp;(P_R2)&nbsp;##&nbsp;#<br />
&nbsp;&nbsp;ELSEIF&nbsp;P_R2&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;2-1.&nbsp;##&nbsp;#&nbsp;##&nbsp;###&nbsp;##&nbsp;(####,&nbsp;###)<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_EBELN2&nbsp;IS&nbsp;INITIAL.&nbsp;"&nbsp;(###&nbsp;###&nbsp;P_EBELN2&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;####&nbsp;###&nbsp;#####.'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_WERKS2&nbsp;IS&nbsp;INITIAL.&nbsp;"&nbsp;(###&nbsp;###&nbsp;P_WERKS2&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;####&nbsp;#####.'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_PO_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_PO_DATA.<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;##&nbsp;###&nbsp;###<br />
&nbsp;&nbsp;REFRESH&nbsp;GT_ITEM.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;####(PO)&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;SELECT&nbsp;A~EBELN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~EBELP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MATNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MAKTX&nbsp;AS&nbsp;TXZ01,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~WERKS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MENGE,&nbsp;"&nbsp;&lt;---&nbsp;##&nbsp;PO#&nbsp;##&nbsp;##&nbsp;(#:&nbsp;10#)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MEINS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~STPRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~MWSKZ,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~WAERS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKKO_22&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZEKPO_22&nbsp;AS&nbsp;B&nbsp;ON&nbsp;A~EBELN&nbsp;=&nbsp;B~EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@GT_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~EBELN&nbsp;=&nbsp;@P_EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~WERKS&nbsp;=&nbsp;@P_WERKS.<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;###&nbsp;###&nbsp;(##&nbsp;##&nbsp;##&nbsp;&&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;DATA:&nbsp;LV_IV_QTY&nbsp;TYPE&nbsp;ZRSEG_22-MENGE.&nbsp;"&nbsp;##&nbsp;##&nbsp;###&nbsp;##<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_ITEM[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;###&nbsp;###&nbsp;'##&nbsp;##'#&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(1)&nbsp;#&nbsp;###&nbsp;##&nbsp;##&nbsp;###(DB#&nbsp;###)&nbsp;##&nbsp;##&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LV_IV_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SUM(&nbsp;MENGE&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_IV_QTY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG_22<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;GS_ITEM-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EBELP&nbsp;=&nbsp;GS_ITEM-EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;LOEKZ&nbsp;&lt;&gt;&nbsp;'X'&nbsp;"&nbsp;###&nbsp;##&nbsp;####&nbsp;##!<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;SHKZG&nbsp;=&nbsp;'S'."###<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(2)&nbsp;###&nbsp;###&nbsp;##&nbsp;=&nbsp;PO##&nbsp;-&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-MENGE&nbsp;=&nbsp;GS_ITEM-MENGE&nbsp;-&nbsp;LV_IV_QTY.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(3)&nbsp;##&nbsp;###&nbsp;0&nbsp;####&nbsp;#####&nbsp;##&nbsp;(##&nbsp;#&nbsp;###)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ITEM-MENGE&nbsp;&lt;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;GT_ITEM&nbsp;INDEX&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.&nbsp;"&nbsp;##&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(4)&nbsp;##&nbsp;###&nbsp;(##&nbsp;##&nbsp;*&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-WRBTR&nbsp;=&nbsp;GS_ITEM-MENGE&nbsp;*&nbsp;GS_ITEM-STPRS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(5)&nbsp;##&nbsp;##&nbsp;(##&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;GS_ITEM-WMWST&nbsp;=&nbsp;...&nbsp;(###&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-DMBTR&nbsp;=&nbsp;GS_ITEM-WRBTR&nbsp;+&nbsp;GS_ITEM-WMWST.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-CHECK&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-BUZEI&nbsp;=&nbsp;SY-TABIX.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM&nbsp;FROM&nbsp;GS_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;###&nbsp;#&nbsp;####&nbsp;#####&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;GT_ITEM[]&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;#&nbsp;##&nbsp;####&nbsp;###&nbsp;####.&nbsp;(##&nbsp;###)'&nbsp;TYPE&nbsp;'I'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;##&nbsp;###&nbsp;######.'&nbsp;TYPE&nbsp;'S'.<br />
&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="codeComment">
*REFRESH&nbsp;GT_ITEM.<br />
*<br />
*&nbsp;&nbsp;"&nbsp;1.&nbsp;PO&nbsp;##&nbsp;##&nbsp;(###&nbsp;##)<br />
*&nbsp;&nbsp;SELECT&nbsp;A~EBELN,&nbsp;B~EBELP,&nbsp;B~MATNR,&nbsp;B~MAKTX&nbsp;AS&nbsp;TXZ01,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~WERKS,&nbsp;B~MENGE,&nbsp;B~MEINS,&nbsp;B~STPRS,&nbsp;B~MWSKZ,&nbsp;A~WAERS,&nbsp;A~LIFNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKKO_22&nbsp;AS&nbsp;A<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZEKPO_22&nbsp;AS&nbsp;B&nbsp;ON&nbsp;A~EBELN&nbsp;=&nbsp;B~EBELN<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@GT_ITEM<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~EBELN&nbsp;=&nbsp;@P_EBELN<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~WERKS&nbsp;=&nbsp;@P_WERKS.<br />
*<br />
*&nbsp;&nbsp;"&nbsp;2.&nbsp;###&nbsp;##&nbsp;##&nbsp;(#&nbsp;##&nbsp;##:&nbsp;S#&nbsp;###&nbsp;H#&nbsp;##)<br />
*&nbsp;&nbsp;DATA:&nbsp;LV_IV_QTY&nbsp;TYPE&nbsp;ZRSEG_22-MENGE.<br />
*<br />
*&nbsp;&nbsp;IF&nbsp;GT_ITEM[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LV_IV_QTY.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;[###&nbsp;##]<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##(S)##&nbsp;(+),&nbsp;##(H)##&nbsp;(-)#&nbsp;##<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SUM(&nbsp;CASE&nbsp;WHEN&nbsp;SHKZG&nbsp;=&nbsp;'H'&nbsp;THEN&nbsp;MENGE&nbsp;*&nbsp;-1<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;MENGE&nbsp;END&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;@LV_IV_QTY<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG_22<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;@GS_ITEM-EBELN<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;EBELP&nbsp;=&nbsp;@GS_ITEM-EBELP.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;LOEKZ&nbsp;###&nbsp;###&nbsp;(###&nbsp;##&nbsp;X#&nbsp;#&nbsp;####)<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;3.&nbsp;##&nbsp;##&nbsp;=&nbsp;PO##&nbsp;-&nbsp;#####<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-MENGE&nbsp;=&nbsp;GS_ITEM-MENGE&nbsp;-&nbsp;LV_IV_QTY.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;4.&nbsp;##&nbsp;#&nbsp;###&nbsp;##<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ITEM-MENGE&nbsp;&lt;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DELETE&nbsp;GT_ITEM&nbsp;INDEX&nbsp;SY-TABIX.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;5.&nbsp;##&nbsp;##&nbsp;#&nbsp;###<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-WRBTR&nbsp;=&nbsp;GS_ITEM-MENGE&nbsp;*&nbsp;GS_ITEM-STPRS.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-DMBTR&nbsp;=&nbsp;GS_ITEM-WRBTR&nbsp;+&nbsp;GS_ITEM-WMWST.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-SHKZG&nbsp;=&nbsp;'S'.&nbsp;"&nbsp;###&nbsp;##&nbsp;###&nbsp;S<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-CHECK&nbsp;=&nbsp;''.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-BUZEI&nbsp;=&nbsp;SY-TABIX.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM&nbsp;FROM&nbsp;GS_ITEM.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
*&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;"&nbsp;###&nbsp;##&nbsp;(###&nbsp;##)<br />
*&nbsp;&nbsp;IF&nbsp;GT_ITEM[]&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;#&nbsp;##&nbsp;####&nbsp;###&nbsp;####.'&nbsp;TYPE&nbsp;'I'.<br />
*&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;##&nbsp;###&nbsp;######.'&nbsp;TYPE&nbsp;'S'.<br />
*&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CREATE_OBJECT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CREATE_OBJECT .<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_CUSTOM<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;=&nbsp;'CON1'.<br />
<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_GRID<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;=&nbsp;GC_CUSTOM.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FIELD_CATALOG<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FIELD_CATALOG .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT,&nbsp;GT_FIELDCAT.<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;##&nbsp;(##&nbsp;##)<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'CHECK'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CHECKBOX&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.&nbsp;"&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;(##&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BUZEI'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;##&nbsp;(##&nbsp;##,&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'STPRS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.&nbsp;"&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;4.&nbsp;###<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;5.&nbsp;##&nbsp;(##&nbsp;##,&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-QFIELDNAME&nbsp;=&nbsp;'MEINS'.&nbsp;"&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_TABLE&nbsp;&nbsp;=&nbsp;'ZRSEG_22'.<br />
&nbsp;&nbsp;GS_FIELDCAT-REF_FIELD&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;6.&nbsp;##<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;7.&nbsp;####&nbsp;(##&nbsp;##)<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'WRBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;8.&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EBELN'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;9.&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;9.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'EBELP'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'PO##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;10.&nbsp;####<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MWSKZ'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;11.&nbsp;##&nbsp;(##&nbsp;##)<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;11.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'WMWST'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;12.&nbsp;####<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;12.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-NO_ZERO&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;13.&nbsp;####<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;13.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'TXZ01'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;20.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;14.&nbsp;###<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;14.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WERKS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;15.&nbsp;##&nbsp;(###+##,&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;15.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'DMBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;16.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'LIFNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;16.&nbsp;###&nbsp;(##&nbsp;##)<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;=&nbsp;16.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'SGTXT'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.&nbsp;"&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;30.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_LAYOUT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_LAYOUT .<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_LAYOUT.<br />
&nbsp;&nbsp;GS_LAYOUT-CWIDTH_OPT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_LAYOUT-SEL_MODE&nbsp;&nbsp;&nbsp;=&nbsp;'A'.<br />
&nbsp;&nbsp;"GS_LAYOUT-BOX_FNAME&nbsp;&nbsp;=&nbsp;'SEL'.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALL_ALV<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALL_ALV .<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;=&nbsp;GT_FIELDCAT.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SAVE_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SAVE_DATA.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_RBKP&nbsp;TYPE&nbsp;ZRBKP_22,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_RSEG&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZRSEG_22,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG&nbsp;TYPE&nbsp;ZRSEG_22.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;LV_MAX_BELNR&nbsp;TYPE&nbsp;ZRBKP_22-BELNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_NEW_BELNR&nbsp;TYPE&nbsp;ZRBKP_22-BELNR.<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ITEM&nbsp;WITH&nbsp;KEY&nbsp;CHECK&nbsp;=&nbsp;'X'&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;###&nbsp;###&nbsp;##&nbsp;##&nbsp;#####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;SELECT&nbsp;MAX(&nbsp;BELNR&nbsp;)&nbsp;FROM&nbsp;ZRBKP_22&nbsp;INTO&nbsp;LV_MAX_BELNR.<br />
&nbsp;&nbsp;IF&nbsp;LV_MAX_BELNR&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_NEW_BELNR&nbsp;=&nbsp;'5000000000'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_NEW_BELNR&nbsp;=&nbsp;LV_MAX_BELNR&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;[##]&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;(1)&nbsp;##&nbsp;###&nbsp;(###,&nbsp;###,&nbsp;##,&nbsp;##,&nbsp;####&nbsp;#)&nbsp;##<br />
&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;ZRBKP_22&nbsp;TO&nbsp;LS_RBKP.<br />
<br />
&nbsp;&nbsp;"&nbsp;(2)&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP-BELNR&nbsp;&nbsp;=&nbsp;LV_NEW_BELNR.&nbsp;"&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP-GJAHR&nbsp;&nbsp;=&nbsp;SY-DATUM(4).&nbsp;&nbsp;"&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP-RBSTAT&nbsp;=&nbsp;'5'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;(###)<br />
<br />
&nbsp;&nbsp;"&nbsp;1)&nbsp;##&nbsp;##&nbsp;(BLART)&nbsp;-&nbsp;##(RE)&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP-BLART&nbsp;=&nbsp;'RE'.<br />
<br />
&nbsp;&nbsp;"&nbsp;2)&nbsp;PO&nbsp;##&nbsp;&&nbsp;###&nbsp;(EBELN,&nbsp;WERKS)&nbsp;-&nbsp;Selection&nbsp;Screen&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;(####&nbsp;P_EBELN,&nbsp;P_WERKS#&nbsp;###&nbsp;#####)<br />
&nbsp;&nbsp;LS_RBKP-EBELN&nbsp;=&nbsp;P_EBELN.<br />
&nbsp;&nbsp;LS_RBKP-WERKS&nbsp;=&nbsp;P_WERKS.<br />
<br />
&nbsp;&nbsp;"&nbsp;3)&nbsp;####(BUKRS),&nbsp;###(LIFNR),&nbsp;##(WAERS)&nbsp;-&nbsp;PO&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;BUKRS,&nbsp;LIFNR,&nbsp;WAERS<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;(@LS_RBKP-BUKRS,&nbsp;@LS_RBKP-LIFNR,&nbsp;@LS_RBKP-WAERS)<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKKO_22<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;@P_EBELN.<br />
<br />
&nbsp;&nbsp;"&nbsp;(##&nbsp;####&nbsp;###&nbsp;######&nbsp;####&nbsp;###&nbsp;##)<br />
&nbsp;&nbsp;IF&nbsp;LS_RBKP-WAERS&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP-WAERS&nbsp;=&nbsp;'KRW'.&nbsp;"&nbsp;###<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;"&nbsp;-----------------------------------------------------------<br />
<br />
<br />
&nbsp;&nbsp;"&nbsp;4.&nbsp;[###]&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM&nbsp;WHERE&nbsp;CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_RSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ITEM&nbsp;TO&nbsp;LS_RSEG.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-BELNR&nbsp;=&nbsp;LV_NEW_BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-GJAHR&nbsp;=&nbsp;LS_RBKP-GJAHR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##/##/###&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-STPRS&nbsp;=&nbsp;GS_ITEM-STPRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-BSTME&nbsp;=&nbsp;GS_ITEM-MEINS.&nbsp;"&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-SHKZG&nbsp;=&nbsp;'S'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##(S)<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;-------------------------------------------------------------<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;[##]&nbsp;###(LIFNR)&nbsp;##&nbsp;(DB&nbsp;####&nbsp;###&nbsp;###&nbsp;###)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;-------------------------------------------------------------<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;1:&nbsp;ALV&nbsp;####&nbsp;##&nbsp;#&nbsp;##&nbsp;(GET_PO_DATA##&nbsp;#####)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-LIFNR&nbsp;=&nbsp;GS_ITEM-LIFNR.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;2:&nbsp;##&nbsp;GS_ITEM#&nbsp;##&nbsp;#####&nbsp;##&nbsp;##&nbsp;##&nbsp;(####)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_RSEG-LIFNR&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG-LIFNR&nbsp;=&nbsp;LS_RBKP-LIFNR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;-------------------------------------------------------------<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_RSEG&nbsp;TO&nbsp;LT_RSEG.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"&nbsp;5.&nbsp;##<br />
&nbsp;&nbsp;INSERT&nbsp;ZRBKP_22&nbsp;FROM&nbsp;LS_RBKP.<br />
&nbsp;&nbsp;INSERT&nbsp;ZRSEG_22&nbsp;FROM&nbsp;TABLE&nbsp;LT_RSEG.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"MESSAGE&nbsp;S000(ZMM)&nbsp;WITH&nbsp;'###&nbsp;#######.&nbsp;####:'&nbsp;LV_NEW_BELNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;LV_MSG&nbsp;TYPE&nbsp;STRING.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;'###&nbsp;#######.&nbsp;####:&nbsp;'&nbsp;LV_NEW_BELNR&nbsp;INTO&nbsp;LV_MSG.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;LV_MSG&nbsp;TYPE&nbsp;'I'.<br />
<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;#&nbsp;###&nbsp;######.'&nbsp;TYPE&nbsp;'I'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CLASS_EVENT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CLASS_EVENT .<br />
" 1. ### ### ## ## (TOP# ### GO_EVENT ## ##)<br />
&nbsp;&nbsp;IF&nbsp;GO_EVENT&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_EVENT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;####&nbsp;ALV&nbsp;Grid(GC_GRID)&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;(####&nbsp;###&nbsp;#&nbsp;HANDLE_DATA_CHANGED&nbsp;####&nbsp;#####&nbsp;#)<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_EVENT-&gt;HANDLE_DATA_CHANGED&nbsp;FOR&nbsp;GC_GRID.<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;[##]&nbsp;##(Enter)#&nbsp;##&nbsp;#&nbsp;##&nbsp;####&nbsp;#####&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;(#&nbsp;###&nbsp;###&nbsp;##&nbsp;###&nbsp;###&nbsp;##&nbsp;##&nbsp;###&nbsp;#&nbsp;###)<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;REGISTER_EDIT_EVENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EVENT_ID&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_EVT_MODIFIED.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;REFRESH_CELL<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM REFRESH_CELL USING P_DATA_CHANGED TYPE REF TO CL_ALV_CHANGED_DATA_PROTOCOL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_ROW_ID&nbsp;TYPE&nbsp;I&nbsp;P_FIELD&nbsp;TYPE&nbsp;C&nbsp;P_VALUE&nbsp;TYPE&nbsp;ANY.<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;P_DATA_CHANGED-&gt;MODIFY_CELL<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;I_ROW_ID&nbsp;=&nbsp;P_ROW_ID&nbsp;I_FIELDNAME&nbsp;=&nbsp;P_FIELD&nbsp;I_VALUE&nbsp;=&nbsp;P_VALUE.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;DATA_CHANGED_LOGIC<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;CLS##&nbsp;##:&nbsp;##&nbsp;##&nbsp;#&nbsp;##&nbsp;##&nbsp;##<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM DATA_CHANGED_LOGIC USING P_DATA_CHANGED TYPE REF TO CL_ALV_CHANGED_DATA_PROTOCOL.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_MOD_CELL&nbsp;TYPE&nbsp;LVC_S_MODI.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;P_DATA_CHANGED-&gt;MT_GOOD_CELLS&nbsp;INTO&nbsp;LS_MOD_CELL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_MOD_CELL-FIELDNAME&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM&nbsp;INDEX&nbsp;LS_MOD_CELL-ROW_ID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;1.&nbsp;###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;P_DATA_CHANGED-&gt;GET_CELL_VALUE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;I_ROW_ID&nbsp;=&nbsp;LS_MOD_CELL-ROW_ID&nbsp;I_FIELDNAME&nbsp;=&nbsp;'MENGE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING&nbsp;E_VALUE&nbsp;&nbsp;=&nbsp;GS_ITEM-MENGE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;CALC_AMOUNT&nbsp;CHANGING&nbsp;GS_ITEM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;3.&nbsp;###&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM&nbsp;FROM&nbsp;GS_ITEM&nbsp;INDEX&nbsp;LS_MOD_CELL-ROW_ID.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;4.&nbsp;##&nbsp;##&nbsp;(##&nbsp;##&nbsp;###)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;REFRESH_CELL&nbsp;USING&nbsp;P_DATA_CHANGED&nbsp;LS_MOD_CELL-ROW_ID&nbsp;'WRBTR'&nbsp;GS_ITEM-WRBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;REFRESH_CELL&nbsp;USING&nbsp;P_DATA_CHANGED&nbsp;LS_MOD_CELL-ROW_ID&nbsp;'WMWST'&nbsp;GS_ITEM-WMWST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;REFRESH_CELL&nbsp;USING&nbsp;P_DATA_CHANGED&nbsp;LS_MOD_CELL-ROW_ID&nbsp;'DMBTR'&nbsp;GS_ITEM-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALC_AMOUNT<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;[##]&nbsp;##&nbsp;###&nbsp;##&nbsp;(###,&nbsp;##,&nbsp;##)<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALC_AMOUNT CHANGING PS_ITEM LIKE GS_ITEM.<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;####&nbsp;=&nbsp;##&nbsp;*&nbsp;##<br />
&nbsp;&nbsp;PS_ITEM-WRBTR&nbsp;=&nbsp;PS_ITEM-MENGE&nbsp;*&nbsp;PS_ITEM-STPRS.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;CASE&nbsp;PS_ITEM-MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V1'&nbsp;OR&nbsp;'V4'&nbsp;OR&nbsp;'V5'.&nbsp;"&nbsp;10%<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PS_ITEM-WMWST&nbsp;=&nbsp;PS_ITEM-WRBTR&nbsp;*&nbsp;'0.1'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.&nbsp;"&nbsp;0%&nbsp;(V2,&nbsp;V3&nbsp;#)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PS_ITEM-WMWST&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;##&nbsp;=&nbsp;###&nbsp;+&nbsp;##<br />
&nbsp;&nbsp;PS_ITEM-DMBTR&nbsp;=&nbsp;PS_ITEM-WRBTR&nbsp;+&nbsp;PS_ITEM-WMWST.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;APPLY_HEADER_TAX<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;[PAI&nbsp;##]&nbsp;##&nbsp;#####&nbsp;##&nbsp;####&nbsp;##<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM APPLY_HEADER_TAX.<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;CASE&nbsp;ZRBKP_22-MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V1'&nbsp;OR&nbsp;'V2'&nbsp;OR&nbsp;'V3'&nbsp;OR&nbsp;'V4'&nbsp;OR&nbsp;'V5'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;#######.&nbsp;(V1~V5)'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_ITEM[]&nbsp;IS&nbsp;INITIAL.&nbsp;EXIT.&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-MWSKZ&nbsp;=&nbsp;ZRBKP_22-MWSKZ.&nbsp;"&nbsp;##&nbsp;#&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;CALC_AMOUNT&nbsp;CHANGING&nbsp;GS_ITEM.&nbsp;"&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM&nbsp;FROM&nbsp;GS_ITEM.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;ALV&nbsp;##&nbsp;####<br />
&nbsp;&nbsp;IF&nbsp;GC_GRID&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;REFRESH_TABLE_DISPLAY.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALCULATE_BALANCE<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALCULATE_BALANCE.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_SUM_ALL_ITEMS&nbsp;TYPE&nbsp;ZRBKP_22-RMWWR,&nbsp;"&nbsp;[##]&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_SUM_ALL_TAX&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZRBKP_22-WMWST,&nbsp;"&nbsp;[##]&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_SUM_CHK_ITEMS&nbsp;TYPE&nbsp;ZRBKP_22-RMWWR,&nbsp;"&nbsp;[##]&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_SUM_CHK_TAX&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZRBKP_22-WMWST,&nbsp;"&nbsp;[##]&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_DIFF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZRBKP_22-RMWWR,&nbsp;"&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_CNT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;###&nbsp;##<br />
<br />
&nbsp;&nbsp;"##&nbsp;#(0120)#&nbsp;##&nbsp;###&nbsp;###&nbsp;0##&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;GV_SUB_DYNNR&nbsp;=&nbsp;'0120'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;BALANCE&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;ICON&nbsp;=&nbsp;''.&nbsp;"&nbsp;(##&nbsp;#&nbsp;###&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.&nbsp;"&nbsp;#&nbsp;##&nbsp;####&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;LV_SUM_ALL_ITEMS,&nbsp;LV_SUM_ALL_TAX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_SUM_CHK_ITEMS,&nbsp;LV_SUM_CHK_TAX,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BALANCE,&nbsp;ICON,&nbsp;LV_CNT.<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;##&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;GC_GRID&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;CHECK_CHANGED_DATA.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;##&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;GC_GRID&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;CHECK_CHANGED_DATA.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;##&nbsp;(###&nbsp;##&nbsp;#&nbsp;##/##&nbsp;##&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(1)&nbsp;##&nbsp;####&nbsp;##&nbsp;##&nbsp;(####&nbsp;V1&nbsp;##&nbsp;##&nbsp;#&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;ZRBKP_22-MWSKZ&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-MWSKZ&nbsp;=&nbsp;ZRBKP_22-MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(2)&nbsp;###&nbsp;(##,&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;CALC_AMOUNT&nbsp;CHANGING&nbsp;GS_ITEM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(3)&nbsp;[##&nbsp;##]&nbsp;###&nbsp;##&nbsp;(#####)<br />
&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;GS_ITEM-DMBTR&nbsp;TO&nbsp;LV_SUM_ALL_ITEMS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;GS_ITEM-WMWST&nbsp;TO&nbsp;LV_SUM_ALL_TAX.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(4)&nbsp;[##&nbsp;##]&nbsp;###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ITEM-CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;LV_CNT.&nbsp;"&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;GS_ITEM-DMBTR&nbsp;TO&nbsp;LV_SUM_CHK_ITEMS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;GS_ITEM-WMWST&nbsp;TO&nbsp;LV_SUM_CHK_TAX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM&nbsp;FROM&nbsp;GS_ITEM.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;##&nbsp;##&nbsp;(ALV#&nbsp;###&nbsp;##&nbsp;####)<br />
&nbsp;&nbsp;IF&nbsp;GC_GRID&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID-&gt;REFRESH_TABLE_DISPLAY.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;4.&nbsp;[##&nbsp;##]&nbsp;###&nbsp;###&nbsp;#&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;###&nbsp;#&nbsp;###&nbsp;-&gt;&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;###&nbsp;#&nbsp;###&nbsp;-&gt;&nbsp;##&nbsp;##&nbsp;##&nbsp;(##&nbsp;####&nbsp;#####!)<br />
&nbsp;&nbsp;DATA:&nbsp;LV_FINAL_TAX&nbsp;&nbsp;&nbsp;TYPE&nbsp;ZRBKP_22-WMWST,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_FINAL_TOTAL&nbsp;TYPE&nbsp;ZRBKP_22-RMWWR.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LV_CNT&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_FINAL_TAX&nbsp;&nbsp;&nbsp;=&nbsp;LV_SUM_CHK_TAX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_FINAL_TOTAL&nbsp;=&nbsp;LV_SUM_CHK_ITEMS.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_FINAL_TAX&nbsp;&nbsp;&nbsp;=&nbsp;LV_SUM_ALL_TAX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_FINAL_TOTAL&nbsp;=&nbsp;LV_SUM_ALL_ITEMS.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;5.&nbsp;##&nbsp;##&nbsp;#&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;ZRBKP_22-WMWST&nbsp;=&nbsp;LV_FINAL_TAX.<br />
&nbsp;&nbsp;LV_DIFF&nbsp;=&nbsp;ZRBKP_22-RMWWR&nbsp;-&nbsp;LV_FINAL_TOTAL.<br />
<br />
&nbsp;&nbsp;"&nbsp;6.&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;GV_CALC_FLAG&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;####:&nbsp;####&nbsp;#&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;ICON&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'@0A@'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;BALANCE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ZRBKP_22-WMWST&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;####:&nbsp;#&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;BALANCE&nbsp;=&nbsp;LV_DIFF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;BALANCE&nbsp;=&nbsp;0&nbsp;AND&nbsp;ZRBKP_22-RMWWR&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICON&nbsp;=&nbsp;'@08@'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICON&nbsp;=&nbsp;'@0A@'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALC_DUEDATE<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALC_DUEDATE.<br />
&nbsp;&nbsp;DATA:&nbsp;LV_BASE_DATE&nbsp;TYPE&nbsp;DATS.<br />
<br />
&nbsp;&nbsp;"&nbsp;###(###)#&nbsp;###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;ZRBKP_22-BLDAT&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;LV_BASE_DATE&nbsp;=&nbsp;ZRBKP_22-BLDAT.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;ZRBKP_22-ZTERM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;---&nbsp;##&nbsp;##&nbsp;(YYYYMM&nbsp;+&nbsp;##)&nbsp;---<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M001'.&nbsp;"&nbsp;##&nbsp;10#<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LV_BASE_DATE(6)&nbsp;'10'&nbsp;INTO&nbsp;ZRBKP_22-ZFBDT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M002'.&nbsp;"&nbsp;##&nbsp;25#<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LV_BASE_DATE(6)&nbsp;'25'&nbsp;INTO&nbsp;ZRBKP_22-ZFBDT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;---&nbsp;##&nbsp;##&nbsp;(#&nbsp;#&nbsp;##)&nbsp;---<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M003'.&nbsp;"&nbsp;##&nbsp;10#<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'RP_CALC_DATE_IN_INTERVAL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;DATE&nbsp;=&nbsp;LV_BASE_DATE&nbsp;DAYS&nbsp;=&nbsp;0&nbsp;MONTHS&nbsp;=&nbsp;1&nbsp;SIGNUM&nbsp;=&nbsp;'+'&nbsp;YEARS&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING&nbsp;CALC_DATE&nbsp;=&nbsp;LV_BASE_DATE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LV_BASE_DATE(6)&nbsp;'10'&nbsp;INTO&nbsp;ZRBKP_22-ZFBDT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M004'.&nbsp;"&nbsp;##&nbsp;25#<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'RP_CALC_DATE_IN_INTERVAL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;DATE&nbsp;=&nbsp;LV_BASE_DATE&nbsp;DAYS&nbsp;=&nbsp;0&nbsp;MONTHS&nbsp;=&nbsp;1&nbsp;SIGNUM&nbsp;=&nbsp;'+'&nbsp;YEARS&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING&nbsp;CALC_DATE&nbsp;=&nbsp;LV_BASE_DATE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LV_BASE_DATE(6)&nbsp;'25'&nbsp;INTO&nbsp;ZRBKP_22-ZFBDT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;---&nbsp;###&nbsp;##&nbsp;(#&nbsp;#&nbsp;##)&nbsp;---<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M005'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'RP_CALC_DATE_IN_INTERVAL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;DATE&nbsp;=&nbsp;LV_BASE_DATE&nbsp;DAYS&nbsp;=&nbsp;0&nbsp;MONTHS&nbsp;=&nbsp;2&nbsp;SIGNUM&nbsp;=&nbsp;'+'&nbsp;YEARS&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING&nbsp;CALC_DATE&nbsp;=&nbsp;LV_BASE_DATE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LV_BASE_DATE(6)&nbsp;'10'&nbsp;INTO&nbsp;ZRBKP_22-ZFBDT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M006'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'RP_CALC_DATE_IN_INTERVAL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;DATE&nbsp;=&nbsp;LV_BASE_DATE&nbsp;DAYS&nbsp;=&nbsp;0&nbsp;MONTHS&nbsp;=&nbsp;2&nbsp;SIGNUM&nbsp;=&nbsp;'+'&nbsp;YEARS&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING&nbsp;CALC_DATE&nbsp;=&nbsp;LV_BASE_DATE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;LV_BASE_DATE(6)&nbsp;'25'&nbsp;INTO&nbsp;ZRBKP_22-ZFBDT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;---&nbsp;##&nbsp;###&nbsp;---<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P010'.&nbsp;ZRBKP_22-ZFBDT&nbsp;=&nbsp;LV_BASE_DATE&nbsp;+&nbsp;10.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P015'.&nbsp;ZRBKP_22-ZFBDT&nbsp;=&nbsp;LV_BASE_DATE&nbsp;+&nbsp;15.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P020'.&nbsp;ZRBKP_22-ZFBDT&nbsp;=&nbsp;LV_BASE_DATE&nbsp;+&nbsp;20.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P030'.&nbsp;ZRBKP_22-ZFBDT&nbsp;=&nbsp;LV_BASE_DATE&nbsp;+&nbsp;30.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P060'.&nbsp;ZRBKP_22-ZFBDT&nbsp;=&nbsp;LV_BASE_DATE&nbsp;+&nbsp;60.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P090'.&nbsp;ZRBKP_22-ZFBDT&nbsp;=&nbsp;LV_BASE_DATE&nbsp;+&nbsp;90.<br />
<br />
&nbsp;&nbsp;ENDCASE.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHECK_BASIC_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;[######]&nbsp;###(##,&nbsp;##)#&nbsp;##&nbsp;##&nbsp;###&nbsp;##<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CHECK_BASIC_DATA CHANGING pv_result TYPE c.<br />
<br />
&nbsp;&nbsp;pv_result&nbsp;=&nbsp;'E'.&nbsp;"&nbsp;###&nbsp;##<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;###&nbsp;##&nbsp;(##,&nbsp;###)<br />
&nbsp;&nbsp;IF&nbsp;ZRBKP_22-BLDAT&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'######&nbsp;#####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;ZRBKP_22-RMWWR&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;#####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;##&nbsp;(##&nbsp;##)<br />
&nbsp;&nbsp;PERFORM&nbsp;CALCULATE_BALANCE.<br />
&nbsp;&nbsp;IF&nbsp;BALANCE&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;###&nbsp;####&nbsp;####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;##<br />
&nbsp;&nbsp;pv_result&nbsp;=&nbsp;'S'.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHECK_STRICT_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;[###]&nbsp;####&nbsp;##,&nbsp;####,&nbsp;####&nbsp;###&nbsp;##<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CHECK_STRICT_DATA CHANGING pv_result TYPE c.<br />
<br />
&nbsp;&nbsp;pv_result&nbsp;=&nbsp;'E'.<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;[####]&nbsp;###&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ITEM&nbsp;WITH&nbsp;KEY&nbsp;CHECK&nbsp;=&nbsp;'X'&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;###&nbsp;###&nbsp;##&nbsp;##&nbsp;#####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;[####]&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;CASE&nbsp;ZRBKP_22-MWSKZ.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'V1'&nbsp;OR&nbsp;'V2'&nbsp;OR&nbsp;'V3'&nbsp;OR&nbsp;'V4'&nbsp;OR&nbsp;'V5'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;##&nbsp;#######.&nbsp;(V1~V5)'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;[####]&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;CASE&nbsp;ZRBKP_22-ZTERM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M001'&nbsp;OR&nbsp;'M002'&nbsp;OR&nbsp;'M003'&nbsp;OR&nbsp;'M004'&nbsp;OR&nbsp;'M005'&nbsp;OR&nbsp;'M006'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;'P010'&nbsp;OR&nbsp;'P015'&nbsp;OR&nbsp;'P020'&nbsp;OR&nbsp;'P030'&nbsp;OR&nbsp;'P060'&nbsp;OR&nbsp;'P090'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;##&nbsp;#######.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;"&nbsp;##<br />
&nbsp;&nbsp;pv_result&nbsp;=&nbsp;'S'.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CREATE_OBJECT_200<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CREATE_OBJECT_200 .<br />
" (1) ## #### ##<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_DOCKING_200<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SIDE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;CL_GUI_DOCKING_CONTAINER=&gt;DOCK_AT_BOTTOM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTENSION&nbsp;=&nbsp;2000.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"RATIO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;40.<br />
<br />
&nbsp;&nbsp;"&nbsp;(2)&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_GRID_200<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;=&nbsp;GC_DOCKING_200.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FIELD_CATALOG_200<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FIELD_CATALOG_200 .<br />
CLEAR : GS_FIELDCAT, GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;##&nbsp;(####)&nbsp;-&nbsp;####&nbsp;####&nbsp;##&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'CHECK'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CHECKBOX&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.&nbsp;"&nbsp;#####&nbsp;##&nbsp;####&nbsp;#<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;######<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'BELNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'######'.<br />
&nbsp;&nbsp;GS_FIELDCAT-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.&nbsp;"&nbsp;#&nbsp;###&nbsp;##&nbsp;(##&nbsp;##)<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;####<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'GJAHR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;4.&nbsp;######<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'BUZEI'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;5.&nbsp;######<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'EBELN'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'######'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;6.&nbsp;####<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;7.&nbsp;###<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'TXZ01'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;&nbsp;=&nbsp;20.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;8.&nbsp;####<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-QFIELDNAME&nbsp;=&nbsp;'MEINS'.&nbsp;"&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;9.&nbsp;##<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;9.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;10.&nbsp;##<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'STPRS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.&nbsp;"&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;11.&nbsp;####<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;11.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'WRBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;12.&nbsp;##<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;12.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'WMWST'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;13.&nbsp;##&nbsp;(###&nbsp;+&nbsp;##)<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;13.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'DMBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CFIELDNAME&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;14.&nbsp;###<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;14.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'SGTXT'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;15.&nbsp;###<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;15.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'WAERS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;16.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'LIFNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;"&nbsp;16.&nbsp;#/##&nbsp;###<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
*&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;16.<br />
*&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;&nbsp;=&nbsp;'SHKZG'.<br />
*&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'#/##'.<br />
*&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
   </div>
   <div class="code">
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_LAYOUT_200<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_LAYOUT_200 .<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_LAYOUT.<br />
&nbsp;&nbsp;GS_LAYOUT-CWIDTH_OPT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_LAYOUT-SEL_MODE&nbsp;&nbsp;&nbsp;=&nbsp;'A'.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALL_ALV_200<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALL_ALV_200 .<br />
CALL METHOD GC_GRID_200-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;=&nbsp;GT_FIELDCAT.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;REFRESH_ALV_200<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM REFRESH_ALV_200 .<br />
DATA: LS_STABLE TYPE LVC_S_STBL.<br />
&nbsp;&nbsp;LS_STABLE-ROW&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;LS_STABLE-COL&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_200-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_STABLE&nbsp;=&nbsp;LS_STABLE.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CANCLE_LINE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CANCEL_LINE .<br />
&nbsp;&nbsp;DATA:&nbsp;LV_CNT&nbsp;TYPE&nbsp;I.<br />
&nbsp;&nbsp;DATA:&nbsp;LS_ITEM_CHECK&nbsp;LIKE&nbsp;LINE&nbsp;OF&nbsp;GT_ITEM.<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;##&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;GC_GRID_200&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_200-&gt;CHECK_CHANGED_DATA.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;##&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;LS_ITEM_CHECK&nbsp;WHERE&nbsp;CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;LV_CNT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;##(H)#&nbsp;##&nbsp;#&nbsp;###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_ITEM_CHECK-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;##&nbsp;###(##)&nbsp;###&nbsp;####&nbsp;####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LV_CNT&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;###&nbsp;#####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;DATA:&nbsp;LV_ANSWER&nbsp;TYPE&nbsp;C.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'POPUP_TO_CONFIRM'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TITLEBAR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'##&nbsp;##'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_QUESTION&nbsp;=&nbsp;'###&nbsp;###&nbsp;##&nbsp;########?'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANSWER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LV_ANSWER.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LV_ANSWER&nbsp;&lt;&gt;&nbsp;'1'.&nbsp;RETURN.&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;-----------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;[##]&nbsp;#&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;-----------------------------------------------------------<br />
&nbsp;&nbsp;DATA:&nbsp;LV_MAX_BELNR&nbsp;TYPE&nbsp;ZRBKP_22-BELNR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_NEW_BELNR&nbsp;TYPE&nbsp;ZRBKP_22-BELNR.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;MAX(&nbsp;BELNR&nbsp;)&nbsp;FROM&nbsp;ZRBKP_22&nbsp;INTO&nbsp;LV_MAX_BELNR.<br />
&nbsp;&nbsp;IF&nbsp;LV_MAX_BELNR&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_NEW_BELNR&nbsp;=&nbsp;'5000000000'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_NEW_BELNR&nbsp;=&nbsp;LV_MAX_BELNR&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;-----------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;[1##]&nbsp;#&nbsp;##(#####)&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;-----------------------------------------------------------<br />
&nbsp;&nbsp;DATA:&nbsp;LS_RBKP_NEW&nbsp;TYPE&nbsp;ZRBKP_22,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG_NEW&nbsp;TYPE&nbsp;ZRSEG_22,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_RSEG_NEW&nbsp;TYPE&nbsp;TABLE&nbsp;OF&nbsp;ZRSEG_22.<br />
<br />
&nbsp;&nbsp;"&nbsp;###&nbsp;#&nbsp;##&nbsp;####&nbsp;##&nbsp;##&nbsp;###&nbsp;###<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM&nbsp;WITH&nbsp;KEY&nbsp;CHECK&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;FROM&nbsp;ZRBKP_22&nbsp;INTO&nbsp;LS_RBKP_NEW<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;GS_ITEM-BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;GJAHR&nbsp;=&nbsp;GS_ITEM-GJAHR.<br />
<br />
&nbsp;&nbsp;"&nbsp;#&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP_NEW-BELNR&nbsp;&nbsp;=&nbsp;LV_NEW_BELNR.&nbsp;&nbsp;"&nbsp;#&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP_NEW-GJAHR&nbsp;&nbsp;=&nbsp;SY-DATUM(4).&nbsp;&nbsp;&nbsp;"&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP_NEW-BLDAT&nbsp;&nbsp;=&nbsp;SY-DATUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP_NEW-BUDAT&nbsp;&nbsp;=&nbsp;SY-DATUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP_NEW-BLART&nbsp;&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;####:&nbsp;##&nbsp;##(##)<br />
&nbsp;&nbsp;LS_RBKP_NEW-RBSTAT&nbsp;=&nbsp;'5'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##:&nbsp;###<br />
&nbsp;&nbsp;LS_RBKP_NEW-STBLG&nbsp;&nbsp;=&nbsp;GS_ITEM-BELNR.&nbsp;"&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP_NEW-STJAH&nbsp;&nbsp;=&nbsp;GS_ITEM-GJAHR.&nbsp;"&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;LS_RBKP_NEW-RMWWR&nbsp;&nbsp;=&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(##&nbsp;####&nbsp;##)<br />
&nbsp;&nbsp;LS_RBKP_NEW-WMWST&nbsp;&nbsp;=&nbsp;0.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(##&nbsp;####&nbsp;##)<br />
<br />
&nbsp;&nbsp;"&nbsp;-----------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;[2##]&nbsp;###&nbsp;##&nbsp;##&nbsp;(#&nbsp;##&nbsp;##&nbsp;+&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;"&nbsp;-----------------------------------------------------------<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM&nbsp;WHERE&nbsp;CHECK&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(A)&nbsp;#&nbsp;###&nbsp;##&nbsp;(INSERT#)&nbsp;-&gt;&nbsp;##(H)<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_RSEG_NEW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ITEM&nbsp;TO&nbsp;LS_RSEG_NEW.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG_NEW-BELNR&nbsp;=&nbsp;LV_NEW_BELNR.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;#&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG_NEW-GJAHR&nbsp;=&nbsp;LS_RBKP_NEW-GJAHR.&nbsp;&nbsp;"&nbsp;#&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG_NEW-SHKZG&nbsp;=&nbsp;'H'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;#&nbsp;##&nbsp;(Credit)<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG_NEW-LOEKZ&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;#&nbsp;#&nbsp;###&nbsp;##&nbsp;##(##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG_NEW-SGTXT&nbsp;=&nbsp;'##&nbsp;##'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;###<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;(###)<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP_NEW-RMWWR&nbsp;=&nbsp;LS_RBKP_NEW-RMWWR&nbsp;+&nbsp;GS_ITEM-DMBTR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_RBKP_NEW-WMWST&nbsp;=&nbsp;LS_RBKP_NEW-WMWST&nbsp;+&nbsp;GS_ITEM-WMWST.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_RSEG_NEW&nbsp;TO&nbsp;LT_RSEG_NEW.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(B)&nbsp;##&nbsp;###&nbsp;##&nbsp;(UPDATE#)&nbsp;-&gt;&nbsp;####(X)<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;###&nbsp;SHKZG(S)#&nbsp;####&nbsp;##&nbsp;LOEKZ#&nbsp;X#&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;ZRSEG_22<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;LOEKZ&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;GS_ITEM-BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;GJAHR&nbsp;=&nbsp;GS_ITEM-GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;BUZEI&nbsp;=&nbsp;GS_ITEM-BUZEI.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;###&nbsp;####&nbsp;##.&nbsp;#&nbsp;##&nbsp;#####.'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"&nbsp;-----------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;[3##]&nbsp;DB&nbsp;##&nbsp;#&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;-----------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;1)&nbsp;#&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;INSERT&nbsp;ZRBKP_22&nbsp;FROM&nbsp;LS_RBKP_NEW.<br />
&nbsp;&nbsp;INSERT&nbsp;ZRSEG_22&nbsp;FROM&nbsp;TABLE&nbsp;LT_RSEG_NEW.<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;2)&nbsp;##&nbsp;###&nbsp;'###&nbsp;####'&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;ZRBKP_22<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;STBLG&nbsp;=&nbsp;LV_NEW_BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STJAH&nbsp;=&nbsp;SY-DATUM(4)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;GS_ITEM-BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;GJAHR&nbsp;=&nbsp;GS_ITEM-GJAHR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;3)&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"MESSAGE&nbsp;'##&nbsp;##(KG)#&nbsp;#######.&nbsp;###&nbsp;##&nbsp;#######.'&nbsp;TYPE&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'#######.'&nbsp;TYPE&nbsp;'S'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;4)&nbsp;##&nbsp;##&nbsp;(###&nbsp;#&nbsp;#####&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;REFRESH_ITEMS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_200-&gt;REFRESH_TABLE_DISPLAY.<br />
<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'DB&nbsp;##&nbsp;#&nbsp;###&nbsp;######.'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*DATA:&nbsp;LV_CNT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;I,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MAX_BUZEI&nbsp;TYPE&nbsp;ZRSEG_22-BUZEI.<br />
*<br />
*&nbsp;&nbsp;DATA:&nbsp;LS_RSEG_NEW&nbsp;&nbsp;TYPE&nbsp;ZRSEG_22.&nbsp;"&nbsp;##&nbsp;###&nbsp;##&nbsp;##<br />
*<br />
*&nbsp;&nbsp;"&nbsp;1.&nbsp;####&nbsp;##<br />
*&nbsp;&nbsp;IF&nbsp;GC_GRID_200&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_200-&gt;CHECK_CHANGED_DATA.<br />
*&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;##<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;TRANSPORTING&nbsp;NO&nbsp;FIELDS&nbsp;WHERE&nbsp;CHECK&nbsp;=&nbsp;'X'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;LV_CNT.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
*<br />
*&nbsp;&nbsp;IF&nbsp;LV_CNT&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;###&nbsp;#####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
*&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;"&nbsp;3.&nbsp;##&nbsp;##<br />
*&nbsp;&nbsp;DATA:&nbsp;LV_ANSWER&nbsp;TYPE&nbsp;C.<br />
*&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'POPUP_TO_CONFIRM'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TITLEBAR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'###&nbsp;##'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_QUESTION&nbsp;=&nbsp;'###&nbsp;###&nbsp;##&nbsp;###(##)&nbsp;###&nbsp;########?'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANSWER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LV_ANSWER.<br />
*&nbsp;&nbsp;IF&nbsp;LV_ANSWER&nbsp;&lt;&gt;&nbsp;'1'.&nbsp;RETURN.&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;CLEAR&nbsp;LV_CNT.<br />
*<br />
*&nbsp;&nbsp;"&nbsp;4.&nbsp;###&nbsp;##&nbsp;##<br />
*&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM&nbsp;WHERE&nbsp;CHECK&nbsp;=&nbsp;'X'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(1)&nbsp;###&nbsp;##:&nbsp;##&nbsp;'H'(####)#&nbsp;#&nbsp;#&nbsp;##&nbsp;##<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ITEM-SHKZG&nbsp;=&nbsp;'H'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;###(##)&nbsp;###&nbsp;####&nbsp;####.'&nbsp;TYPE&nbsp;'S'&nbsp;DISPLAY&nbsp;LIKE&nbsp;'E'.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(2)&nbsp;##&nbsp;###&nbsp;##&nbsp;###&nbsp;####(BUZEI)&nbsp;##<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(#&nbsp;###&nbsp;####&nbsp;###&nbsp;###&nbsp;##&nbsp;#)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;MAX(&nbsp;BUZEI&nbsp;)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_MAX_BUZEI<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG_22<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;GS_ITEM-BELNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;GJAHR&nbsp;=&nbsp;GS_ITEM-GJAHR.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(3)&nbsp;#&nbsp;###&nbsp;###&nbsp;##&nbsp;(INSERT#)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;LS_RSEG_NEW.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_ITEM&nbsp;TO&nbsp;LS_RSEG_NEW.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG_NEW-BUZEI&nbsp;=&nbsp;LV_MAX_BUZEI&nbsp;+&nbsp;1.&nbsp;"&nbsp;##&nbsp;##&nbsp;(1&nbsp;-&gt;&nbsp;2)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG_NEW-SHKZG&nbsp;=&nbsp;'H'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;#&nbsp;##:&nbsp;##(H)##&nbsp;##<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG_NEW-LOEKZ&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;##<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LS_RSEG_NEW-SGTXT&nbsp;=&nbsp;'##(###)'.&nbsp;&nbsp;&nbsp;"&nbsp;##<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(4)&nbsp;DB#&nbsp;#&nbsp;##&nbsp;##&nbsp;(INSERT)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;ZRSEG_22&nbsp;FROM&nbsp;LS_RSEG_NEW.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADD&nbsp;1&nbsp;TO&nbsp;LV_CNT.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;(5)&nbsp;##&nbsp;##&nbsp;##&nbsp;(##&nbsp;###&nbsp;##)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;##(S)&nbsp;10000#&nbsp;+&nbsp;##(H)&nbsp;10000#&nbsp;-&gt;&nbsp;###&nbsp;0##&nbsp;###&nbsp;#<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;ZRBKP_22<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;RMWWR&nbsp;=&nbsp;RMWWR&nbsp;-&nbsp;LS_RSEG_NEW-WRBTR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WMWST&nbsp;=&nbsp;WMWST&nbsp;-&nbsp;LS_RSEG_NEW-WMWST<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;GS_ITEM-BELNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;GJAHR&nbsp;=&nbsp;GS_ITEM-GJAHR.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;ENDLOOP.<br />
*<br />
*&nbsp;&nbsp;"&nbsp;5.&nbsp;##&nbsp;##<br />
*&nbsp;&nbsp;IF&nbsp;LV_CNT&nbsp;&gt;&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK&nbsp;AND&nbsp;WAIT.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;###&nbsp;#######.&nbsp;(S&nbsp;+&nbsp;H&nbsp;=&nbsp;0)'&nbsp;TYPE&nbsp;'S'.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;##<br />
*&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_INVOICE_DATA.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_200-&gt;REFRESH_TABLE_DISPLAY.<br />
*&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;#&nbsp;###&nbsp;######.'&nbsp;TYPE&nbsp;'E'.<br />
*&nbsp;&nbsp;ENDIF.<br />
   </div>
   <div class="code">
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;SELECT_INVOICE_LIST&nbsp;(##&nbsp;##&nbsp;##)<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SELECT_INVOICE_LIST.<br />
CLEAR: GT_DOC_LIST.<br />
<br />
&nbsp;&nbsp;"&nbsp;[##]<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;##(RE)&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;LOEKZ&nbsp;##&nbsp;##&nbsp;-&gt;&nbsp;##&nbsp;####&nbsp;######&nbsp;##&nbsp;####&nbsp;###&nbsp;(###&nbsp;##)<br />
&nbsp;&nbsp;SELECT&nbsp;DISTINCT&nbsp;A~BELNR&nbsp;A~GJAHR&nbsp;A~BUDAT&nbsp;A~LIFNR&nbsp;A~RMWWR&nbsp;A~WAERS<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_DOC_LIST<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRBKP_22&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZRSEG_22&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BELNR&nbsp;=&nbsp;B~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;B~GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;B~EBELN&nbsp;=&nbsp;P_EBELN2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;B~WERKS&nbsp;=&nbsp;P_WERKS2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~RBSTAT&nbsp;=&nbsp;'5'&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~BLART&nbsp;&nbsp;=&nbsp;'RE'&nbsp;&nbsp;&nbsp;"&nbsp;##(RE)#&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;A~BUDAT&nbsp;DESCENDING&nbsp;A~BELNR&nbsp;DESCENDING.&nbsp;"&nbsp;&lt;---&nbsp;[##]&nbsp;##(,)&nbsp;###!<br />
<br />
&nbsp;&nbsp;"&nbsp;####&nbsp;###&nbsp;#&nbsp;##&nbsp;#&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;GT_DOC_LIST&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_DETAIL_DATA&nbsp;USING&nbsp;1.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;GS_RBKP,&nbsp;GT_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GC_GRID_200&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_200-&gt;REFRESH_TABLE_DISPLAY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;##&nbsp;###&nbsp;####.'&nbsp;TYPE&nbsp;'S'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;GET_DETAIL_DATA&nbsp;(##&nbsp;##:&nbsp;##+###)<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_DETAIL_DATA USING P_INDEX.<br />
<br />
DATA: LS_DOC LIKE LINE OF GT_DOC_LIST.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_DOC_LIST&nbsp;INTO&nbsp;LS_DOC&nbsp;INDEX&nbsp;P_INDEX.<br />
&nbsp;&nbsp;CHECK&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;##&nbsp;##&nbsp;###<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_RBKP.<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;GS_RBKP<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRBKP_22<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;LS_DOC-BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;GJAHR&nbsp;=&nbsp;LS_DOC-GJAHR.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;###&nbsp;##&nbsp;###&nbsp;(###&nbsp;#&nbsp;##)<br />
&nbsp;&nbsp;REFRESH&nbsp;GT_ITEM.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;A~BELNR&nbsp;A~GJAHR&nbsp;A~BUZEI&nbsp;A~EBELN&nbsp;A~EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~MATNR&nbsp;A~TXZ01&nbsp;A~WERKS&nbsp;A~WRBTR&nbsp;A~MENGE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BSTME&nbsp;AS&nbsp;MEINS&nbsp;A~MWSKZ&nbsp;A~WMWST&nbsp;A~SHKZG&nbsp;A~LOEKZ&nbsp;A~STPRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~SGTXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~WAERS&nbsp;B~LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG_22&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZRBKP_22&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BELNR&nbsp;=&nbsp;B~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;B~GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~BELNR&nbsp;=&nbsp;LS_DOC-BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;LS_DOC-GJAHR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;AND&nbsp;A~LOEKZ&nbsp;&lt;&gt;&nbsp;'X'.&nbsp;&nbsp;"&nbsp;#&nbsp;###(X)&nbsp;###&nbsp;##&nbsp;ALV##&nbsp;#&nbsp;##<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;(###&nbsp;+&nbsp;##)<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-DMBTR&nbsp;=&nbsp;GS_ITEM-WRBTR&nbsp;+&nbsp;GS_ITEM-WMWST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM&nbsp;FROM&nbsp;GS_ITEM.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;SET_ALV_200&nbsp;(##&nbsp;2#&nbsp;##&nbsp;#&nbsp;##)<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SET_ALV_200.<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;[##]&nbsp;##&nbsp;ALV&nbsp;##<br />
&nbsp;&nbsp;IF&nbsp;GC_DOCK_LEFT&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_DOCK_LEFT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SIDE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;CL_GUI_DOCKING_CONTAINER=&gt;DOCK_AT_LEFT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTENSION&nbsp;=&nbsp;190.&nbsp;"&nbsp;##&nbsp;190<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_GRID_LEFT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;I_PARENT&nbsp;=&nbsp;GC_DOCK_LEFT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;###&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GO_EVENT&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_EVENT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_EVENT-&gt;HANDLE_DOUBLE_CLICK&nbsp;FOR&nbsp;GC_GRID_LEFT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;BUILD_FCAT_LEFT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;LS_LAY_L&nbsp;TYPE&nbsp;LVC_S_LAYO.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_LAY_L-CWIDTH_OPT&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_LAY_L-SEL_MODE&nbsp;&nbsp;&nbsp;=&nbsp;'A'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_LAY_L-NO_TOOLBAR&nbsp;=&nbsp;'X'.&nbsp;"&nbsp;##&nbsp;##<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_LEFT-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;LS_LAY_L<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_DOC_LIST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;=&nbsp;GT_FIELDCAT.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_LEFT-&gt;REFRESH_TABLE_DISPLAY.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;[##]&nbsp;##&nbsp;ALV&nbsp;##&nbsp;(##&nbsp;##&nbsp;GC_DOCKING_200&nbsp;##)<br />
&nbsp;&nbsp;IF&nbsp;GC_DOCKING_200&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_DOCKING_200<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SIDE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;CL_GUI_DOCKING_CONTAINER=&gt;DOCK_AT_BOTTOM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXTENSION&nbsp;=&nbsp;200.&nbsp;"&nbsp;##&nbsp;200<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_GRID_200<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;I_PARENT&nbsp;=&nbsp;GC_DOCKING_200.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;FIELD_CATALOG_200.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;ALV_LAYOUT_200.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_200-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;=&nbsp;GT_FIELDCAT.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;###&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;DATA:&nbsp;LS_STABLE&nbsp;TYPE&nbsp;LVC_S_STBL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_STABLE-ROW&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_STABLE-COL&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_200-&gt;REFRESH_TABLE_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;IS_STABLE&nbsp;=&nbsp;LS_STABLE.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;BUILD_FCAT_LEFT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM BUILD_FCAT_LEFT.<br />
&nbsp;&nbsp;CLEAR:&nbsp;GT_FIELDCAT,&nbsp;GS_FIELDCAT.<br />
<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BELNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;GS_FIELDCAT-KEY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BUDAT'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;&nbsp;&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;Form&nbsp;REFRESH_ITEMS&nbsp;(##&nbsp;###&nbsp;##)<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM REFRESH_ITEMS.<br />
" ## ## ## ##(GS_RBKP) ## ###<br />
&nbsp;&nbsp;REFRESH&nbsp;GT_ITEM.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;A~BELNR&nbsp;A~GJAHR&nbsp;A~BUZEI&nbsp;A~EBELN&nbsp;A~EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~MATNR&nbsp;A~TXZ01&nbsp;A~WERKS&nbsp;A~WRBTR&nbsp;A~MENGE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BSTME&nbsp;AS&nbsp;MEINS&nbsp;A~MWSKZ&nbsp;A~WMWST&nbsp;A~SHKZG&nbsp;A~LOEKZ&nbsp;A~STPRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~SGTXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B~WAERS&nbsp;B~LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG_22&nbsp;AS&nbsp;A<br />
&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZRBKP_22&nbsp;AS&nbsp;B<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BELNR&nbsp;=&nbsp;B~BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;B~GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~BELNR&nbsp;=&nbsp;GS_RBKP-BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;GS_RBKP-GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~LOEKZ&nbsp;&lt;&gt;&nbsp;'X'.&nbsp;&nbsp;"&nbsp;#&nbsp;##&nbsp;###&nbsp;##&nbsp;###&nbsp;-&gt;&nbsp;###<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;###<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-DMBTR&nbsp;=&nbsp;GS_ITEM-WRBTR&nbsp;+&nbsp;GS_ITEM-WMWST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM&nbsp;FROM&nbsp;GS_ITEM.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_INVOICE_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*FORM&nbsp;GET_INVOICE_DATA&nbsp;.<br />
*REFRESH&nbsp;GT_ITEM.<br />
*<br />
*&nbsp;&nbsp;"&nbsp;[##]&nbsp;LOEKZ&nbsp;##&nbsp;##&nbsp;-&gt;&nbsp;S#&nbsp;H&nbsp;##&nbsp;##<br />
*&nbsp;&nbsp;SELECT&nbsp;A~BELNR,&nbsp;A~GJAHR,&nbsp;A~BUZEI,&nbsp;A~EBELN,&nbsp;A~EBELP,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~MATNR,&nbsp;A~TXZ01,&nbsp;A~WERKS,&nbsp;A~WRBTR,&nbsp;A~MENGE,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~BSTME&nbsp;AS&nbsp;MEINS,&nbsp;A~MWSKZ,&nbsp;A~WMWST,&nbsp;B~WAERS,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A~SHKZG,&nbsp;A~LOEKZ,&nbsp;A~STPRS,&nbsp;A~SGTXT,&nbsp;B~LIFNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;@GT_ITEM<br />
*&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZRSEG_22&nbsp;AS&nbsp;A<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZRBKP_22&nbsp;AS&nbsp;B<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;A~BELNR&nbsp;=&nbsp;B~BELNR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~GJAHR&nbsp;=&nbsp;B~GJAHR<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;A~EBELN&nbsp;=&nbsp;@P_EBELN2<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;A~WERKS&nbsp;=&nbsp;@P_WERKS2.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;AND&nbsp;A~LOEKZ&nbsp;&lt;&gt;&nbsp;'X'.&nbsp;&lt;---&nbsp;#&nbsp;###&nbsp;###!&nbsp;(H#&nbsp;###&nbsp;###)<br />
*<br />
*&nbsp;&nbsp;"&nbsp;##&nbsp;##<br />
*&nbsp;&nbsp;IF&nbsp;GT_ITEM[]&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;H(##)#&nbsp;##&nbsp;#####&nbsp;####&nbsp;##&nbsp;(###&nbsp;##&nbsp;###&nbsp;###)<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-DMBTR&nbsp;=&nbsp;GS_ITEM-WRBTR&nbsp;+&nbsp;GS_ITEM-WMWST.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM&nbsp;FROM&nbsp;GS_ITEM.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
*&nbsp;&nbsp;ENDIF.<br />
*ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">Extracted by Mass Download version 1.5.5 - E.G.Mellodew. 1998-2025. Sap Release 750</td>
   </tr>
</table>
</body>
</html>
