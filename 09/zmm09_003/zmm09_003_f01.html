<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=ISO-8859-1" />
<title>ZMM09_003_F01</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZMM09_003_F01</h2>
<h3> Description: </h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;Include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZMM09_003_F01<br />
*&---------------------------------------------------------------------*<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CONTROL_SCREEN<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CONTROL_SCREEN .<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;SCREEN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;P_R1&nbsp;=&nbsp;'X'.&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;P_R2&nbsp;=&nbsp;'X'.&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'C'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;SCREEN-GROUP1&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREEN-ACTIVE&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;SCREEN.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_SCREEN<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SET_SCREEN .<br />
&nbsp;&nbsp;IF&nbsp;P_R1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_BUDAT&nbsp;=&nbsp;SY-DATUM.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;VALID_INPUT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM VALID_INPUT .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_EBELN&nbsp;LIKE&nbsp;ZEKKO_09-EBELN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_WERKS&nbsp;LIKE&nbsp;ZEKPO_09-WERKS.<br />
<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;EBELN&nbsp;WERKS<br />
&nbsp;&nbsp;FROM&nbsp;ZEKPO_09<br />
&nbsp;&nbsp;INTO&nbsp;(&nbsp;LV_EBELN,&nbsp;LV_WERKS&nbsp;)<br />
&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_EBELNC<br />
&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;WERKS&nbsp;=&nbsp;P_WERKSC.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;#####&nbsp;####&nbsp;##&nbsp;#####&nbsp;####&nbsp;####.'&nbsp;TYPE&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;STOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;VALID_INPUT_ALL<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM VALID_INPUT_ALL .<br />
&nbsp;&nbsp;IF&nbsp;P_R1&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;P_EBELNC&nbsp;IS&nbsp;INITIAL&nbsp;)&nbsp;OR&nbsp;(&nbsp;P_WERKSC&nbsp;IS&nbsp;INITIAL&nbsp;)&nbsp;OR&nbsp;(&nbsp;P_BUDAT&nbsp;IS&nbsp;INITIAL&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####,&nbsp;###,&nbsp;######&nbsp;########'&nbsp;TYPE&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ELSEIF&nbsp;P_R2&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;P_EBELNS&nbsp;IS&nbsp;INITIAL&nbsp;)&nbsp;OR&nbsp;(&nbsp;P_WERKSS&nbsp;IS&nbsp;INITIAL&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####,&nbsp;####&nbsp;########'&nbsp;TYPE&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STOP.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_MBLNR<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_MBLNR  CHANGING P_MBLNR.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'NUMBER_GET_NEXT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR&nbsp;=&nbsp;'01'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;=&nbsp;'ZMBLNR09'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NUMBER&nbsp;=&nbsp;P_MBLNR.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_ITAB<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_ITAB .<br />
<br />
&nbsp;&nbsp;TYPES&nbsp;:&nbsp;BEGIN&nbsp;OF&nbsp;TY_GR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;EBELN&nbsp;TYPE&nbsp;EBELN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;EBELP&nbsp;TYPE&nbsp;EBELP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;GR_DONE&nbsp;TYPE&nbsp;MENGE_D,<br />
&nbsp;&nbsp;END&nbsp;OF&nbsp;TY_GR.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LT_GR&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;TY_GR,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_GR&nbsp;TYPE&nbsp;TY_GR.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GT_ITEM,&nbsp;LT_GR.<br />
<br />
&nbsp;&nbsp;"ZEKKO_09&nbsp;(####)&nbsp;####&nbsp;##&nbsp;##&nbsp;###<br />
&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;a~EBELN&nbsp;"######<br />
&nbsp;&nbsp;&nbsp;&nbsp;b~EBELP&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;a~LIFNR&nbsp;"###<br />
&nbsp;&nbsp;&nbsp;&nbsp;a~BEDAT&nbsp;"###<br />
&nbsp;&nbsp;&nbsp;&nbsp;b~MATNR&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;&nbsp;c~ZMATNAME&nbsp;"###<br />
&nbsp;&nbsp;&nbsp;&nbsp;b~MENGE&nbsp;"##&nbsp;(PO##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;b~MEINS&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;b~STPRS&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;a~WAERS&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;b~PRDAT&nbsp;"###<br />
&nbsp;&nbsp;&nbsp;&nbsp;b~WERKS&nbsp;"###<br />
&nbsp;&nbsp;&nbsp;&nbsp;b~LGORT&nbsp;"####<br />
&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_ITEM<br />
&nbsp;&nbsp;FROM&nbsp;ZEKKO_09&nbsp;AS&nbsp;a<br />
&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZEKPO_09&nbsp;AS&nbsp;b<br />
&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;a~EBELN&nbsp;=&nbsp;b~EBELN<br />
&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZMARA09&nbsp;AS&nbsp;c<br />
&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;b~MATNR&nbsp;=&nbsp;c~ZMATNR<br />
&nbsp;&nbsp;WHERE&nbsp;a~EBELN&nbsp;=&nbsp;P_EBELNC&nbsp;"####&nbsp;##<br />
&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;b~WERKS&nbsp;=&nbsp;P_WERKSC.<br />
<br />
&nbsp;&nbsp;"######&nbsp;#####&nbsp;####<br />
&nbsp;&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EBELN,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EBELP,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUM(&nbsp;CASE&nbsp;SHKZG&nbsp;WHEN&nbsp;'S'&nbsp;THEN&nbsp;MENGE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'H'&nbsp;THEN&nbsp;MENGE&nbsp;*&nbsp;-1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;)&nbsp;AS&nbsp;GR_DONE<br />
&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMSEG09<br />
&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;@P_EBELNC<br />
&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;WERKS&nbsp;=&nbsp;@P_WERKSC<br />
&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;BWART&nbsp;IN&nbsp;('101',&nbsp;'102')&nbsp;"#543&nbsp;###&nbsp;###&nbsp;######&nbsp;#####&nbsp;##&nbsp;#<br />
&nbsp;&nbsp;&nbsp;GROUP&nbsp;BY&nbsp;EBELN,&nbsp;EBELP<br />
&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;@LT_GR.<br />
<br />
&nbsp;&nbsp;"######,&nbsp;####,&nbsp;######<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_ITEM,&nbsp;LS_GR.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;LT_GR&nbsp;WITH&nbsp;KEY&nbsp;EBELN&nbsp;=&nbsp;GS_ITEM-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EBELP&nbsp;=&nbsp;GS_ITEM-EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LS_GR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-GR_DONE&nbsp;=&nbsp;LS_GR-GR_DONE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-GR_DONE&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-GR_REM&nbsp;=&nbsp;GS_ITEM-MENGE&nbsp;-&nbsp;GS_ITEM-GR_DONE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-GR_REM&nbsp;=&nbsp;GS_ITEM-MENGE&nbsp;-&nbsp;GS_ITEM-GR_DONE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ITEM-GR_REM&nbsp;&lt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM-GR_REM&nbsp;=&nbsp;0.&nbsp;"##&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM&nbsp;FROM&nbsp;GS_ITEM&nbsp;TRANSPORTING&nbsp;GR_DONE&nbsp;GR_REM&nbsp;GR_NOW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;GS_ITEM-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;EBELP&nbsp;=&nbsp;GS_ITEM-EBELP.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"#####&nbsp;0#&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;DELETE&nbsp;GT_ITEM&nbsp;WHERE&nbsp;GR_REM&nbsp;&lt;=&nbsp;0.<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SAVE_DATA<br />
*&---------------------------------------------------------------------*<br />
<br />
   </div>
   <div class="code">
FORM SAVE_DATA .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_MTART&nbsp;LIKE&nbsp;ZMARA09-MTART,&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_PSTYP&nbsp;LIKE&nbsp;ZEKPO_09-PSTYP,&nbsp;"PO###&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_LINE_ID&nbsp;TYPE&nbsp;N&nbsp;LENGTH&nbsp;3&nbsp;VALUE&nbsp;'000',&nbsp;"MSEG&nbsp;LINE&nbsp;ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_BUZEI&nbsp;TYPE&nbsp;N&nbsp;LENGTH&nbsp;3&nbsp;VALUE&nbsp;'000',&nbsp;&nbsp;&nbsp;"BSEG&nbsp;LINE&nbsp;ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_LINE_ID_B&nbsp;TYPE&nbsp;N&nbsp;LENGTH&nbsp;3&nbsp;VALUE&nbsp;'000'.&nbsp;"BSEG2&nbsp;LINE&nbsp;IN(##&nbsp;####&nbsp;##)<br />
<br />
<br />
<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_MBLNR&nbsp;CHANGING&nbsp;GF_MBLNR.&nbsp;"##&nbsp;(####)<br />
&nbsp;&nbsp;PERFORM&nbsp;BUILD_MKPF&nbsp;USING&nbsp;GF_MBLNR.&nbsp;"####&nbsp;##&nbsp;(##)<br />
<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_BELNR&nbsp;CHANGING&nbsp;GV_BELNR.&nbsp;"####&nbsp;##&nbsp;##&nbsp;(##)<br />
&nbsp;&nbsp;PERFORM&nbsp;BUILD_BKPF&nbsp;USING&nbsp;GV_BELNR.&nbsp;"####&nbsp;##&nbsp;(##)<br />
<br />
<br />
&nbsp;&nbsp;"&nbsp;3.&nbsp;####/####&nbsp;##<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM&nbsp;WHERE&nbsp;L_CHECK&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LV_MTART.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##&nbsp;####&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;MTART<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMARA09<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_MTART&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZMATNR&nbsp;=&nbsp;GS_ITEM-MATNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##&nbsp;PO##&nbsp;####&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;PSTYP<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZEKPO_09<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_PSTYP<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;GS_ITEM-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;EBELP&nbsp;=&nbsp;GS_ITEM-EBELP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"#####&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_MTART&nbsp;=&nbsp;'Z001'&nbsp;AND&nbsp;LV_PSTYP&nbsp;=&nbsp;'L'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_ZMZEILE&nbsp;TYPE&nbsp;ZBSEG09-ZMZEILE.&nbsp;"##&nbsp;101(###)#&nbsp;ZMZEILE<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"#####&nbsp;####<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;BUILD_MSEG_101_OUTS&nbsp;USING&nbsp;GS_ITEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"###&nbsp;##&nbsp;MSEG&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LV_LINE_ID.&nbsp;&nbsp;"####&nbsp;ZEILE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_ZMZEILE&nbsp;=&nbsp;LV_LINE_ID.&nbsp;"##&nbsp;#####&nbsp;##&nbsp;###<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;BUILD_MSEG_543_CONS&nbsp;USING&nbsp;GS_ITEM&nbsp;"###&nbsp;##&nbsp;543&nbsp;MSEG&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LV_LINE_ID.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"#####&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;BUILD_BSEG_OUTS&nbsp;USING&nbsp;GS_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_ZMZEILE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LV_LINE_ID_B.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"####&nbsp;(##/###/###/###_####)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;BUILD_MSEG_101_STD&nbsp;USING&nbsp;GS_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LV_LINE_ID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;BUILD_BSEG_STD&nbsp;USING&nbsp;GS_ITEM&nbsp;LV_LINE_ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LV_BUZEI.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.&nbsp;"####&nbsp;###&nbsp;LOOP<br />
<br />
&nbsp;&nbsp;"DB&nbsp;##&nbsp;-&nbsp;##&nbsp;#&nbsp;###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;PERFORM&nbsp;SAVE_TO_DB.<br />
<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_DATA .<br />
&nbsp;&nbsp;"#######&nbsp;####<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_GOODS_LIST.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_GOODS_LIST<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_GOODS_LIST.<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_GOODS_LIST,&nbsp;GT_GOODS_LIST.<br />
<br />
&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISTINCT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a~BUDAT<br />
&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_GOODS_LIST<br />
&nbsp;&nbsp;FROM&nbsp;ZMKPF09&nbsp;AS&nbsp;a&nbsp;"####&nbsp;##&nbsp;(a),&nbsp;###&nbsp;(b)<br />
&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;ZMSEG09&nbsp;AS&nbsp;b<br />
&nbsp;&nbsp;&nbsp;&nbsp;ON&nbsp;a~MBLNR&nbsp;=&nbsp;b~MBLNR<br />
&nbsp;&nbsp;WHERE&nbsp;b~EBELN&nbsp;=&nbsp;P_EBELNS&nbsp;"####<br />
&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;b~WERKS&nbsp;=&nbsp;P_WERKSS&nbsp;"###<br />
&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;b~BWART&nbsp;=&nbsp;'101'.&nbsp;&nbsp;&nbsp;"101#&nbsp;(##/###&nbsp;###&nbsp;##&nbsp;####)&nbsp;#####&nbsp;####<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;#####&nbsp;####&nbsp;####&nbsp;#####&nbsp;####&nbsp;####'&nbsp;TYPE&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;STOP.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CREATE_OBJECT_GOODS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CREATE_OBJECT_GOODS .<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_CUSTOM_GOODS_LIST<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'CON1'.<br />
<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_GRID_GOODS_LIST<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GC_CUSTOM_GOODS_LIST.<br />
<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALL_ALV<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALL_ALV .<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_GOODS_LIST-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_TOOLBAR_EXCLUDING&nbsp;=&nbsp;GT_TOOLBAR<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_GOODS_ALV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_FIELDCAT.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FIELD_CATALOG<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FIELD_CATALOG .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT,&nbsp;GT_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'DISP_TEXT'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####&nbsp;(###)&nbsp;'.<br />
&nbsp;&nbsp;GS_FIELDCAT-OUTPUTLEN&nbsp;=&nbsp;50.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;MODIFY_DATA<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM MODIFY_DATA .<br />
&nbsp;&nbsp;"####&nbsp;###&nbsp;alv###<br />
&nbsp;&nbsp;PERFORM&nbsp;MODIFY_GOODS_LIST.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;MODIFY_GOODS_LIST<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM MODIFY_GOODS_LIST .<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_GOODS_LIST.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_GOODS_LIST&nbsp;INTO&nbsp;GS_GOODS_LIST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"####&nbsp;(&nbsp;###&nbsp;)&nbsp;#&nbsp;###<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;GS_GOODS_LIST-MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;('&nbsp;GS_GOODS_LIST-BUDAT&nbsp;')'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;GS_GOODS_ALV-DISP_TEXT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_GOODS_ALV&nbsp;TO&nbsp;GT_GOODS_ALV.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_GOODS_LIST.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;DELETE_TOOLBAR<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM DELETE_TOOLBAR .<br />
&nbsp;&nbsp;APPEND&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_EXCL_ALL&nbsp;TO&nbsp;GT_TOOLBAR.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_HANDLER_DOUBLE_CLICK<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_HANDLER_DOUBLE_CLICK  USING    P_ROW TYPE LVC_S_ROW "Line ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_COLUMN&nbsp;TYPE&nbsp;LVC_S_COL&nbsp;"Column&nbsp;Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_ROW_NO&nbsp;TYPE&nbsp;LVC_S_ROID.&nbsp;"Numeric&nbsp;Row&nbsp;ID<br />
&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_GOODS_LIST.<br />
&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_GOODS_LIST&nbsp;INTO&nbsp;GS_GOODS_LIST&nbsp;INDEX&nbsp;P_ROW_NO-ROW_ID.<br />
&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;######&nbsp;#####&nbsp;###&nbsp;######'&nbsp;TYPE&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;PERFORM&nbsp;GET_HEADER_AND_ITEMS&nbsp;USING&nbsp;GS_GOODS_LIST-MBLNR.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CLASS_EVENT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CLASS_EVENT .<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_EVENT.<br />
<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_EVENT-&gt;HANDLER_DOUBLE_CLICK&nbsp;FOR&nbsp;GC_GRID_GOODS_LIST.<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;DISPLAY_GR_SELECT_GUIDE<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM DISPLAY_GR_SELECT_GUIDE .<br />
&nbsp;&nbsp;MESSAGE&nbsp;'#####&nbsp;#&nbsp;####&nbsp;##&nbsp;####&nbsp;###&nbsp;########.'&nbsp;TYPE&nbsp;'I'.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_HEADER_AND_ITEMS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_HEADER_AND_ITEMS  USING    P_GS_GOODS_MBLNR.<br />
&nbsp;&nbsp;"####&nbsp;####<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_HEADER_ALV.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE<br />
&nbsp;&nbsp;&nbsp;&nbsp;MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;BLART<br />
&nbsp;&nbsp;&nbsp;&nbsp;BLDAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;BUDAT<br />
&nbsp;&nbsp;FROM&nbsp;ZMKPF09<br />
&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;GS_HEADER_ALV<br />
&nbsp;&nbsp;WHERE&nbsp;MBLNR&nbsp;=&nbsp;P_GS_GOODS_MBLNR.<br />
<br />
&nbsp;&nbsp;"###&nbsp;##&nbsp;####<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_ITEM_ALV,&nbsp;GT_ITEM_ALV.<br />
&nbsp;&nbsp;SELECT<br />
&nbsp;&nbsp;&nbsp;&nbsp;ZEILE<br />
&nbsp;&nbsp;&nbsp;&nbsp;MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;MENGE<br />
&nbsp;&nbsp;&nbsp;&nbsp;MEINS<br />
&nbsp;&nbsp;&nbsp;&nbsp;WERKS<br />
&nbsp;&nbsp;&nbsp;&nbsp;LGORT<br />
&nbsp;&nbsp;&nbsp;&nbsp;BWART<br />
&nbsp;&nbsp;&nbsp;&nbsp;LIFNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;BUKRS<br />
&nbsp;&nbsp;FROM&nbsp;ZMSEG09<br />
&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_ITEM_ALV<br />
&nbsp;&nbsp;WHERE&nbsp;MBLNR&nbsp;=&nbsp;P_GS_GOODS_MBLNR.<br />
<br />
&nbsp;&nbsp;"###&nbsp;####<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM_ALV&nbsp;INTO&nbsp;GS_ITEM_ALV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;ZMATNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMARA09<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;GS_ITEM_ALV-ZMATNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZMATNR&nbsp;=&nbsp;GS_ITEM_ALV-MATNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM_ALV&nbsp;FROM&nbsp;GS_ITEM_ALV&nbsp;INDEX&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;200.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CREATE_OBJECT_ITEMS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CREATE_OBJECT_ITEMS .<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_CUSTOM_GOODS_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'CON2'.<br />
<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GC_GRID_GOODS_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GC_CUSTOM_GOODS_ITEM.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CALL_ALV_ITEMS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CALL_ALV_ITEMS .<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_GOODS_ITEM-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_TOOLBAR_EXCLUDING&nbsp;=&nbsp;GT_TOOLBAR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GS_LAYOUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_ITEM_ALV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;GT_FIELDCAT.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FIELD_CATALOG_ITEMS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FIELD_CATALOG_ITEMS .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT,&nbsp;GT_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'LV_CHECK'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT-CHECKBOX&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT-EDIT&nbsp;=&nbsp;'X'.<br />
&nbsp;"GS_FIELDCAT-STYLEFIELD&nbsp;&nbsp;=&nbsp;'STYLE'.&nbsp;"543&nbsp;####&nbsp;####&nbsp;####<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'CANCEL_TEXT'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZEILE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MATNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'ZMATNAME'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MENGE'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;7.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'MEINS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'WERKS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;9.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'LGORT'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BWART'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####'.&nbsp;"TODO&nbsp;(###&nbsp;#&nbsp;##)<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;11.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'LIFNR'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'#####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT-COL_POS&nbsp;=&nbsp;12.<br />
&nbsp;&nbsp;GS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BUKRS'.<br />
&nbsp;&nbsp;GS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT&nbsp;TO&nbsp;GT_FIELDCAT.&nbsp;"TODO&nbsp;(###&nbsp;#&nbsp;##)<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CANCEL_GOODS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CANCEL_GOODS   USING    P_MBLNR_NEW P_BELNR_NEW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_SUBRC&nbsp;P_AVAIL&nbsp;P_CURR.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_OLD_ITEM&nbsp;TYPE&nbsp;ZMSEG09,&nbsp;&nbsp;"###&nbsp;####&nbsp;####&nbsp;(##&nbsp;MSEG)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_OLD_ITEM&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_OLD_ITEM.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_MKPF_NEW&nbsp;TYPE&nbsp;ZMKPF09,&nbsp;&nbsp;"##&nbsp;####&nbsp;##(&nbsp;102/544&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MKPF_NEW&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_MKPF_NEW.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_MSEG_NEW&nbsp;TYPE&nbsp;ZMSEG09,&nbsp;&nbsp;"##&nbsp;####&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_MSEG_NEW&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_MSEG_NEW.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_BKPF_NEW&nbsp;TYPE&nbsp;ZBKPF09,&nbsp;"##&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_BKPF_NEW&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_BKPF_NEW.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_BSEG_NEW&nbsp;TYPE&nbsp;ZBSEG09,&nbsp;"##&nbsp;####&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_BSEG_NEW&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_BSEG_NEW.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_MBLNR_NEW&nbsp;TYPE&nbsp;ZMKPF09-MBLNR.&nbsp;"#&nbsp;######&nbsp;(##)<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;TOTAL_GR&nbsp;TYPE&nbsp;MENGE_D,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;####(101)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TOTAL_REV&nbsp;TYPE&nbsp;MENGE_D,&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;####(102)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AVAIL_QUAN&nbsp;TYPE&nbsp;MENGE_D.&nbsp;&nbsp;&nbsp;"##&nbsp;##&nbsp;##<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_BELNR_NEW&nbsp;TYPE&nbsp;ZBKPF09-BELNR.&nbsp;"##&nbsp;######<br />
<br />
<br />
&nbsp;&nbsp;"--------------------------------------------------------------------"<br />
&nbsp;&nbsp;"&nbsp;1.&nbsp;###&nbsp;###&nbsp;###&nbsp;(##&nbsp;MSEG&nbsp;##)<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;-&nbsp;##&nbsp;ALV##&nbsp;###&nbsp;##(GT_ITEM_ALV)&nbsp;####<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;-&nbsp;ZMSEG09&nbsp;##&nbsp;####&nbsp;LT_OLD_ITEM#&nbsp;###.<br />
&nbsp;&nbsp;"--------------------------------------------------------------------"<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LS_OLD_ITEM,&nbsp;LT_OLD_ITEM.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM_ALV&nbsp;INTO&nbsp;GS_ITEM_ALV.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ITEM_ALV-LV_CHECK&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LS_OLD_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MBLNR&nbsp;=&nbsp;GS_HEADER_ALV-MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;ZEILE&nbsp;=&nbsp;GS_ITEM_ALV-ZEILE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_OLD_ITEM&nbsp;TO&nbsp;LT_OLD_ITEM.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LT_OLD_ITEM&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_SUBRC&nbsp;=&nbsp;3.&nbsp;"####<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"--------------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;1-1.&nbsp;###&nbsp;##,&nbsp;###&nbsp;101&nbsp;###&nbsp;###&nbsp;543&nbsp;###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;-&nbsp;543###&nbsp;PARENT_ID#&nbsp;101#&nbsp;LINE_ID#&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;"--------------------------------------------------------------<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_CHILD&nbsp;TYPE&nbsp;ZMSEG09,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_CHILD&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_CHILD.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OLD_ITEM&nbsp;INTO&nbsp;LS_OLD_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"101&nbsp;###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_OLD_ITEM-BWART&nbsp;=&nbsp;'101'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;BOM&nbsp;####&nbsp;(543)&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_CHILD<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MBLNR&nbsp;=&nbsp;LS_OLD_ITEM-MBLNR&nbsp;"##&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;PARENT_ID&nbsp;=&nbsp;LS_OLD_ITEM-LINE_ID.&nbsp;"####&nbsp;##<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;543###&nbsp;LT_OLD_ITEM#&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_CHILD&nbsp;INTO&nbsp;LS_CHILD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_CHILD&nbsp;TO&nbsp;LT_OLD_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"--------------------------------------------------------------------"<br />
&nbsp;&nbsp;"&nbsp;2.&nbsp;##&nbsp;##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;##&nbsp;##&nbsp;##&nbsp;=&nbsp;(##&nbsp;101&nbsp;##&nbsp;##)&nbsp;-&nbsp;(###&nbsp;##&nbsp;###&nbsp;102&nbsp;##)&nbsp;=&gt;&nbsp;####<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;##&nbsp;####&nbsp;&gt;&nbsp;##&nbsp;##&nbsp;##&nbsp;##&nbsp;##&nbsp;(P_SUBRC&nbsp;=&nbsp;4)<br />
&nbsp;&nbsp;"--------------------------------------------------------------------"<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OLD_ITEM&nbsp;INTO&nbsp;LS_OLD_ITEM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"#####&nbsp;101##&nbsp;#####&nbsp;##(543#&nbsp;###&nbsp;####&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_OLD_ITEM-BWART&nbsp;&lt;&gt;&nbsp;'101'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;TOTAL_GR,&nbsp;TOTAL_REV,&nbsp;AVAIL_QUAN.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;###&nbsp;##&nbsp;##&nbsp;GR(101)&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SUM(&nbsp;MENGE&nbsp;)&nbsp;INTO&nbsp;TOTAL_GR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;LS_OLD_ITEM-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;EBELP&nbsp;=&nbsp;LS_OLD_ITEM-EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;MATNR&nbsp;=&nbsp;LS_OLD_ITEM-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;BWART&nbsp;=&nbsp;'101'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;###&nbsp;##&nbsp;##&nbsp;reversal&nbsp;(102)&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SUM(&nbsp;MENGE&nbsp;)&nbsp;INTO&nbsp;TOTAL_REV<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;LS_OLD_ITEM-EBELN<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;EBELP&nbsp;=&nbsp;LS_OLD_ITEM-EBELP<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;MATNR&nbsp;=&nbsp;LS_OLD_ITEM-MATNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;BWART&nbsp;=&nbsp;'102'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;AVAIL_QUAN&nbsp;=&nbsp;TOTAL_GR&nbsp;-&nbsp;TOTAL_REV.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_OLD_ITEM-MENGE&nbsp;&gt;&nbsp;AVAIL_QUAN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_SUBRC&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_AVAIL&nbsp;=&nbsp;AVAIL_QUAN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_CURR&nbsp;=&nbsp;LS_OLD_ITEM-MENGE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"--------------------------------------------------------------------"<br />
&nbsp;&nbsp;"&nbsp;4.&nbsp;##&nbsp;####&nbsp;##(MKPF)&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;###&nbsp;MBLNR&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;#####&nbsp;##&nbsp;###(BUDAT)#&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;###&nbsp;=&nbsp;##(SY-DATUM)<br />
&nbsp;&nbsp;"--------------------------------------------------------------------"<br />
<br />
&nbsp;&nbsp;"####&nbsp;##<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_MBLNR&nbsp;CHANGING&nbsp;LV_MBLNR_NEW.<br />
&nbsp;&nbsp;P_MBLNR_NEW&nbsp;=&nbsp;LV_MBLNR_NEW.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LS_MKPF_NEW.<br />
&nbsp;&nbsp;LS_MKPF_NEW-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;LS_MKPF_NEW-MBLNR&nbsp;=&nbsp;LV_MBLNR_NEW.<br />
&nbsp;&nbsp;LS_MKPF_NEW-MJAHR&nbsp;=&nbsp;GS_HEADER_ALV-BUDAT+0(4).&nbsp;"#####&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;LS_MKPF_NEW-BLART&nbsp;=&nbsp;GS_HEADER_ALV-BLART.<br />
&nbsp;&nbsp;LS_MKPF_NEW-BLDAT&nbsp;=&nbsp;GS_HEADER_ALV-BLDAT.<br />
&nbsp;&nbsp;LS_MKPF_NEW-BUDAT&nbsp;=&nbsp;SY-DATUM.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"###&nbsp;=&nbsp;##<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;LS_MKPF_NEW&nbsp;TO&nbsp;LT_MKPF_NEW.<br />
<br />
<br />
&nbsp;&nbsp;"--------------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;3-A.&nbsp;######&nbsp;##&nbsp;&&nbsp;##&nbsp;####&nbsp;##(BKPF)&nbsp;##<br />
&nbsp;&nbsp;"--------------------------------------------------------------<br />
&nbsp;&nbsp;PERFORM&nbsp;GET_BELNR&nbsp;CHANGING&nbsp;LV_BELNR_NEW.<br />
&nbsp;&nbsp;P_BELNR_NEW&nbsp;=&nbsp;LV_BELNR_NEW.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LS_BKPF_NEW.<br />
<br />
&nbsp;&nbsp;LS_BKPF_NEW-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;LS_BKPF_NEW-BELNR&nbsp;=&nbsp;LV_BELNR_NEW.&nbsp;"###&nbsp;####<br />
&nbsp;&nbsp;LS_BKPF_NEW-GJAHR&nbsp;=&nbsp;LS_MKPF_NEW-MJAHR.&nbsp;"####&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;LS_BKPF_NEW-BLART&nbsp;=&nbsp;'WE'.&nbsp;"##<br />
&nbsp;&nbsp;LS_BKPF_NEW-BLDAT&nbsp;=&nbsp;LS_MKPF_NEW-BLDAT.<br />
&nbsp;&nbsp;LS_BKPF_NEW-BUDAT&nbsp;=&nbsp;LS_MKPF_NEW-BUDAT.<br />
&nbsp;&nbsp;LS_BKPF_NEW-XBLNR&nbsp;=&nbsp;P_EBELNS.&nbsp;"######&nbsp;-&nbsp;PO##<br />
<br />
&nbsp;&nbsp;"#######&nbsp;####,&nbsp;###&nbsp;####<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;BUKRS&nbsp;WAERS<br />
&nbsp;&nbsp;FROM&nbsp;ZEKKO_09<br />
&nbsp;&nbsp;INTO&nbsp;(&nbsp;LS_BKPF_NEW-BUKRS,&nbsp;LS_BKPF_NEW-WAERS&nbsp;)<br />
&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_EBELNS.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;LS_BKPF_NEW&nbsp;TO&nbsp;LT_BKPF_NEW.<br />
<br />
<br />
<br />
&nbsp;&nbsp;"--------------------------------------------------------------<br />
&nbsp;&nbsp;"&nbsp;3-B.&nbsp;##&nbsp;####&nbsp;###&nbsp;(BSEG)&nbsp;##&nbsp;-&nbsp;###<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;###&nbsp;###(ZTBSL09)#&nbsp;###,&nbsp;"#posting&nbsp;key"#&nbsp;####<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;SHZKG#&nbsp;'S'#&nbsp;'H'#&nbsp;####.<br />
&nbsp;&nbsp;"--------------------------------------------------------------<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_BSEG_OLD&nbsp;TYPE&nbsp;ZBSEG09,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_BSEG_OLD&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_BSEG_OLD.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_BASE&nbsp;TYPE&nbsp;ZMSEG09.&nbsp;"###&nbsp;MSEG&nbsp;#&nbsp;101##&nbsp;1#<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LT_BSEG_ITEM&nbsp;LIKE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;ZBSEG09.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_HAS_SUB&nbsp;TYPE&nbsp;ABAP_BOOL.<br />
<br />
&nbsp;&nbsp;"##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;LV_HAS_SUB&nbsp;=&nbsp;ABAP_FALSE.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OLD_ITEM&nbsp;INTO&nbsp;LS_OLD_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_OLD_ITEM-BWART&nbsp;=&nbsp;'543'.&nbsp;"###&nbsp;##&nbsp;##&nbsp;=&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_HAS_SUB&nbsp;=&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LT_BSEG_NEW.<br />
<br />
&nbsp;&nbsp;"LT_OLD_ITEM#&nbsp;101&nbsp;+&nbsp;543&nbsp;###&nbsp;##.&nbsp;######&nbsp;101##&nbsp;##<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OLD_ITEM&nbsp;INTO&nbsp;LS_BASE&nbsp;WHERE&nbsp;BWART&nbsp;=&nbsp;'101'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LT_BSEG_ITEM.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_HAS_SUB&nbsp;=&nbsp;ABAP_FALSE.&nbsp;"###&nbsp;#&nbsp;-&gt;&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_BSEG_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;LS_BASE-BELNR&nbsp;"####&nbsp;MSEG-BELNR#&nbsp;######<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;GJAHR&nbsp;=&nbsp;LS_BASE-GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;ZMBLNR&nbsp;=&nbsp;LS_BASE-MBLNR&nbsp;&nbsp;&nbsp;"###&nbsp;####&nbsp;####&nbsp;######&nbsp;#####&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;ZMZEILE&nbsp;=&nbsp;LS_BASE-ZEILE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;LV_HAS_SUB&nbsp;=&nbsp;ABAP_TRUE.&nbsp;"###&nbsp;#&nbsp;-&gt;&nbsp;####&nbsp;##<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBSEG09<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_BSEG_ITEM<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;LS_BASE-BELNR&nbsp;"####&nbsp;MSEG-BELNR#&nbsp;######<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;GJAHR&nbsp;=&nbsp;LS_BASE-GJAHR.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_BSEG_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;LS_BASE-BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;GJAHR&nbsp;=&nbsp;LS_BASE-GJAHR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;ZMBLNR&nbsp;=&nbsp;LS_BASE-MBLNR&nbsp;"###&nbsp;####id#&nbsp;###&nbsp;####(ZEILE)#&nbsp;###&nbsp;##&nbsp;######&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;ZMZEILE&nbsp;=&nbsp;LS_BASE-ZEILE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;"###&nbsp;####&nbsp;###&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_BSEG_ITEM&nbsp;INTO&nbsp;LS_BSEG_OLD.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LS_BSEG_NEW.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_BSEG_OLD&nbsp;TO&nbsp;LS_BSEG_NEW.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"#&nbsp;#####&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BSEG_NEW-BELNR&nbsp;=&nbsp;LV_BELNR_NEW.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"#&nbsp;POSTING&nbsp;KEY&nbsp;##&nbsp;(ZTBSL09)<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;STBSL&nbsp;"###&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZTBSL09<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LS_BSEG_NEW-BSCHL<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BSCHL&nbsp;=&nbsp;LS_BSEG_OLD-BSCHL&nbsp;"##&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;KOART&nbsp;=&nbsp;LS_BSEG_OLD-KOART.&nbsp;"####<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"SHKZG&nbsp;#/##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_BSEG_OLD-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BSEG_NEW-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;LS_BSEG_OLD-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_BSEG_NEW-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_BSEG_NEW&nbsp;TO&nbsp;LT_BSEG_NEW.<br />
<br />
&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
&nbsp;&nbsp;"--------------------------------------------------------------------"<br />
&nbsp;&nbsp;"&nbsp;5.&nbsp;##&nbsp;####&nbsp;###(MSEG)&nbsp;##<br />
&nbsp;&nbsp;"<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;##&nbsp;##:<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;#&nbsp;MBLNR&nbsp;/&nbsp;MJAHR&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;LFBJA/LFBNR/LFPOS#&nbsp;##(##/##/###)&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;BWART/SHKZG#&nbsp;###&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;###&nbsp;###&nbsp;#####&nbsp;###&nbsp;#&nbsp;(MSEG-BELNR)<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;####&nbsp;##&nbsp;-&nbsp;"##&nbsp;####&nbsp;###&nbsp;##&nbsp;#######"<br />
&nbsp;&nbsp;"<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;##:<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;101&nbsp;S&nbsp;#&nbsp;102&nbsp;H<br />
&nbsp;&nbsp;"<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;##:<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;101&nbsp;S&nbsp;#&nbsp;102&nbsp;H&nbsp;(###)<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;543&nbsp;H&nbsp;#&nbsp;544&nbsp;S&nbsp;(###&nbsp;##&nbsp;##)<br />
&nbsp;&nbsp;"--------------------------------------------------------------------"<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LT_MSEG_NEW,&nbsp;LS_MSEG_NEW.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_OLD_ITEM&nbsp;INTO&nbsp;LS_OLD_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LS_MSEG_NEW.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;LS_OLD_ITEM&nbsp;TO&nbsp;LS_MSEG_NEW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-BELNR&nbsp;=&nbsp;LV_BELNR_NEW.&nbsp;"##&nbsp;####&nbsp;####<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"#&nbsp;########/##<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-MBLNR&nbsp;=&nbsp;LV_MBLNR_NEW.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-MJAHR&nbsp;=&nbsp;LS_MKPF_NEW-MJAHR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##&nbsp;##&nbsp;(LFBJA&nbsp;/&nbsp;LFBNR&nbsp;/&nbsp;LFPOS&nbsp;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-LFBJA&nbsp;=&nbsp;LS_OLD_ITEM-MJAHR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-LFBNR&nbsp;=&nbsp;LS_OLD_ITEM-MBLNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-LFPOS&nbsp;=&nbsp;LS_OLD_ITEM-ZEILE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"####&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;LS_OLD_ITEM-BWART.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'101'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;-&gt;&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-BWART&nbsp;=&nbsp;'102'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'543'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"###&nbsp;##&nbsp;-&gt;&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-BWART&nbsp;=&nbsp;'544'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"#/#&nbsp;##&nbsp;###&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LS_OLD_ITEM-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSEIF&nbsp;LS_OLD_ITEM-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_MSEG_NEW-SHKZG&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;####&nbsp;(101)##&nbsp;####&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;ZMSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;ZCANCEL_FLAG&nbsp;=&nbsp;'X'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MBLNR&nbsp;=&nbsp;LS_OLD_ITEM-MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;ZEILE&nbsp;=&nbsp;LS_OLD_ITEM-ZEILE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;BWART&nbsp;=&nbsp;'101'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_MSEG_NEW&nbsp;TO&nbsp;LT_MSEG_NEW.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"--------------------------------------------------------------------"<br />
&nbsp;&nbsp;"&nbsp;6.&nbsp;DB&nbsp;INSERT<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;(TODO)&nbsp;###&nbsp;###&nbsp;##&nbsp;##/####&nbsp;INSERT<br />
&nbsp;&nbsp;"&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;P_SUBRC&nbsp;=&nbsp;0.&nbsp;"##&nbsp;(CANCEL_GOODS#&nbsp;###&nbsp;###&nbsp;#)<br />
&nbsp;&nbsp;"--------------------------------------------------------------------"<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;"##&nbsp;####&nbsp;##/###<br />
   </div>
   <div class="code">
&nbsp;&nbsp;INSERT&nbsp;ZMKPF09&nbsp;FROM&nbsp;TABLE&nbsp;LT_MKPF_NEW.<br />
&nbsp;&nbsp;INSERT&nbsp;ZMSEG09&nbsp;FROM&nbsp;TABLE&nbsp;LT_MSEG_NEW.<br />
<br />
&nbsp;&nbsp;"##&nbsp;####&nbsp;##/###<br />
&nbsp;&nbsp;INSERT&nbsp;ZBKPF09&nbsp;FROM&nbsp;TABLE&nbsp;LT_BKPF_NEW.<br />
&nbsp;&nbsp;INSERT&nbsp;ZBSEG09&nbsp;FROM&nbsp;TABLE&nbsp;LT_BSEG_NEW.<br />
<br />
&nbsp;&nbsp;P_SUBRC&nbsp;=&nbsp;0.<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_HANDLER_DATA_CHANGED<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_HANDLER_DATA_CHANGED  USING    P_ER_DATA_CHANGED TYPE REF TO CL_ALV_CHANGED_DATA_PROTOCOL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_E_ONF4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_E_ONF4_BEFORE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_E_ONF4_AFTER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_E_UCOMM.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_MODI&nbsp;TYPE&nbsp;LVC_S_MODI.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;P_ER_DATA_CHANGED-&gt;MT_GOOD_CELLS&nbsp;INTO&nbsp;LS_MODI.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_ITEM_ALV&nbsp;INTO&nbsp;GS_ITEM_ALV&nbsp;INDEX&nbsp;LS_MODI-ROW_ID.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0&nbsp;AND&nbsp;LS_MODI-FIELDNAME&nbsp;=&nbsp;'LV_CHECK'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM_ALV-LV_CHECK&nbsp;=&nbsp;LS_MODI-VALUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM_ALV&nbsp;FROM&nbsp;GS_ITEM_ALV&nbsp;INDEX&nbsp;LS_MODI-ROW_ID.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CLASS_EVENT_ITEMS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CLASS_EVENT_ITEMS .<br />
&nbsp;&nbsp;"###&nbsp;###<br />
&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GC_GRID_GOODS_ITEM-&gt;REGISTER_EDIT_EVENT<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_EVENT_ID&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_EVT_MODIFIED.<br />
<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_EVENT-&gt;HANDLER_DATA_CHANGED&nbsp;FOR&nbsp;GC_GRID_GOODS_ITEM.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BUILD_MKPF<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM BUILD_MKPF  USING    P_GF_MBLNR.<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_MKPF.<br />
<br />
&nbsp;&nbsp;"####&nbsp;##&nbsp;(##)<br />
&nbsp;&nbsp;GS_MKPF-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;GS_MKPF-MBLNR&nbsp;=&nbsp;GF_MBLNR.&nbsp;"###&nbsp;######<br />
&nbsp;&nbsp;GS_MKPF-MJAHR&nbsp;=&nbsp;GF_MJAHR.&nbsp;"####<br />
&nbsp;&nbsp;GS_MKPF-BLART&nbsp;=&nbsp;GF_BLART.&nbsp;"####<br />
&nbsp;&nbsp;GS_MKPF-BLDAT&nbsp;=&nbsp;GF_BLDAT.&nbsp;"###<br />
&nbsp;&nbsp;GS_MKPF-BUDAT&nbsp;=&nbsp;GF_BUDAT.&nbsp;"###<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_MKPF&nbsp;TO&nbsp;GT_MKPF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_BELNR<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_BELNR  CHANGING P_GV_BELNR.<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'NUMBER_GET_NEXT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NR_RANGE_NR&nbsp;=&nbsp;'01'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OBJECT&nbsp;=&nbsp;'ZBELNR09_M'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NUMBER&nbsp;=&nbsp;P_GV_BELNR.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BUILD_BKPF<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM BUILD_BKPF  USING    P_GV_BELNR.<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_BKPF.<br />
<br />
&nbsp;&nbsp;"#######&nbsp;####,&nbsp;###&nbsp;####<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;BUKRS&nbsp;WAERS<br />
&nbsp;&nbsp;FROM&nbsp;ZEKKO_09<br />
&nbsp;&nbsp;INTO&nbsp;(&nbsp;GS_BKPF-BUKRS,&nbsp;GS_BKPF-WAERS&nbsp;)<br />
&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_EBELNC.<br />
<br />
<br />
&nbsp;&nbsp;GS_BKPF-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;GS_BKPF-BELNR&nbsp;=&nbsp;P_GV_BELNR.&nbsp;"###&nbsp;####<br />
&nbsp;&nbsp;GS_BKPF-GJAHR&nbsp;=&nbsp;GF_MJAHR.&nbsp;"####<br />
&nbsp;&nbsp;GS_BKPF-BLART&nbsp;=&nbsp;'WE'.&nbsp;"##<br />
&nbsp;&nbsp;GS_BKPF-BLDAT&nbsp;=&nbsp;GF_BLDAT.&nbsp;"###<br />
&nbsp;&nbsp;GS_BKPF-BUDAT&nbsp;=&nbsp;GF_BUDAT.&nbsp;"###<br />
&nbsp;&nbsp;GS_BKPF-XBLNR&nbsp;=&nbsp;P_EBELNC.&nbsp;"######&nbsp;-&nbsp;PO##<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BKPF&nbsp;TO&nbsp;GT_BKPF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BUILD_MSEG_101_STD<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM BUILD_MSEG_101_STD  USING    P_GS_ITEM STRUCTURE GS_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LV_LINE_ID.<br />
<br />
"### ## ##### - MSEG (PO### 1##, 101 ####, 'S' ####)<br />
<br />
&nbsp;&nbsp;LV_LINE_ID&nbsp;=&nbsp;LV_LINE_ID&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_MSEG.<br />
<br />
&nbsp;&nbsp;GS_MSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
<br />
&nbsp;&nbsp;"######&nbsp;/&nbsp;##&nbsp;/&nbsp;#####<br />
&nbsp;&nbsp;GS_MSEG-MBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;GS_MSEG-MJAHR&nbsp;=&nbsp;GF_MJAHR.<br />
" GS_MSEG-ZEILE = P_GS_ITEM-EBELP. "PO# ## ### ##<br />
&nbsp;&nbsp;GS_MSEG-ZEILE&nbsp;=&nbsp;LV_LINE_ID.<br />
<br />
&nbsp;&nbsp;"LINE_ID&nbsp;:&nbsp;1,&nbsp;2,&nbsp;3,....<br />
&nbsp;&nbsp;GS_MSEG-LINE_ID&nbsp;=&nbsp;LV_LINE_ID.<br />
<br />
&nbsp;&nbsp;"####&nbsp;101<br />
&nbsp;&nbsp;GS_MSEG-BWART&nbsp;=&nbsp;'101'.<br />
<br />
&nbsp;&nbsp;"####,&nbsp;###,&nbsp;####<br />
&nbsp;&nbsp;GS_MSEG-MATNR&nbsp;=&nbsp;P_GS_ITEM-MATNR.<br />
&nbsp;&nbsp;GS_MSEG-WERKS&nbsp;=&nbsp;P_GS_ITEM-WERKS.<br />
&nbsp;&nbsp;GS_MSEG-LGORT&nbsp;=&nbsp;P_GS_ITEM-LGORT.<br />
<br />
&nbsp;&nbsp;"####<br />
&nbsp;&nbsp;GS_MSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.<br />
<br />
&nbsp;&nbsp;"##&nbsp;##&nbsp;:&nbsp;###&nbsp;'S'<br />
&nbsp;&nbsp;GS_MSEG-SHKZG&nbsp;=&nbsp;'S'.<br />
<br />
&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;GS_MSEG-WAERS&nbsp;=&nbsp;P_GS_ITEM-WAERS.<br />
<br />
&nbsp;&nbsp;"####&nbsp;=&nbsp;####&nbsp;*&nbsp;PO##<br />
&nbsp;&nbsp;GS_MSEG-DMBTR&nbsp;=&nbsp;P_GS_ITEM-GR_NOW&nbsp;*&nbsp;P_GS_ITEM-STPRS.<br />
<br />
&nbsp;&nbsp;"####&nbsp;/&nbsp;##<br />
&nbsp;&nbsp;GS_MSEG-MENGE&nbsp;=&nbsp;P_GS_ITEM-GR_NOW.<br />
&nbsp;&nbsp;GS_MSEG-MEINS&nbsp;=&nbsp;P_GS_ITEM-MEINS.<br />
<br />
&nbsp;&nbsp;"PO##&nbsp;##&nbsp;-&gt;&nbsp;####&nbsp;##&nbsp;/&nbsp;##<br />
&nbsp;&nbsp;GS_MSEG-EBELN&nbsp;=&nbsp;P_GS_ITEM-EBELN.<br />
&nbsp;&nbsp;GS_MSEG-EBELP&nbsp;=&nbsp;P_GS_ITEM-EBELP.<br />
<br />
&nbsp;&nbsp;"##&nbsp;##&nbsp;(101)&nbsp;-&gt;&nbsp;######&nbsp;####&nbsp;(102&nbsp;##&nbsp;##&nbsp;###)<br />
&nbsp;&nbsp;GS_MSEG-LFBJA&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;GS_MSEG-LFBNR&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;GS_MSEG-LFPOS&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;"#######&nbsp;&nbsp;-&gt;&nbsp;####&nbsp;###&nbsp;#&nbsp;####<br />
&nbsp;&nbsp;IF&nbsp;P_GS_ITEM-GR_REM&nbsp;-&nbsp;P_GS_ITEM-GR_NOW&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-ELIKZ&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-ELIKZ&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"FI&nbsp;####<br />
&nbsp;&nbsp;GS_MSEG-GJAHR&nbsp;=&nbsp;GF_MJAHR.<br />
<br />
&nbsp;&nbsp;"####&nbsp;(PO&nbsp;##)<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;BUKRS<br />
&nbsp;&nbsp;FROM&nbsp;ZEKKO_09<br />
&nbsp;&nbsp;INTO&nbsp;GS_MSEG-BUKRS<br />
&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_GS_ITEM-EBELN.<br />
<br />
&nbsp;&nbsp;"#####&nbsp;(#####&nbsp;##&nbsp;####&nbsp;=&nbsp;'B'<br />
&nbsp;&nbsp;GS_MSEG-KZBEW&nbsp;=&nbsp;'B'.<br />
<br />
&nbsp;&nbsp;"####&nbsp;(#####&nbsp;####)<br />
&nbsp;&nbsp;GS_MSEG-BELNR&nbsp;=&nbsp;GV_BELNR.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_MSEG&nbsp;TO&nbsp;GT_MSEG.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BUILD_BSEG_STD<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM BUILD_BSEG_STD  USING    P_GS_ITEM STRUCTURE GS_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_LINE_ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LV_BUZEI.<br />
"### ## ##### - BSEG (PO## 1## 2## (#/##), #### ####, ####### ###)<br />
"#) #### BSX<br />
"#) GR/IR #### WRX<br />
<br />
&nbsp;&nbsp;"#####&nbsp;####<br />
&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;"========================================================<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;&nbsp;BSX&nbsp;&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;"========================================================<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_BSEG.<br />
<br />
&nbsp;&nbsp;GS_BSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_BKPF-BUKRS.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;GS_BKPF-BELNR.&nbsp;"######<br />
&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;GS_BKPF-GJAHR.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
<br />
&nbsp;&nbsp;GS_BSEG-BUZID&nbsp;=&nbsp;'M'.&nbsp;"&nbsp;M&nbsp;-&nbsp;####&nbsp;##<br />
<br />
&nbsp;&nbsp;GS_BSEG-BSCHL&nbsp;=&nbsp;'89'.&nbsp;"###&nbsp;89&nbsp;=&nbsp;Debit,&nbsp;Material<br />
&nbsp;&nbsp;GS_BSEG-KOART&nbsp;=&nbsp;'M'.&nbsp;&nbsp;"Material<br />
&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'S'.&nbsp;&nbsp;"Debit<br />
<br />
&nbsp;&nbsp;"##&nbsp;/&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;P_GS_ITEM-GR_NOW&nbsp;*&nbsp;P_GS_ITEM-STPRS.<br />
&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;GS_BSEG-DMBTR.<br />
&nbsp;&nbsp;GS_BSEG-PSWSL&nbsp;=&nbsp;GS_BKPF-WAERS.<br />
<br />
&nbsp;&nbsp;"#####<br />
&nbsp;&nbsp;GS_BSEG-KTOSL&nbsp;=&nbsp;'BSX'.&nbsp;"####&nbsp;#<br />
&nbsp;&nbsp;GS_BSEG-VORGN&nbsp;=&nbsp;'RMWE'.&nbsp;"#####&nbsp;####&nbsp;(RMWE&nbsp;=&nbsp;####)<br />
<br />
&nbsp;&nbsp;"####&nbsp;G/L&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-HKONT&nbsp;=&nbsp;'11051010'.&nbsp;"######<br />
<br />
&nbsp;&nbsp;"####&nbsp;(PO##)<br />
&nbsp;&nbsp;GS_BSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.<br />
<br />
&nbsp;&nbsp;"#####&nbsp;###&nbsp;####ID#&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-ZMBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;GS_BSEG-ZMZEILE&nbsp;=&nbsp;LV_LINE_ID.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
<br />
&nbsp;&nbsp;"========================================================<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;-&nbsp;WRX&nbsp;-&nbsp;GR/IR&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;"========================================================<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_BSEG.<br />
<br />
&nbsp;&nbsp;LV_BUZEI&nbsp;=&nbsp;LV_BUZEI&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;GS_BSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_BKPF-BUKRS.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;GS_BKPF-BELNR.&nbsp;"######<br />
&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;GS_BKPF-GJAHR.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;LV_BUZEI.<br />
<br />
&nbsp;&nbsp;GS_BSEG-BUZID&nbsp;=&nbsp;'W'.&nbsp;"&nbsp;W&nbsp;-&nbsp;GR/IR&nbsp;##<br />
<br />
&nbsp;&nbsp;GS_BSEG-BSCHL&nbsp;=&nbsp;'96'.&nbsp;"###&nbsp;96&nbsp;=&nbsp;Credit,&nbsp;G/L&nbsp;Account<br />
&nbsp;&nbsp;GS_BSEG-KOART&nbsp;=&nbsp;'S'.&nbsp;&nbsp;"G/L&nbsp;Account<br />
&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'H'.&nbsp;&nbsp;"Credit<br />
<br />
&nbsp;&nbsp;"##&nbsp;/&nbsp;##&nbsp;-&gt;&nbsp;Debit#&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;P_GS_ITEM-GR_NOW&nbsp;*&nbsp;P_GS_ITEM-STPRS.<br />
&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;GS_BSEG-DMBTR.<br />
&nbsp;&nbsp;GS_BSEG-PSWSL&nbsp;=&nbsp;GS_BKPF-WAERS.<br />
<br />
&nbsp;&nbsp;"#####<br />
&nbsp;&nbsp;GS_BSEG-KTOSL&nbsp;=&nbsp;'WRX'.&nbsp;"####&nbsp;#<br />
&nbsp;&nbsp;GS_BSEG-VORGN&nbsp;=&nbsp;'RMWE'.&nbsp;"#####&nbsp;####&nbsp;(RMWE&nbsp;=&nbsp;####)<br />
<br />
&nbsp;&nbsp;"####&nbsp;G/L&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-HKONT&nbsp;=&nbsp;'93000030'.&nbsp;"######&nbsp;(GR/IR&nbsp;##)<br />
<br />
&nbsp;&nbsp;"####&nbsp;(PO##)<br />
&nbsp;&nbsp;GS_BSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.<br />
<br />
&nbsp;&nbsp;"#####&nbsp;###&nbsp;####ID#&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-ZMBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;GS_BSEG-ZMZEILE&nbsp;=&nbsp;LV_LINE_ID.<br />
<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CHECK_INPUT<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CHECK_INPUT  CHANGING LV_SUBRC.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_CHECKED&nbsp;TYPE&nbsp;ABAP_BOOL&nbsp;VALUE&nbsp;ABAP_FALSE.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM&nbsp;INTO&nbsp;GS_ITEM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ITEM-L_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_CHECKED&nbsp;=&nbsp;ABAP_TRUE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(&nbsp;GS_ITEM-L_CHECK&nbsp;=&nbsp;'X'&nbsp;)&nbsp;AND&nbsp;(&nbsp;GS_ITEM-GR_NOW&nbsp;&lt;=&nbsp;0&nbsp;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;#####&nbsp;######.'&nbsp;TYPE&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_SUBRC&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;LV_CHECKED&nbsp;=&nbsp;ABAP_FALSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'##&nbsp;##&nbsp;###&nbsp;###&nbsp;######.'&nbsp;TYPE&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_SUBRC&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SAVE_TO_DB<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SAVE_TO_DB .<br />
&nbsp;&nbsp;"1)&nbsp;####&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;INSERT&nbsp;ZMKPF09&nbsp;FROM&nbsp;TABLE&nbsp;GT_MKPF.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;##&nbsp;##&nbsp;##'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"2)&nbsp;####&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;INSERT&nbsp;ZMSEG09&nbsp;FROM&nbsp;TABLE&nbsp;GT_MSEG.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;###&nbsp;##&nbsp;##'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"3)&nbsp;####&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;INSERT&nbsp;ZBKPF09&nbsp;FROM&nbsp;TABLE&nbsp;GT_BKPF.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;##&nbsp;##&nbsp;##'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"4)&nbsp;####&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;INSERT&nbsp;ZBSEG09&nbsp;FROM&nbsp;TABLE&nbsp;GT_BSEG.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'####&nbsp;###&nbsp;##&nbsp;##'&nbsp;TYPE&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ROLLBACK&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"5)&nbsp;##&nbsp;##&nbsp;##&nbsp;#&nbsp;COMMIT<br />
&nbsp;&nbsp;COMMIT&nbsp;WORK.<br />
<br />
&nbsp;&nbsp;MESSAGE&nbsp;|####&nbsp;{&nbsp;GF_MBLNR&nbsp;}&nbsp;/&nbsp;####&nbsp;{&nbsp;GV_BELNR&nbsp;}&nbsp;#######|&nbsp;TYPE&nbsp;'S'.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BUILD_MSEG_101_OUTS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM BUILD_MSEG_101_OUTS  USING    P_GS_ITEM STRUCTURE GS_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;LV_LINE_ID.<br />
"### - MSEG (PO### 1##, 101 ####, 'S' ####)<br />
<br />
&nbsp;&nbsp;LV_LINE_ID&nbsp;=&nbsp;LV_LINE_ID&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_MSEG.<br />
<br />
&nbsp;&nbsp;GS_MSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
<br />
&nbsp;&nbsp;"######&nbsp;/&nbsp;##&nbsp;/&nbsp;#####<br />
&nbsp;&nbsp;GS_MSEG-MBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;GS_MSEG-MJAHR&nbsp;=&nbsp;GF_MJAHR.<br />
&nbsp;&nbsp;GS_MSEG-ZEILE&nbsp;=&nbsp;LV_LINE_ID.<br />
<br />
&nbsp;&nbsp;"LINE_ID&nbsp;:&nbsp;1,&nbsp;2,&nbsp;3,...<br />
&nbsp;&nbsp;GS_MSEG-LINE_ID&nbsp;=&nbsp;LV_LINE_ID.<br />
<br />
&nbsp;&nbsp;"###&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;GS_MSEG-PARENT_ID&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;"####&nbsp;101&nbsp;(###&nbsp;##)<br />
&nbsp;&nbsp;GS_MSEG-BWART&nbsp;=&nbsp;'101'.<br />
<br />
&nbsp;&nbsp;"####,&nbsp;###,&nbsp;####<br />
&nbsp;&nbsp;GS_MSEG-MATNR&nbsp;=&nbsp;P_GS_ITEM-MATNR.<br />
&nbsp;&nbsp;GS_MSEG-WERKS&nbsp;=&nbsp;P_GS_ITEM-WERKS.<br />
&nbsp;&nbsp;GS_MSEG-LGORT&nbsp;=&nbsp;P_GS_ITEM-LGORT.<br />
<br />
&nbsp;&nbsp;"#######&nbsp;(####&nbsp;####&nbsp;##)<br />
&nbsp;&nbsp;GS_MSEG-SOBKZ&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;"####<br />
&nbsp;&nbsp;GS_MSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.<br />
<br />
&nbsp;&nbsp;"##&nbsp;##&nbsp;:&nbsp;###&nbsp;'S'<br />
&nbsp;&nbsp;GS_MSEG-SHKZG&nbsp;=&nbsp;'S'.<br />
<br />
&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;GS_MSEG-WAERS&nbsp;=&nbsp;P_GS_ITEM-WAERS.<br />
<br />
&nbsp;&nbsp;"####&nbsp;=&nbsp;####&nbsp;*&nbsp;PO##<br />
&nbsp;&nbsp;GS_MSEG-DMBTR&nbsp;=&nbsp;P_GS_ITEM-GR_NOW&nbsp;*&nbsp;P_GS_ITEM-STPRS.<br />
<br />
&nbsp;&nbsp;"####&nbsp;/&nbsp;##<br />
&nbsp;&nbsp;GS_MSEG-MENGE&nbsp;=&nbsp;P_GS_ITEM-GR_NOW.<br />
&nbsp;&nbsp;GS_MSEG-MEINS&nbsp;=&nbsp;P_GS_ITEM-MEINS.<br />
<br />
&nbsp;&nbsp;"PO##&nbsp;##&nbsp;-&gt;&nbsp;####&nbsp;##&nbsp;/&nbsp;##<br />
&nbsp;&nbsp;GS_MSEG-EBELN&nbsp;=&nbsp;P_GS_ITEM-EBELN.<br />
&nbsp;&nbsp;GS_MSEG-EBELP&nbsp;=&nbsp;P_GS_ITEM-EBELP.<br />
<br />
&nbsp;&nbsp;"##&nbsp;##&nbsp;(101)&nbsp;-&gt;&nbsp;######&nbsp;####&nbsp;(102&nbsp;##&nbsp;##&nbsp;###)<br />
&nbsp;&nbsp;GS_MSEG-LFBJA&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;GS_MSEG-LFBNR&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;GS_MSEG-LFPOS&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;"#######&nbsp;&nbsp;-&gt;&nbsp;####&nbsp;###&nbsp;#&nbsp;####<br />
&nbsp;&nbsp;IF&nbsp;P_GS_ITEM-GR_REM&nbsp;-&nbsp;P_GS_ITEM-GR_NOW&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-ELIKZ&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-ELIKZ&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"FI&nbsp;####<br />
&nbsp;&nbsp;GS_MSEG-GJAHR&nbsp;=&nbsp;GF_MJAHR.<br />
<br />
&nbsp;&nbsp;"####&nbsp;(PO&nbsp;##)<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;BUKRS<br />
&nbsp;&nbsp;FROM&nbsp;ZEKKO_09<br />
&nbsp;&nbsp;INTO&nbsp;GS_MSEG-BUKRS<br />
&nbsp;&nbsp;WHERE&nbsp;EBELN&nbsp;=&nbsp;P_GS_ITEM-EBELN.<br />
<br />
&nbsp;&nbsp;"#####&nbsp;(#####&nbsp;##&nbsp;####&nbsp;=&nbsp;'B')<br />
&nbsp;&nbsp;GS_MSEG-KZBEW&nbsp;=&nbsp;'B'.<br />
<br />
&nbsp;&nbsp;"####&nbsp;(#####&nbsp;####)<br />
&nbsp;&nbsp;GS_MSEG-BELNR&nbsp;=&nbsp;GV_BELNR.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_MSEG&nbsp;TO&nbsp;GT_MSEG.<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BUILD_MSEG_543_CONS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM BUILD_MSEG_543_CONS  USING    P_GS_ITEM STRUCTURE GS_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_LV_LINE_ID.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_STLNR&nbsp;LIKE&nbsp;ZMAST09-STLNR.&nbsp;"BOM&nbsp;ID<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_BOM&nbsp;TYPE&nbsp;ZSTPO09,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_BOM&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_BOM,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_STPRS&nbsp;LIKE&nbsp;ZMARA09-STPRS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_PARENT_ID&nbsp;TYPE&nbsp;N&nbsp;LENGTH&nbsp;3,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_CONS_QTY&nbsp;TYPE&nbsp;MENGE_D,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_DMBTR&nbsp;LIKE&nbsp;ZMSEG09-DMBTR.<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;###&nbsp;101&nbsp;###&nbsp;LINE_ID#&nbsp;PARENT_ID#&nbsp;##<br />
&nbsp;&nbsp;LV_PARENT_ID&nbsp;=&nbsp;P_LV_LINE_ID.<br />
<br />
&nbsp;&nbsp;"1.&nbsp;###&nbsp;MATNR&nbsp;-&gt;&nbsp;BOM&nbsp;ID&nbsp;(ZMAST09)##&nbsp;##<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;STLNR<br />
&nbsp;&nbsp;FROM&nbsp;ZMAST09<br />
&nbsp;&nbsp;INTO&nbsp;LV_STLNR<br />
&nbsp;&nbsp;WHERE&nbsp;MATNR&nbsp;=&nbsp;P_GS_ITEM-MATNR.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
&nbsp;&nbsp;"2.&nbsp;##&nbsp;BOM&nbsp;ID#&nbsp;###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;FROM&nbsp;ZSTPO09<br />
&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;LT_BOM<br />
&nbsp;&nbsp;WHERE&nbsp;STLNR&nbsp;=&nbsp;LV_STLNR.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LS_BOM.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;LT_BOM&nbsp;INTO&nbsp;LS_BOM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"3.&nbsp;###&nbsp;##&nbsp;##&nbsp;(ZMARA09)<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;STPRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMARA09<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_STPRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ZMATNR&nbsp;=&nbsp;LS_BOM-IDNRK.&nbsp;"####&nbsp;#/###&nbsp;##&nbsp;##<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_STPRS&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"4.&nbsp;###&nbsp;##&nbsp;543&nbsp;MSEG&nbsp;###&nbsp;-&nbsp;####&nbsp;#/###(IDNRK)&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_MSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;P_LV_LINE_ID&nbsp;=&nbsp;P_LV_LINE_ID&nbsp;+&nbsp;1.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-MBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-MJAHR&nbsp;=&nbsp;GF_MJAHR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-ZEILE&nbsp;=&nbsp;P_LV_LINE_ID.&nbsp;"543#&nbsp;PO####&nbsp;##<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"LINE_ID&nbsp;:&nbsp;1,2,3,4..&nbsp;(101##&nbsp;###)<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-LINE_ID&nbsp;=&nbsp;P_LV_LINE_ID.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"PARENT_ID&nbsp;:&nbsp;###&nbsp;101&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-PARENT_ID&nbsp;=&nbsp;LV_PARENT_ID.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-BWART&nbsp;=&nbsp;'543'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-MATNR&nbsp;=&nbsp;LS_BOM-IDNRK.&nbsp;"###&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-WERKS&nbsp;=&nbsp;P_GS_ITEM-WERKS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-LGORT&nbsp;=&nbsp;P_GS_ITEM-LGORT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.&nbsp;"####<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-SOBKZ&nbsp;=&nbsp;'O'.&nbsp;"#######<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-SHKZG&nbsp;=&nbsp;'H'.&nbsp;"##&nbsp;##<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-WAERS&nbsp;=&nbsp;P_GS_ITEM-WAERS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;####&nbsp;-&nbsp;BOM.MENGE&nbsp;*&nbsp;##&nbsp;####(GR_NOW)<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;DMBTR&nbsp;=&nbsp;####&nbsp;*&nbsp;#####(from&nbsp;MARA)<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_CONS_QTY&nbsp;=&nbsp;LS_BOM-MENGE&nbsp;*&nbsp;P_GS_ITEM-GR_NOW.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-MENGE&nbsp;=&nbsp;LV_CONS_QTY.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-MEINS&nbsp;=&nbsp;LS_BOM-MEINS.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_DMBTR&nbsp;=&nbsp;LV_CONS_QTY&nbsp;*&nbsp;LV_STPRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-DMBTR&nbsp;=&nbsp;LV_DMBTR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"PO##&nbsp;##&nbsp;-&gt;&nbsp;####&nbsp;##&nbsp;/&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-EBELN&nbsp;=&nbsp;P_GS_ITEM-EBELN.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-EBELP&nbsp;=&nbsp;P_GS_ITEM-EBELP.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"######&nbsp;####&nbsp;(102&nbsp;##&nbsp;##&nbsp;###)<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-LFBJA&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-LFBNR&nbsp;=&nbsp;''.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-LFPOS&nbsp;=&nbsp;''.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"FI##<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-GJAHR&nbsp;=&nbsp;GF_MJAHR.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-BUKRS&nbsp;=&nbsp;GS_BKPF-BUKRS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_MSEG-BELNR&nbsp;=&nbsp;GV_BELNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_MSEG&nbsp;TO&nbsp;GT_MSEG.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BUILD_BSEG_OUTS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM BUILD_BSEG_OUTS  USING    P_GS_ITEM STRUCTURE GS_ITEM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_ZMZEILE<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_LV_LINE_ID_B.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_CONS_COST&nbsp;TYPE&nbsp;DMBTR,&nbsp;"###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_PROC_COST&nbsp;TYPE&nbsp;DMBTR,&nbsp;"####&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LV_MAT_COST&nbsp;TYPE&nbsp;DMBTR.&nbsp;&nbsp;"###&nbsp;##&nbsp;=&nbsp;####&nbsp;+&nbsp;###<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LV_CONS_COST.<br />
<br />
&nbsp;&nbsp;"&nbsp;543&nbsp;####&nbsp;SUM&nbsp;(GT_MSEG)##&nbsp;##<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_MSEG.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_MSEG&nbsp;INTO&nbsp;GS_MSEG&nbsp;WHERE&nbsp;BWART&nbsp;=&nbsp;'543'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_CONS_COST&nbsp;=&nbsp;LV_CONS_COST&nbsp;+&nbsp;GS_MSEG-DMBTR.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;"&nbsp;####&nbsp;=&nbsp;##&nbsp;####&nbsp;*&nbsp;PO&nbsp;##&nbsp;(####&nbsp;##)<br />
&nbsp;&nbsp;LV_PROC_COST&nbsp;=&nbsp;P_GS_ITEM-GR_NOW&nbsp;*&nbsp;P_GS_ITEM-STPRS.<br />
<br />
&nbsp;&nbsp;"&nbsp;###&nbsp;##&nbsp;=&nbsp;####&nbsp;+&nbsp;###<br />
&nbsp;&nbsp;LV_MAT_COST&nbsp;=&nbsp;LV_CONS_COST&nbsp;+&nbsp;LV_PROC_COST.<br />
<br />
<br />
&nbsp;&nbsp;"####&nbsp;6#<br />
<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;"&nbsp;(1)&nbsp;#)&nbsp;BSX&nbsp;#####&nbsp;##<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;P_LV_LINE_ID_B&nbsp;&nbsp;=&nbsp;P_LV_LINE_ID_B&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_BSEG.<br />
<br />
&nbsp;&nbsp;GS_BSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_BKPF-BUKRS.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;GS_BKPF-BELNR.&nbsp;"######<br />
&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;GS_BKPF-GJAHR.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;P_LV_LINE_ID_B.<br />
<br />
&nbsp;&nbsp;GS_BSEG-BUZID&nbsp;=&nbsp;'M'.&nbsp;"&nbsp;M&nbsp;-&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-BSCHL&nbsp;=&nbsp;'89'.&nbsp;"###&nbsp;89&nbsp;=&nbsp;Debit,&nbsp;Material<br />
&nbsp;&nbsp;GS_BSEG-KOART&nbsp;=&nbsp;'M'.&nbsp;&nbsp;"Material<br />
&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'S'.&nbsp;&nbsp;"Debit<br />
&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;LV_MAT_COST.&nbsp;"###&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;LV_MAT_COST.&nbsp;"###&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-PSWSL&nbsp;=&nbsp;GS_BKPF-WAERS.<br />
<br />
&nbsp;&nbsp;GS_BSEG-KTOSL&nbsp;=&nbsp;'BSX'.&nbsp;"####&nbsp;#<br />
&nbsp;&nbsp;GS_BSEG-VORGN&nbsp;=&nbsp;'RMWE'.&nbsp;"#####&nbsp;####&nbsp;(RMWE&nbsp;=&nbsp;####)<br />
<br />
&nbsp;&nbsp;GS_BSEG-HKONT&nbsp;=&nbsp;'11051010'.&nbsp;"####&nbsp;(BSX)<br />
<br />
&nbsp;&nbsp;"####&nbsp;(PO##)<br />
&nbsp;&nbsp;GS_BSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.<br />
<br />
&nbsp;&nbsp;"ZMBLNR&nbsp;:&nbsp;####&nbsp;##,&nbsp;ZMZEILE&nbsp;:&nbsp;####&nbsp;ZEILE<br />
&nbsp;&nbsp;GS_BSEG-ZMBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;GS_BSEG-ZMZEILE&nbsp;=&nbsp;LV_ZMZEILE.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
<br />
<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;"&nbsp;(2)&nbsp;#)&nbsp;BSV&nbsp;######<br />
&nbsp;&nbsp;"===============================================================<br />
<br />
&nbsp;&nbsp;P_LV_LINE_ID_B&nbsp;&nbsp;=&nbsp;P_LV_LINE_ID_B&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_BSEG.<br />
<br />
&nbsp;&nbsp;GS_BSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_BKPF-BUKRS.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;GS_BKPF-BELNR.&nbsp;"######<br />
&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;GS_BKPF-GJAHR.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;P_LV_LINE_ID_B.<br />
<br />
&nbsp;&nbsp;GS_BSEG-BUZID&nbsp;=&nbsp;'S'.&nbsp;"&nbsp;S&nbsp;-&nbsp;##/##/##&nbsp;####<br />
&nbsp;&nbsp;GS_BSEG-BSCHL&nbsp;=&nbsp;'91'.&nbsp;"###&nbsp;91&nbsp;(Cost)&nbsp;-&nbsp;Credit,&nbsp;G/L&nbsp;Account<br />
&nbsp;&nbsp;GS_BSEG-KOART&nbsp;=&nbsp;'S'.&nbsp;&nbsp;"G/L&nbsp;Account<br />
&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'H'.&nbsp;&nbsp;"Credit<br />
&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;LV_MAT_COST.&nbsp;"###&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;LV_MAT_COST.&nbsp;"###&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-PSWSL&nbsp;=&nbsp;GS_BKPF-WAERS.<br />
<br />
&nbsp;&nbsp;GS_BSEG-KTOSL&nbsp;=&nbsp;'BSV'.&nbsp;"####&nbsp;#<br />
&nbsp;&nbsp;GS_BSEG-VORGN&nbsp;=&nbsp;'RMWE'.&nbsp;"#####&nbsp;####&nbsp;(RMWE&nbsp;=&nbsp;####)<br />
<br />
&nbsp;&nbsp;GS_BSEG-HKONT&nbsp;=&nbsp;'95000100'.&nbsp;"GR/IR&nbsp;##&nbsp;(WRX)<br />
<br />
&nbsp;&nbsp;"####&nbsp;(PO##)<br />
&nbsp;&nbsp;GS_BSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.<br />
<br />
&nbsp;&nbsp;"ZMBLNR&nbsp;:&nbsp;####&nbsp;##,&nbsp;ZMZEILE&nbsp;:&nbsp;####&nbsp;ZEILE<br />
&nbsp;&nbsp;GS_BSEG-ZMBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;GS_BSEG-ZMZEILE&nbsp;=&nbsp;LV_ZMZEILE.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
<br />
<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;"&nbsp;(3)&nbsp;#)&nbsp;GBB&nbsp;###&nbsp;##<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;P_LV_LINE_ID_B&nbsp;&nbsp;=&nbsp;P_LV_LINE_ID_B&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_BSEG.<br />
<br />
&nbsp;&nbsp;GS_BSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_BKPF-BUKRS.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;GS_BKPF-BELNR.&nbsp;"######<br />
&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;GS_BKPF-GJAHR.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;P_LV_LINE_ID_B.<br />
<br />
&nbsp;&nbsp;GS_BSEG-BUZID&nbsp;=&nbsp;'S'.&nbsp;"&nbsp;S&nbsp;-&nbsp;##/##/##&nbsp;####<br />
&nbsp;&nbsp;GS_BSEG-BSCHL&nbsp;=&nbsp;'81'.&nbsp;"###&nbsp;81&nbsp;(Cost)&nbsp;-&nbsp;Debit,&nbsp;G/L&nbsp;Account<br />
&nbsp;&nbsp;GS_BSEG-KOART&nbsp;=&nbsp;'S'.&nbsp;&nbsp;"G/L&nbsp;Account<br />
&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'S'.&nbsp;&nbsp;"Debit<br />
&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;LV_CONS_COST.&nbsp;"###&nbsp;####<br />
&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;LV_CONS_COST.&nbsp;"###&nbsp;####<br />
&nbsp;&nbsp;GS_BSEG-PSWSL&nbsp;=&nbsp;GS_BKPF-WAERS.<br />
<br />
&nbsp;&nbsp;GS_BSEG-KTOSL&nbsp;=&nbsp;'GBB'.&nbsp;"####&nbsp;#<br />
&nbsp;&nbsp;GS_BSEG-VORGN&nbsp;=&nbsp;'RMWE'.&nbsp;"#####&nbsp;####&nbsp;(RMWE&nbsp;=&nbsp;####)<br />
<br />
&nbsp;&nbsp;GS_BSEG-HKONT&nbsp;=&nbsp;'95000040'.&nbsp;"###&nbsp;##&nbsp;##&nbsp;(GBB)<br />
<br />
&nbsp;&nbsp;"####&nbsp;(PO##)<br />
&nbsp;&nbsp;GS_BSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.<br />
<br />
&nbsp;&nbsp;"ZMBLNR&nbsp;:&nbsp;####&nbsp;##,&nbsp;ZMZEILE&nbsp;:&nbsp;####&nbsp;ZEILE<br />
&nbsp;&nbsp;GS_BSEG-ZMBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;GS_BSEG-ZMZEILE&nbsp;=&nbsp;LV_ZMZEILE.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;"&nbsp;(4)&nbsp;#)&nbsp;BSX&nbsp;###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;P_LV_LINE_ID_B&nbsp;&nbsp;=&nbsp;P_LV_LINE_ID_B&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_BSEG.<br />
<br />
&nbsp;&nbsp;GS_BSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_BKPF-BUKRS.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;GS_BKPF-BELNR.&nbsp;"######<br />
&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;GS_BKPF-GJAHR.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;P_LV_LINE_ID_B.<br />
<br />
&nbsp;&nbsp;GS_BSEG-BUZID&nbsp;=&nbsp;'M'.&nbsp;"&nbsp;M&nbsp;-&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-BSCHL&nbsp;=&nbsp;'99'.&nbsp;"###&nbsp;99&nbsp;(Stock&nbsp;Outwd&nbsp;Movement)&nbsp;-&nbsp;Credit,&nbsp;Material<br />
&nbsp;&nbsp;GS_BSEG-KOART&nbsp;=&nbsp;'M'.&nbsp;&nbsp;"Material<br />
&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'H'.&nbsp;&nbsp;"Credit<br />
&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;LV_CONS_COST.&nbsp;"###&nbsp;####<br />
&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;LV_CONS_COST.&nbsp;"###&nbsp;####<br />
&nbsp;&nbsp;GS_BSEG-PSWSL&nbsp;=&nbsp;GS_BKPF-WAERS.<br />
<br />
&nbsp;&nbsp;GS_BSEG-KTOSL&nbsp;=&nbsp;'BSX'.&nbsp;"####&nbsp;#<br />
&nbsp;&nbsp;GS_BSEG-VORGN&nbsp;=&nbsp;'RMWE'.&nbsp;"#####&nbsp;####&nbsp;(RMWE&nbsp;=&nbsp;####)<br />
<br />
&nbsp;&nbsp;GS_BSEG-HKONT&nbsp;=&nbsp;'11051040'.&nbsp;"##&nbsp;##&nbsp;(BSX)<br />
<br />
&nbsp;&nbsp;"####&nbsp;(PO##)<br />
&nbsp;&nbsp;GS_BSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.<br />
<br />
&nbsp;&nbsp;"ZMBLNR&nbsp;:&nbsp;####&nbsp;##,&nbsp;ZMZEILE&nbsp;:&nbsp;####&nbsp;ZEILE<br />
&nbsp;&nbsp;GS_BSEG-ZMBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;GS_BSEG-ZMZEILE&nbsp;=&nbsp;LV_ZMZEILE.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;"&nbsp;(5)&nbsp;#)&nbsp;FRL&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;P_LV_LINE_ID_B&nbsp;&nbsp;=&nbsp;P_LV_LINE_ID_B&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_BSEG.<br />
<br />
&nbsp;&nbsp;GS_BSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_BKPF-BUKRS.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;GS_BKPF-BELNR.&nbsp;"######<br />
&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;GS_BKPF-GJAHR.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;P_LV_LINE_ID_B.<br />
<br />
&nbsp;&nbsp;GS_BSEG-BUZID&nbsp;=&nbsp;'S'.&nbsp;"&nbsp;S&nbsp;-&nbsp;##/##/##&nbsp;####<br />
&nbsp;&nbsp;GS_BSEG-BSCHL&nbsp;=&nbsp;'86'.&nbsp;"###&nbsp;86&nbsp;(	GR\IR&nbsp;Debit&nbsp;)&nbsp;-&nbsp;Debit,&nbsp;G/L&nbsp;Account<br />
&nbsp;&nbsp;GS_BSEG-KOART&nbsp;=&nbsp;'S'.&nbsp;&nbsp;"G/L&nbsp;Account<br />
&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'S'.&nbsp;&nbsp;"Debit<br />
&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;LV_PROC_COST.&nbsp;"####&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;LV_PROC_COST.&nbsp;"####&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-PSWSL&nbsp;=&nbsp;GS_BKPF-WAERS.<br />
<br />
&nbsp;&nbsp;GS_BSEG-KTOSL&nbsp;=&nbsp;'FRL'.&nbsp;"####&nbsp;#<br />
&nbsp;&nbsp;GS_BSEG-VORGN&nbsp;=&nbsp;'RMWE'.&nbsp;"#####&nbsp;####&nbsp;(RMWE&nbsp;=&nbsp;####)<br />
<br />
&nbsp;&nbsp;GS_BSEG-HKONT&nbsp;=&nbsp;'95000050'.&nbsp;"###&nbsp;####&nbsp;(FRL)<br />
<br />
&nbsp;&nbsp;"####&nbsp;(PO##)<br />
&nbsp;&nbsp;GS_BSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.<br />
<br />
&nbsp;&nbsp;"ZMBLNR&nbsp;:&nbsp;####&nbsp;##,&nbsp;ZMZEILE&nbsp;:&nbsp;####&nbsp;ZEILE<br />
&nbsp;&nbsp;GS_BSEG-ZMBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;GS_BSEG-ZMZEILE&nbsp;=&nbsp;LV_ZMZEILE.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;"&nbsp;(6)&nbsp;#)&nbsp;WRX&nbsp;GR/IR&nbsp;####<br />
&nbsp;&nbsp;"===============================================================<br />
&nbsp;&nbsp;P_LV_LINE_ID_B&nbsp;&nbsp;=&nbsp;P_LV_LINE_ID_B&nbsp;+&nbsp;1.<br />
&nbsp;&nbsp;CLEAR&nbsp;GS_BSEG.<br />
<br />
&nbsp;&nbsp;GS_BSEG-MANDT&nbsp;=&nbsp;SY-MANDT.<br />
&nbsp;&nbsp;GS_BSEG-BUKRS&nbsp;=&nbsp;GS_BKPF-BUKRS.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BELNR&nbsp;=&nbsp;GS_BKPF-BELNR.&nbsp;"######<br />
&nbsp;&nbsp;GS_BSEG-GJAHR&nbsp;=&nbsp;GS_BKPF-GJAHR.&nbsp;"####<br />
&nbsp;&nbsp;GS_BSEG-BUZEI&nbsp;=&nbsp;P_LV_LINE_ID_B.<br />
<br />
&nbsp;&nbsp;GS_BSEG-BUZID&nbsp;=&nbsp;'W'.&nbsp;"&nbsp;W&nbsp;-&nbsp;WRX&nbsp;(GR/IR&nbsp;##)&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-BSCHL&nbsp;=&nbsp;'96'.&nbsp;"###&nbsp;96&nbsp;(	GR\IR&nbsp;Credit&nbsp;)&nbsp;-&nbsp;Credit,&nbsp;G/L&nbsp;Account<br />
&nbsp;&nbsp;GS_BSEG-KOART&nbsp;=&nbsp;'S'.&nbsp;&nbsp;"G/L&nbsp;Account<br />
&nbsp;&nbsp;GS_BSEG-SHKZG&nbsp;=&nbsp;'H'.&nbsp;&nbsp;"Credit<br />
&nbsp;&nbsp;GS_BSEG-DMBTR&nbsp;=&nbsp;LV_PROC_COST.&nbsp;"####&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-WRBTR&nbsp;=&nbsp;LV_PROC_COST.&nbsp;"####&nbsp;##<br />
&nbsp;&nbsp;GS_BSEG-PSWSL&nbsp;=&nbsp;GS_BKPF-WAERS.<br />
<br />
&nbsp;&nbsp;GS_BSEG-KTOSL&nbsp;=&nbsp;'WRX'.&nbsp;"####&nbsp;#<br />
&nbsp;&nbsp;GS_BSEG-VORGN&nbsp;=&nbsp;'RMWE'.&nbsp;"#####&nbsp;####&nbsp;(RMWE&nbsp;=&nbsp;####)<br />
<br />
&nbsp;&nbsp;GS_BSEG-HKONT&nbsp;=&nbsp;'93000030'.&nbsp;"GR/IR&nbsp;##&nbsp;(WRX)<br />
<br />
&nbsp;&nbsp;"####&nbsp;(PO##)<br />
&nbsp;&nbsp;GS_BSEG-LIFNR&nbsp;=&nbsp;P_GS_ITEM-LIFNR.<br />
<br />
&nbsp;&nbsp;"ZMBLNR&nbsp;:&nbsp;####&nbsp;##,&nbsp;ZMZEILE&nbsp;:&nbsp;####&nbsp;ZEILE<br />
&nbsp;&nbsp;GS_BSEG-ZMBLNR&nbsp;=&nbsp;GF_MBLNR.<br />
&nbsp;&nbsp;GS_BSEG-ZMZEILE&nbsp;=&nbsp;LV_ZMZEILE.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_BSEG&nbsp;TO&nbsp;GT_BSEG.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SET_CELL_STYLE<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SET_CELL_STYLE .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_STYLE&nbsp;TYPE&nbsp;LVC_S_STYL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_STYLE&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;LS_STYLE.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM_ALV&nbsp;ASSIGNING&nbsp;FIELD-SYMBOL(&lt;FS_ROW&gt;).<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LT_STYLE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"543#&nbsp;##&nbsp;####&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&lt;FS_ROW&gt;-BWART&nbsp;=&nbsp;'543'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE-FIELDNAME&nbsp;=&nbsp;'LV_CHECK'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LS_STYLE-STYLE&nbsp;=&nbsp;CL_GUI_ALV_GRID=&gt;MC_STYLE_DISABLED.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_STYLE&nbsp;TO&nbsp;LT_STYLE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FS_ROW&gt;-STYLE&nbsp;=&nbsp;LT_STYLE.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;LATOUT_ITEMS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM LATOUT_ITEMS .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_LAYOUT.<br />
<br />
&nbsp;&nbsp;GS_LAYOUT-STYLEFNAME&nbsp;=&nbsp;'STYLE'.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SHOW_FI_LIST<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SHOW_FI_LIST .<br />
&nbsp;&nbsp;"###&nbsp;200##&nbsp;##&nbsp;##&nbsp;#####&nbsp;####&nbsp;###&nbsp;###<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA&nbsp;:&nbsp;LO_CONTAINER&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_GUI_CUSTOM_CONTAINER,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LO_ALV&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;REF&nbsp;TO&nbsp;CL_GUI_ALV_GRID.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_FIELDCAT&nbsp;TYPE&nbsp;LVC_S_FCAT,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LT_FIELDCAT&nbsp;TYPE&nbsp;LVC_T_FCAT.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LT_TOOLBAR&nbsp;TYPE&nbsp;UI_FUNCTIONS.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GO_CONT_300&nbsp;IS&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_CONT_300<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTAINER_NAME&nbsp;=&nbsp;'CC_FI_LIST'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_ALV_300<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_PARENT&nbsp;=&nbsp;GO_CONT_300.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"field&nbsp;catalog<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LS_FIELDCAT,&nbsp;LT_FIELDCAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-COL_POS&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'BELNR'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'##&nbsp;##'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_FIELDCAT&nbsp;TO&nbsp;LT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;LS_FIELDCAT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-COL_POS&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-FIELDNAME&nbsp;=&nbsp;'OBJTYPETXT'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_FIELDCAT-COLTEXT&nbsp;=&nbsp;'ObjTypeTxt'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_FIELDCAT&nbsp;TO&nbsp;LT_FIELDCAT.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;###&nbsp;###<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;CL_GUI_ALV_GRID=&gt;MC_FC_EXCL_ALL&nbsp;TO&nbsp;LT_TOOLBAR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"###&nbsp;##&nbsp;##&nbsp;##&nbsp;-&nbsp;#####,&nbsp;####&nbsp;##&nbsp;400##&nbsp;#####&nbsp;..<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;CLASS_EVENT_300.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_300-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_TOOLBAR_EXCLUDING&nbsp;=&nbsp;LT_TOOLBAR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;=&nbsp;GT_FI_LIST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;=&nbsp;LT_FIELDCAT.<br />
<br />
<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GO_ALV_300-&gt;REFRESH_TABLE_DISPLAY(&nbsp;).<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_FI_LIST<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_FI_LIST  USING    P_MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING&nbsp;P_LT_FI_LIST&nbsp;LIKE&nbsp;GT_FI_LIST.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_FI_LIST&nbsp;TYPE&nbsp;TY_FI_LIST.<br />
<br />
&nbsp;&nbsp;"##&nbsp;###&nbsp;#####&nbsp;###&nbsp;####&nbsp;####<br />
&nbsp;&nbsp;SELECT&nbsp;DISTINCT&nbsp;BELNR<br />
&nbsp;&nbsp;FROM&nbsp;ZMSEG09<br />
&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;P_LT_FI_LIST<br />
&nbsp;&nbsp;WHERE&nbsp;MBLNR&nbsp;=&nbsp;P_MBLNR.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;P_LT_FI_LIST&nbsp;INTO&nbsp;LS_FI_LIST.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LS_FI_LIST-OBJTYPETXT&nbsp;=&nbsp;'##&nbsp;##'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;P_LT_FI_LIST&nbsp;FROM&nbsp;LS_FI_LIST&nbsp;INDEX&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CLASS_EVENT_300<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CLASS_EVENT_300 .<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_EVENT_300.<br />
<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_EVENT_300-&gt;HANDLER_DOUBLE_CLICK_300&nbsp;FOR&nbsp;GO_ALV_300.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_HANDLER_DOUBLE_CLICK_300<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_HANDLER_DOUBLE_CLICK_300  USING    P_E_ROW TYPE LVC_S_ROW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_E_COLUMN&nbsp;TYPE&nbsp;LVC_S_COL&nbsp;"#(column)&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_ES_ROW_NO&nbsp;TYPE&nbsp;LVC_S_ROID.&nbsp;&nbsp;"#(row)&nbsp;##&nbsp;##<br />
<br />
&nbsp;&nbsp;"&nbsp;GT_FI_LIST,&nbsp;GV_SEL_BELNR<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_FI&nbsp;TYPE&nbsp;TY_FI_LIST.<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_FI_LIST&nbsp;INTO&nbsp;LS_FI&nbsp;INDEX&nbsp;P_ES_ROW_NO-ROW_ID.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;###&nbsp;####&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;GV_SEL_BELNR&nbsp;=&nbsp;LS_FI-BELNR.<br />
<br />
&nbsp;&nbsp;"&nbsp;##&nbsp;##&nbsp;####&nbsp;##<br />
&nbsp;&nbsp;CALL&nbsp;SCREEN&nbsp;400.<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;PREPARE_FI_DISPLAY<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM PREPARE_FI_DISPLAY .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GT_SEL_MSEG.<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LS_SEL_MSEG&nbsp;TYPE&nbsp;ZMSEG09.<br />
<br />
&nbsp;&nbsp;"###&nbsp;#####&nbsp;###&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GT_SEL_MSEG.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM_ALV&nbsp;INTO&nbsp;GS_ITEM_ALV&nbsp;WHERE&nbsp;LV_CHECK&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;LS_SEL_MSEG<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MBLNR&nbsp;=&nbsp;GS_HEADER_ALV-MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;ZEILE&nbsp;=&nbsp;GS_ITEM_ALV-ZEILE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;LS_SEL_MSEG&nbsp;TO&nbsp;GT_SEL_MSEG.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_SEL_MSEG&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;'###&nbsp;#&nbsp;##&nbsp;###&nbsp;######.'&nbsp;TYPE&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_BKPF<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_BKPF .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_BKPF_400.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;*<br />
&nbsp;&nbsp;FROM&nbsp;ZBKPF09<br />
&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;GS_BKPF_400<br />
&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;GV_SEL_BELNR.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SHOW_BSEG_ALV<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SHOW_BSEG_ALV .<br />
&nbsp;&nbsp;IF&nbsp;GO_CONT_400&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_CONT_400<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;CONTAINER_NAME&nbsp;=&nbsp;'CC_BSEG'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_ALV_400<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING&nbsp;I_PARENT&nbsp;=&nbsp;GO_CONT_400.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;BUILD_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;LAYOUT_400.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;SORT_400.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;METHOD&nbsp;GO_ALV_400-&gt;SET_TABLE_FOR_FIRST_DISPLAY<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IS_LAYOUT&nbsp;=&nbsp;GS_LATOUT_400<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHANGING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_OUTTAB&nbsp;=&nbsp;GT_BSEG_400_ALV<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_SORT&nbsp;&nbsp;&nbsp;=&nbsp;GT_SORT_400<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_FIELDCATALOG&nbsp;=&nbsp;GT_FIELDCAT_400.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;GO_ALV_400-&gt;REFRESH_TABLE_DISPLAY(&nbsp;).<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BUILD_FIELDCAT_400<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM BUILD_FIELDCAT_400 .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT_400,&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'BUKRS'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'CoCd'.&nbsp;"####<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'BUZEI'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'BSCHL'.&nbsp;"###<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'#'.<br />
&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;4.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'KOART'.&nbsp;"####<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'SG'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;5.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'SHKZG'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'##/##&nbsp;###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;6.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'HKONT'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;7.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'TXT1'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'HKONT2'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'G/L&nbsp;##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;9.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'TXT2'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'G/L&nbsp;###'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;10.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'DMBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-DO_SUM&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-CFIELDNAME&nbsp;=&nbsp;'PSWSL'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;11.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'PSWSL'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;12.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'WRBTR'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-DO_SUM&nbsp;&nbsp;&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'##&nbsp;##&nbsp;##'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-CFIELDNAME&nbsp;=&nbsp;'PSWSL2'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FIELDCAT.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COL_POS&nbsp;=&nbsp;13.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-FIELDNAME&nbsp;=&nbsp;'PSWSL2'.<br />
&nbsp;&nbsp;GS_FIELDCAT_400-COLTEXT&nbsp;=&nbsp;'##&nbsp;##'.<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FIELDCAT_400&nbsp;TO&nbsp;GT_FIELDCAT_400.<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_BSEG<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM GET_BSEG .<br />
<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;GS_SEL_MSEG&nbsp;TYPE&nbsp;ZMSEG09.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GT_BSEG_400.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;IF&nbsp;GV_FI_VIEW_MODE&nbsp;=&nbsp;'R'.&nbsp;"###&nbsp;##&nbsp;:&nbsp;####&nbsp;##<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBSEG09<br />
*&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_BSEG_400<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;GV_SEL_BELNR.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GV_FI_VIEW_MODE.<br />
*<br />
*&nbsp;&nbsp;ELSE.&nbsp;"##&nbsp;##&nbsp;:&nbsp;"###&nbsp;#####&nbsp;'####'&nbsp;#####&nbsp;####&nbsp;#<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GT_SEL_MSEG&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZBSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;CORRESPONDING&nbsp;FIELDS&nbsp;OF&nbsp;TABLE&nbsp;GT_BSEG_400<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;GT_SEL_MSEG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;BELNR&nbsp;=&nbsp;GV_SEL_BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;ZMBLNR&nbsp;=&nbsp;GT_SEL_MSEG-MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;ZMZEILE&nbsp;=&nbsp;GT_SEL_MSEg-ZEILE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;"##&nbsp;#&nbsp;#&nbsp;####&nbsp;GT_BSEG_400_ALV&nbsp;####<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_SAKNR&nbsp;TYPE&nbsp;ZSKA109-SAKNR.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_BSEG_400,&nbsp;GS_BSEG_400_ALV,&nbsp;GT_BSEG_400_ALV.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_BSEG_400&nbsp;INTO&nbsp;GS_BSEG_400.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MOVE-CORRESPONDING&nbsp;GS_BSEG_400&nbsp;TO&nbsp;GS_BSEG_400_ALV.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"###&nbsp;#####&nbsp;###&nbsp;0##&nbsp;###&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;LV_SAKNR&nbsp;=&nbsp;GS_BSEG_400-HKONT.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INPUT&nbsp;=&nbsp;LV_SAKNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUTPUT&nbsp;=&nbsp;LV_SAKNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;TEXT<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZSKA109<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;GS_BSEG_400_ALV-TXT1<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;SAKNR&nbsp;=&nbsp;LV_SAKNR.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG_400_ALV-TXT2&nbsp;=&nbsp;GS_BSEG_400_ALV-TXT1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"##<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG_400_ALV-HKONT2&nbsp;=&nbsp;GS_BSEG_400_ALV-HKONT.&nbsp;&nbsp;&nbsp;"##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG_400_ALV-PSWSL2&nbsp;=&nbsp;GS_BSEG_400_ALV-PSWSL.&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"##&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_BSEG_400_ALV-SHKZG&nbsp;=&nbsp;'H'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG_400_ALV-DMBTR&nbsp;=&nbsp;GS_BSEG_400_ALV-DMBTR&nbsp;*&nbsp;-1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_BSEG_400_ALV-WRBTR&nbsp;=&nbsp;GS_BSEG_400_ALV-WRBTR&nbsp;*&nbsp;-1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;GS_BSEG_400_ALV&nbsp;TO&nbsp;GT_BSEG_400_ALV.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;SORT_400<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM SORT_400 .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_SORT_400.<br />
<br />
&nbsp;&nbsp;GS_SORT_400-FIELDNAME&nbsp;=&nbsp;'SHKZG'.<br />
&nbsp;&nbsp;GS_SORT_400-DOWN&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;GS_SORT_400-SUBTOT&nbsp;=&nbsp;'X'.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_SORT_400&nbsp;TO&nbsp;GT_SORT_400.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;LAYOUT_400<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM LAYOUT_400 .<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_LATOUT_400.<br />
<br />
&nbsp;&nbsp;GS_LATOUT_400-ZEBRA&nbsp;=&nbsp;'X'.<br />
<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_CANCEL_STATUS<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM FILL_CANCEL_STATUS .<br />
&nbsp;&nbsp;DATA&nbsp;:&nbsp;LV_CANCEL_FLAG&nbsp;TYPE&nbsp;C.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;GT_ITEM_ALV&nbsp;INTO&nbsp;GS_ITEM_ALV.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;SINGLE&nbsp;ZCANCEL_FLAG<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;LV_CANCEL_FLAG<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;MBLNR&nbsp;=&nbsp;GS_HEADER_ALV-MBLNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;ZEILE&nbsp;=&nbsp;GS_ITEM_ALV-ZEILE<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;BWART&nbsp;=&nbsp;'101'.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;LV_CANCEL_FLAG&nbsp;=&nbsp;'X'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM_ALV-CANCEL_TEXT&nbsp;=&nbsp;'##&nbsp;###'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GS_ITEM_ALV-CANCEL_TEXT&nbsp;=&nbsp;'####'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;GS_ITEM_ALV-BWART&nbsp;=&nbsp;'101'.&nbsp;"543&nbsp;#####&nbsp;##&nbsp;####<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MODIFY&nbsp;GT_ITEM_ALV&nbsp;FROM&nbsp;GS_ITEM_ALV&nbsp;INDEX&nbsp;SY-TABIX.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDLOOP.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;GET_REV_BELNR_LIST<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
TYPES: TT_REV_BELNR TYPE SORTED TABLE OF ZBKPF09-BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH&nbsp;UNIQUE&nbsp;KEY&nbsp;TABLE_LINE.<br />
<br />
FORM GET_REV_BELNR_LIST  CHANGING P_LT_REV_BELNR TYPE TT_REV_BELNR.<br />
<br />
<br />
&nbsp;&nbsp;IF&nbsp;GT_SEL_MSEG&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;DISTINCT&nbsp;BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ZMSEG09<br />
&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;TABLE&nbsp;P_LT_REV_BELNR<br />
&nbsp;&nbsp;&nbsp;&nbsp;FOR&nbsp;ALL&nbsp;ENTRIES&nbsp;IN&nbsp;GT_SEL_MSEG<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;LFBNR&nbsp;=&nbsp;GT_SEL_MSEG-MBLNR&nbsp;"#######&nbsp;LFBNR#&nbsp;##&nbsp;####ID#&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;LFPOS&nbsp;=&nbsp;GT_SEL_MSEG-ZEILE&nbsp;"#######&nbsp;LFPOS#&nbsp;##&nbsp;########&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;BWART&nbsp;=&nbsp;'102'.&nbsp;"##&nbsp;####&nbsp;##<br />
<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;BUILD_FCAT_410<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM BUILD_FCAT_410 .<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;:&nbsp;GS_FCAT_410,&nbsp;GT_FCAT_410.<br />
<br />
&nbsp;&nbsp;GS_FCAT_410-FIELDNAME&nbsp;=&nbsp;'BELNR'.<br />
&nbsp;&nbsp;GS_FCAT_410-COLTEXT&nbsp;=&nbsp;'######'.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;GS_FCAT_410&nbsp;TO&nbsp;GT_FCAT_410.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;CLASS_EVENT_410<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM CLASS_EVENT_410 .<br />
&nbsp;&nbsp;CREATE&nbsp;OBJECT&nbsp;GO_EVENT_410.<br />
<br />
&nbsp;&nbsp;SET&nbsp;HANDLER&nbsp;GO_EVENT_410-&gt;HANDLER_DOUBLE_CLICK_410&nbsp;FOR&nbsp;GO_ALV_410.<br />
ENDFORM.<br />
<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;ALV_HANDLER_DOUBLE_CLICK_410<br />
*&---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM ALV_HANDLER_DOUBLE_CLICK_410  USING    P_E_ROW TYPE LVC_S_ROW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_E_COLUMN&nbsp;TYPE&nbsp;LVC_S_COL&nbsp;"#(column)&nbsp;##&nbsp;##<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P_ES_ROW_NO&nbsp;TYPE&nbsp;LVC_S_ROID.&nbsp;&nbsp;"#(row)&nbsp;##&nbsp;##<br />
<br />
<br />
&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;GT_REV_BELNR&nbsp;INTO&nbsp;GV_SEL_BELNR&nbsp;INDEX&nbsp;P_ES_ROW_NO-ROW_ID.<br />
&nbsp;&nbsp;IF&nbsp;SY-SUBRC&nbsp;&lt;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;RETURN.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;LEAVE&nbsp;TO&nbsp;SCREEN&nbsp;0.&nbsp;"410&nbsp;##<br />
<br />
<br />
ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">Extracted by Mass Download version 1.5.5 - E.G.Mellodew. 1998-2025. Sap Release 750</td>
   </tr>
</table>
</body>
</html>
